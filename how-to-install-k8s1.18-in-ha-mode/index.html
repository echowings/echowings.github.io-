<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>How to Install K8S - echowings</title><meta name=Description content="echowings"><meta property="og:title" content="How to Install K8S"><meta property="og:description" content="How to Install K8S [TOC]
Prerequest  下载所需的yaml文件  下载地址:https://github.com/luckylucky421/kubernetes1.17.3/tree/master 2. 初始化k8s集群需要的镜像
下载链接: https://pan.baidu.com/s/1k1heJy8lLnDk2JEFyRyJdA 提取码: udkj
Prepare 5 centos  Set timezone on centos  1  timedatectl set-timezone Asia/Chongqing    Set hostname  1  hostnamectl set-hostname xak8smaster01    Modifiy yum sourcelist  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207  mv /etc/yum."><meta property="og:type" content="article"><meta property="og:url" content="https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/"><meta property="og:image" content="https://echowings.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-08T18:03:14+08:00"><meta property="article:modified_time" content="2022-04-03T18:44:16+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://echowings.github.io/logo.png"><meta name=twitter:title content="How to Install K8S"><meta name=twitter:description content="How to Install K8S [TOC]
Prerequest  下载所需的yaml文件  下载地址:https://github.com/luckylucky421/kubernetes1.17.3/tree/master 2. 初始化k8s集群需要的镜像
下载链接: https://pan.baidu.com/s/1k1heJy8lLnDk2JEFyRyJdA 提取码: udkj
Prepare 5 centos  Set timezone on centos  1  timedatectl set-timezone Asia/Chongqing    Set hostname  1  hostnamectl set-hostname xak8smaster01    Modifiy yum sourcelist  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207  mv /etc/yum."><meta name=application-name content="echowings"><meta name=apple-mobile-web-app-title content="echowings"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/><link rel=prev href=https://echowings.github.io/learning-golang-01/><link rel=next href=https://echowings.github.io/how-to-clear-ssh-session-on-ios/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How to Install K8S","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/echowings.github.io\/how-to-install-k8s1.18-in-ha-mode\/"},"image":["https:\/\/echowings.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"k8s, devops, docker","wordcount":778,"url":"https:\/\/echowings.github.io\/how-to-install-k8s1.18-in-ha-mode\/","datePublished":"2021-04-08T18:03:14+08:00","dateModified":"2022-04-03T18:44:16+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/echowings.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"echowings"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=echowings>echowings</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/categories/documentation/>Docs </a><a class=menu-item href=/about/>About </a><a class=menu-item href=https://github.com/echowings title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i> </a><a class=menu-item href=/search/><i class="fas fa-fw fa-search"></i> Search </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/how-to-install-k8s1.18-in-ha-mode/ selected>English</option></select>
</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=echowings>echowings</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/categories/documentation/ title>Docs</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=https://github.com/echowings title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a class=menu-item href=/search/ title><i class="fas fa-fw fa-search"></i>Search</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value"><option value=/how-to-install-k8s1.18-in-ha-mode/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">How to Install K8S</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>echowings</a></span>&nbsp;<span class=post-category>included in <a href=/categories/devops/><i class="far fa-folder fa-fw"></i>devops</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-04-08>2021-04-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;778 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#prerequest>Prerequest</a></li><li><a href=#prepare-5-centos>Prepare 5 centos</a></li></ul></nav></div></div><div class=content id=content><h1 id=how-to-install-k8s>How to Install K8S</h1><p>[TOC]</p><h2 id=prerequest>Prerequest</h2><ol><li>下载所需的yaml文件</li></ol><p>下载地址:<a href=https://github.com/luckylucky421/kubernetes1.17.3/tree/master target=_blank rel="noopener noreffer">https://github.com/luckylucky421/kubernetes1.17.3/tree/master</a>
2. 初始化k8s集群需要的镜像</p><p>下载链接: <a href=https://pan.baidu.com/s/1k1heJy8lLnDk2JEFyRyJdA target=_blank rel="noopener noreffer">https://pan.baidu.com/s/1k1heJy8lLnDk2JEFyRyJdA</a>
提取码: <code>udkj</code></p><h2 id=prepare-5-centos>Prepare 5 centos</h2><ul><li>Set timezone on centos</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>timedatectl set-timezone Asia/Chongqing
</span></span></code></pre></td></tr></table></div></div><ul><li>Set hostname</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>hostnamectl set-hostname xak8smaster01
</span></span></code></pre></td></tr></table></div></div><ul><li>Modifiy yum sourcelist</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
</span></span><span class=line><span class=cl>curl -fo /etc/yum.repos.d/CentOS-Base.repo -L http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span class=line><span class=cl>yum makecache fast
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span class=line><span class=cl><span class=s>[kubernetes]
</span></span></span><span class=line><span class=cl><span class=s>name=Kubernetes
</span></span></span><span class=line><span class=cl><span class=s>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span class=line><span class=cl><span class=s>enabled=1
</span></span></span><span class=line><span class=cl><span class=s>gpgcheck=0
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum clean all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum makecache fast
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum -y update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum -y install yum-utils device-mapper-persistent-data  lvm2
</span></span><span class=line><span class=cl>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum clean all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum makecache fast
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum -y install wget net-tools nfs-utils lrzsz gcc gcc-c++ make cmake libxml2-devel openssl-devel curl curl-devel unzip sudo ntp libaio-devel wget vim ncurses-devel autoconf automake zlib-devel  python-devel epel-release openssh-server socat  ipvsadm conntrack ntpdate
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl stop firewalld  <span class=o>&amp;&amp;</span> systemctl  disable  firewalld
</span></span><span class=line><span class=cl>yum install iptables-services -y
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>service iptables stop   <span class=o>&amp;&amp;</span> systemctl disable iptables
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>ntpdate cn.pool.ntp.org
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>#crontab -e</span>
</span></span><span class=line><span class=cl><span class=c1>#* */1 * * * /usr/sbin/ntpdate   cn.pool.ntp.org</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>crontab -l <span class=p>|</span> <span class=o>{</span> cat<span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;* */1 * * * /usr/sbin/ntpdate   cn.pool.ntp.org&#34;</span><span class=p>;</span> <span class=o>}</span> <span class=p>|</span> crontab -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>service crond restart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/sysconfig/selinux
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/selinux/config
</span></span><span class=line><span class=cl>reboot -r
</span></span><span class=line><span class=cl>swapoff -a
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>sysctl --system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt;&gt; /etc/hosts
</span></span></span><span class=line><span class=cl><span class=s>10.32.0.91 xak8smaster01
</span></span></span><span class=line><span class=cl><span class=s>10.32.0.92 xak8smaster02
</span></span></span><span class=line><span class=cl><span class=s>10.32.0.93 xak8smaster03
</span></span></span><span class=line><span class=cl><span class=s>10.32.0.94 xak8smaster04
</span></span></span><span class=line><span class=cl><span class=s>10.32.0.95 xak8snode01
</span></span></span><span class=line><span class=cl><span class=s>10.32.0.96 xak8snode02
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ssh-keygen -t rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/#PermitRootLogin\ yes/PermitRootLogin\ yes/g&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sed -i <span class=s1>&#39;s/PasswordAuthentication\ no/PasswordAuthentication\ yes/g&#39;</span> /etc/ssh/sshd_config
</span></span><span class=line><span class=cl>cat /etc/ssh/sshd_config <span class=p>|</span> grep PermitRootLogin
</span></span><span class=line><span class=cl>cat /etc/ssh/sshd_config <span class=p>|</span> grep PasswordAuthentication
</span></span><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl restart sshd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01
</span></span><span class=line><span class=cl>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt;&gt; 1.sh
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>sh 1.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt;&gt; 1.sh
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04
</span></span></span><span class=line><span class=cl><span class=s>ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>sh 1.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum list docker-ce --showduplicates <span class=p>|</span>sort -r
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; /etc/docker/daemon.json <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s> &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span class=line><span class=cl><span class=s> &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span class=line><span class=cl><span class=s> &#34;log-opts&#34;: {
</span></span></span><span class=line><span class=cl><span class=s>   &#34;max-size&#34;: &#34;100m&#34;
</span></span></span><span class=line><span class=cl><span class=s>  },
</span></span></span><span class=line><span class=cl><span class=s> &#34;storage-driver&#34;: &#34;overlay2&#34;,
</span></span></span><span class=line><span class=cl><span class=s> &#34;storage-opts&#34;: [
</span></span></span><span class=line><span class=cl><span class=s>   &#34;overlay2.override_kernel_check=true&#34;
</span></span></span><span class=line><span class=cl><span class=s>  ]
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>systemctl daemon-reload <span class=o>&amp;&amp;</span> systemctl restart docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> &gt; /proc/sys/net/bridge/bridge-nf-call-iptables
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> &gt;/proc/sys/net/bridge/bridge-nf-call-ip6tables
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>vm.swappiness = 0
</span></span></span><span class=line><span class=cl><span class=s2>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class=line><span class=cl><span class=s2>net.ipv4.ip_forward = 1
</span></span></span><span class=line><span class=cl><span class=s2>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span> &gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>sysctl -p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; /etc/sysconfig/modules/ipvs.modules <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=s>ipvs_modules=&#34;ip_vs ip_vs_lc ip_vs_wlc ip_vs_rr ip_vs_wrr ip_vs_lblc ip_vs_lblcr ip_vs_dh ip_vs_sh ip_vs_fo ip_vs_nq ip_vs_sed ip_vs_ftp nf_conntrack&#34;
</span></span></span><span class=line><span class=cl><span class=s>for kernel_module in \${ipvs_modules}; do
</span></span></span><span class=line><span class=cl><span class=s> /sbin/modinfo -F filename \${kernel_module} &gt; /dev/null 2&gt;&amp;1
</span></span></span><span class=line><span class=cl><span class=s> if [ $? -eq 0 ]; then
</span></span></span><span class=line><span class=cl><span class=s> /sbin/modprobe \${kernel_module}
</span></span></span><span class=line><span class=cl><span class=s> fi
</span></span></span><span class=line><span class=cl><span class=s>done
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum install -y conntrack-tools ipvsadm ipset conntrack libseccomp
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> /etc/sysconfig/modules/ipvs.modules <span class=o>&amp;&amp;</span> bash /etc/sysconfig/modules/ipvs.modules <span class=o>&amp;&amp;</span> lsmod <span class=p>|</span> grep ip_vs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt; /etc/sysctl.d/k8s.conf <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.ip_forward = 1
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class=line><span class=cl><span class=s>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class=line><span class=cl><span class=s>fs.may_detach_mounts = 1
</span></span></span><span class=line><span class=cl><span class=s>vm.overcommit_memory=1
</span></span></span><span class=line><span class=cl><span class=s>vm.panic_on_oom=0
</span></span></span><span class=line><span class=cl><span class=s>fs.inotify.max_user_watches=89100
</span></span></span><span class=line><span class=cl><span class=s>fs.file-max=52706963
</span></span></span><span class=line><span class=cl><span class=s>fs.nr_open=52706963
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_keepalive_time = 600
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp.keepaliv.probes = 3
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_keepalive_intvl = 15
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp.max_tw_buckets = 36000
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_tw_reuse = 1
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp.max_orphans = 327680
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_orphan_retries = 3
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_syncookies = 1
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_max_syn_backlog = 16384
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.ip_conntrack_max = 65536
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.tcp_max_syn_backlog = 16384
</span></span></span><span class=line><span class=cl><span class=s>net.ipv4.top_timestamps = 0
</span></span></span><span class=line><span class=cl><span class=s>net.core.somaxconn = 16384
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>sysctl --system
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker pull k8s.gcr.io/kube-apiserver:v1.18.2
</span></span><span class=line><span class=cl>docker pull k8s.gcr.io/kube-controller-manager:v1.18.2
</span></span><span class=line><span class=cl>docker pull k8s.gcr.io/kube-scheduler:v1.18.2
</span></span><span class=line><span class=cl>docker pull k8s.gcr.io/kube-proxy:v1.18.2
</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-04-03&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/7870ffd09d1efec4619b3a6a74c2bebd4ad2b337 target=_blank title="commit by stevedong(dongjunbo@gmail.com) 7870ffd09d1efec4619b3a6a74c2bebd4ad2b337: remove icon on the title">
<i class="fas fa-hashtag fa-fw"></i>7870ffd</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/how-to-install-k8s1.18-in-ha-mode/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/ data-title="How to Install K8S" data-via=xxxx data-hashtags=k8s,devops,docker><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/ data-hashtag=k8s><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/ data-title="How to Install K8S"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/ data-title="How to Install K8S"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://echowings.github.io/how-to-install-k8s1.18-in-ha-mode/ data-title="How to Install K8S"><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/k8s/>k8s</a>,&nbsp;<a href=/tags/devops/>devops</a>,&nbsp;<a href=/tags/docker/>docker</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/learning-golang-01/ class=prev rel=prev title="Learning Golang 01"><i class="fas fa-angle-left fa-fw"></i>Learning Golang 01</a>
<a href=/how-to-clear-ssh-session-on-ios/ class=next rel=next title="How to configure cisco catalyst switch">How to configure cisco catalyst switch<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.96.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>echowings</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"",lightTheme:"github-light",repo:"echowings/blogcomment"}}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>