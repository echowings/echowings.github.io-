<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Build Hyper-Converged Infrastructure with ceph on PVE&amp;quot; Ceph is really a king of SDS(Software Defin Storage). Opensource. After yeasr evolved, It is enterprise-ready. Today I will build a HCI with ceph on proxmox VE 5.x.
It will end nightmare that someone or montoring system tell you that your service was down, you need be a fire fighter to fixed as soon as possible under tremendous pressure form your boss. With proxmox ve , We can say &amp;rsquo;no more!"><title>Build Hyper-Converged Infrastructure With Ceph on PVE</title><link rel=canonical href=https://echowings.github.io/p/build-hyper-converged-infrastructure-with-ceph-on-pve/><link rel=stylesheet href=https://echowings.github.io/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css><meta property="og:title" content="Build Hyper-Converged Infrastructure With Ceph on PVE"><meta property="og:description" content="Build Hyper-Converged Infrastructure with ceph on PVE&amp;quot; Ceph is really a king of SDS(Software Defin Storage). Opensource. After yeasr evolved, It is enterprise-ready. Today I will build a HCI with ceph on proxmox VE 5.x.
It will end nightmare that someone or montoring system tell you that your service was down, you need be a fire fighter to fixed as soon as possible under tremendous pressure form your boss. With proxmox ve , We can say &amp;rsquo;no more!"><meta property="og:url" content="https://echowings.github.io/p/build-hyper-converged-infrastructure-with-ceph-on-pve/"><meta property="og:site_name" content="Steve's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="pve"><meta property="article:tag" content="HCI"><meta property="article:tag" content="ceph"><meta property="article:tag" content="cluster"><meta property="article:published_time" content="2019-04-29T10:56:16+08:00"><meta property="article:modified_time" content="2023-06-29T01:52:06+00:00"><meta name=twitter:title content="Build Hyper-Converged Infrastructure With Ceph on PVE"><meta name=twitter:description content="Build Hyper-Converged Infrastructure with ceph on PVE&amp;quot; Ceph is really a king of SDS(Software Defin Storage). Opensource. After yeasr evolved, It is enterprise-ready. Today I will build a HCI with ceph on proxmox VE 5.x.
It will end nightmare that someone or montoring system tell you that your service was down, you need be a fire fighter to fixed as soon as possible under tremendous pressure form your boss. With proxmox ve , We can say &amp;rsquo;no more!"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-128167130-1","auto"),ga("send","pageview"))</script><style>:root{--article-font-family:"Merriweather", var(--base-font-family)}</style><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=https://echowings.github.io/><img src=https://echowings.github.io/img/avatar_hu49d781430fb14dff787875229fd54172_10515_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=https://echowings.github.io/>Steve's Blog</a></h1><h2 class=site-description>Steve's Blog</h2></div></header><ol class=menu id=main-menu><li><a href=https://echowings.github.io/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=https://echowings.github.io/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=https://echowings.github.io/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=https://echowings.github.io/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=https://echowings.github.io/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://echowings.github.io/ selected>English</option><option value=https://echowings.github.io/zh-cn/>中文</option><option value=https://echowings.github.io/ja/>日本語　</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#perequest>Perequest</a><ol><li><a href=#hardware>Hardware</a></li><li><a href=#software>Software</a><ol><li><a href=#install-proxmox-ve-or-install-proxmox-ve-5x-on-debian-9>Install proxmox ve or install proxmox ve 5.x on debian 9</a></li><li><a href=#delete-disk-partition-on-2rd-disk>Delete disk partition on 2rd disk.</a></li></ol></li><li><a href=#create-pve-cluster>Create PVE Cluster</a><ol><li><a href=#create-pve-clusteroperating-on-proxmox-ve-node-pve-test01>Create pve cluster:Operating on proxmox ve node <code>pve-test01</code></a></li><li><a href=#heading></a></li><li><a href=#to-join-node-to-pve-cluseroperate-on-proxmox-ve-node>To join node to pve cluser:Operate on proxmox ve node.</a></li></ol></li><li><a href=#setup-ntp-servic-for-proxmox-ve>Setup NTP Servic for proxmox ve</a></li><li><a href=#ceph-setup>Ceph Setup</a><ol><li><a href=#install-ceph-on-all-of-pve-nodes>Install ceph on all of pve nodes.</a></li><li><a href=#create-ceph-storage-network-on-master-node>Create ceph storage network on master node</a></li><li><a href=#run-all-the-command-on-each-node>Run all the command on each node</a></li><li><a href=#create-ceph-cluster-resource-pool-on-master-node>Create ceph cluster resource pool on master node</a></li><li><a href=#copy-storage-id-and-key-to-the-right-position>copy storage ID and key to the right position</a></li><li><a href=#check-ceph-cluster-status>Check ceph cluster status</a></li><li><a href=#create-osd-on-proxmox-ve-portal>Create OSD on proxmox ve portal</a></li></ol></li></ol></li><li><a href=#setup-ha>Setup HA</a><ol><li><a href=#create-vm-or-lxc-on-one-node>Create vm or lxc on one node</a></li><li><a href=#setup-the-vm-or-lxc-in-ha-mode>Setup the vm or lxc in HA mode</a></li></ol></li><li><a href=#reference>Reference</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=https://echowings.github.io/categories/virtualization/>virtualization</a></header><div class=article-title-wrapper><h2 class=article-title><a href=https://echowings.github.io/p/build-hyper-converged-infrastructure-with-ceph-on-pve/>Build Hyper-Converged Infrastructure With Ceph on PVE</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Apr 29, 2019</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><h1 id=build-hyper-converged-infrastructure-with-ceph-on-pve>Build Hyper-Converged Infrastructure with ceph on PVE"</h1><p>Ceph is really a king of SDS(Software Defin Storage). Opensource. After yeasr evolved, It is enterprise-ready. Today I will build a HCI with ceph on proxmox VE 5.x.</p><p>It will end nightmare that someone or montoring system tell you that your service was down, you need be a fire fighter to fixed as soon as possible under tremendous pressure form your boss. With proxmox ve , We can say &rsquo;no more!"</p><p>If one server was down. and HA will handle this issue. HA will take all of virtual machines that hosted on the server which was down, and boot them other nodes automatically.</p><h2 id=perequest>Perequest</h2><h3 id=hardware>Hardware</h3><p>We need got 3 host each of them have two disk(1 for install proxmox-ve 5.x, another for install ceph). Each host i prepared 2 disk . 128GB SSD for intall proxmox ve . another disk is a 1TB sata(It is really slowly, but for lab testing is enough).</p><div class=table-wrapper><table><thead><tr><th>Host name</th><th>Host IP</th><th>Disk01 for install PVE</th><th>Disk02 for ceph</th></tr></thead><tbody><tr><td>pve-test01</td><td>192.168.0.85</td><td>/dev/sda</td><td>/dev/sdb</td></tr><tr><td>pve-test02</td><td>192.168.0.86</td><td>/dev/sda</td><td>/dev/sdb</td></tr><tr><td>pve-test03</td><td>192.168.0.87</td><td>/dev/sda</td><td>/dev/sdb</td></tr></tbody></table></div><h3 id=software>Software</h3><h4 id=install-proxmox-ve-or-install-proxmox-ve-5x-on-debian-9>Install proxmox ve or install proxmox ve 5.x on debian 9</h4><ul><li>Install proxmox VE 5.x, please follow user guide : <a class=link href=https://blog.stevedong.com/post/proxmox-ve-v5.x-installation/ target=_blank rel=noopener>Proxmoxve VE V5.x Installation</a>.</li><li>Install Proxmox VE 5.x on debian 9: <a class=link href=https://blog.stevedong.com/post/proxmox-ve-how-to-install-proxmoxve5-on-debian9/ target=_blank rel=noopener>How to install ProxmoxVE 5.x on Debian 9</a>.</li></ul><h4 id=delete-disk-partition-on-2rd-disk>Delete disk partition on 2rd disk.</h4><p>If the disk has data, we can use <code>fdisk /dev/sdb</code> to delete partition of sdb.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>fdisk /dev/sdb
</span></span><span class=line><span class=cl><span class=c1># Repeat enter m to delete partiton of sdb.</span>
</span></span><span class=line><span class=cl>m
</span></span><span class=line><span class=cl><span class=c1># Save configuration with w.</span>
</span></span><span class=line><span class=cl>w
</span></span></code></pre></td></tr></table></div></div><h3 id=create-pve-cluster>Create PVE Cluster</h3><h4 id=create-pve-clusteroperating-on-proxmox-ve-node-pve-test01>Create pve cluster:Operating on proxmox ve node <code>pve-test01</code></h4><p>Login via ssh to <code>pve-test01</code> the first proxmox ve node. Use a unique name for your cluster, the name cannot be changed later.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pvecm create mycloud
</span></span></code></pre></td></tr></table></div></div><p>To check the state of cluster:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pvecm status
</span></span></code></pre></td></tr></table></div></div><h4 id=heading></h4><h4 id=to-join-node-to-pve-cluseroperate-on-proxmox-ve-node>To join node to pve cluser:Operate on proxmox ve node.</h4><p>Run coomand like these on the rest of pve nodes.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 192.168.0.85 is the ip address of pve node `pve-test01`</span>
</span></span><span class=line><span class=cl>pvecm add 192.168.0.85 
</span></span><span class=line><span class=cl><span class=c1>#Check pve cluster status on `pve-test02`</span>
</span></span><span class=line><span class=cl>pvecm status
</span></span></code></pre></td></tr></table></div></div><h3 id=setup-ntp-servic-for-proxmox-ve>Setup NTP Servic for proxmox ve</h3><ul><li>If you have a lan ntp server setup like this. mutilpy ntp server separated with blank space.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat &gt;&gt; /etc/systemd/timesyncd.conf <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>NTP=192.168.0.2 192.168.0.3
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Or if you can sync ntp with aliyun ntp server in china.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat &gt;&gt; /etc/systemd/timesyncd.conf <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>NTP=ntp1.aliyun.com ntp2.aliyun.com
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=c1># Restart systemd-timesyncd service to apply settings</span>
</span></span><span class=line><span class=cl>systemctl restart systemd-timesyncd
</span></span></code></pre></td></tr></table></div></div><h3 id=ceph-setup>Ceph Setup</h3><h4 id=install-ceph-on-all-of-pve-nodes>Install ceph on all of pve nodes.</h4><p>Run Each host with this command to install ceph on</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Install ceph</span>
</span></span><span class=line><span class=cl>pveceph install
</span></span></code></pre></td></tr></table></div></div><h4 id=create-ceph-storage-network-on-master-node>Create ceph storage network on master node</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># pve-node-01(10.32.0.85)</span>
</span></span><span class=line><span class=cl>pveceph init --network 192.168.0.0/24
</span></span></code></pre></td></tr></table></div></div><h4 id=run-all-the-command-on-each-node>Run all the command on each node</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Create mon moniting service</span>
</span></span><span class=line><span class=cl>pveceph createmon
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create OSD service </span>
</span></span><span class=line><span class=cl>pveceph createdosd /dev/sdb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check ost status</span>
</span></span><span class=line><span class=cl>ceph osd stat
</span></span><span class=line><span class=cl>ceph osd tree
</span></span></code></pre></td></tr></table></div></div><h4 id=create-ceph-cluster-resource-pool-on-master-node>Create ceph cluster resource pool on master node</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ceph osd pool creae pvepool1 <span class=m>128</span> <span class=m>128</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=copy-storage-id-and-key-to-the-right-position>copy storage ID and key to the right position</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#Run the command on master node.</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /etc/pve/priv/
</span></span><span class=line><span class=cl>mkdir ceph
</span></span><span class=line><span class=cl>cp /etc/ceph/ceph.client.admin.keyring ceph/my-ceph-storage.keyring
</span></span></code></pre></td></tr></table></div></div><h4 id=check-ceph-cluster-status>Check ceph cluster status</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ceph -s
</span></span></code></pre></td></tr></table></div></div><h4 id=create-osd-on-proxmox-ve-portal>Create OSD on proxmox ve portal</h4><ol><li>your can access portal on each node</li></ol><ul><li><a class=link href=https://192.168.0.85:8006 target=_blank rel=noopener>https://192.168.0.85:8006</a></li><li><a class=link href=https://192.168.0.86:8006 target=_blank rel=noopener>https://192.168.0.86:8006</a></li><li><a class=link href=https://192.168.0.87:8006 target=_blank rel=noopener>https://192.168.0.87:8006</a></li></ul><ol start=2><li>Create OSD.</li></ol><ul><li>&ldquo;Datacenter&rdquo; | &ldquo;Storage&rdquo; | &ldquo;Add&rdquo; | &ldquo;RBD&rdquo;</li></ul><h2 id=setup-ha>Setup HA</h2><h3 id=create-vm-or-lxc-on-one-node>Create vm or lxc on one node</h3><p>Create a VM or LXC on one node and run it.</p><h3 id=setup-the-vm-or-lxc-in-ha-mode>Setup the vm or lxc in HA mode</h3><ul><li>&ldquo;Datacenter&rdquo; | &ldquo;HA&rdquo; | &ldquo;Resources&rdquo; | &ldquo;Add&rdquo;.</li><li>Add: Resource:Container/Virtual Machine</li></ul><div class=table-wrapper><table><thead><tr><th>Name</th><th>value</th></tr></thead><tbody><tr><td>VM:</td><td>${VM-you-created}</td></tr><tr><td>Max Restart:</td><td>1</td></tr><tr><td>Max Relocate:</td><td>1</td></tr><tr><td>Group</td><td></td></tr><tr><td>request State:</td><td>started</td></tr></tbody></table></div><h2 id=reference>Reference</h2><ol><li><a class=link href=https://pve.proxmox.com/wiki/High_Availability_Cluster target=_blank rel=noopener>High Availability Cluster</a></li><li><a class=link href=https://pve.proxmox.com/wiki/Proxmox_VE_2.0_Cluster target=_blank rel=noopener>Proxmox VE 2.0 Cluster</a></li><li><a class=link href=https://www.kclouder.cn/proxmoxceph/ target=_blank rel=noopener>PROXMOX+CEPH TO BUILD HCI</a></li></ol></section><footer class=article-footer><section class=article-tags><a href=https://echowings.github.io/tags/pve/>pve</a>
<a href=https://echowings.github.io/tags/hci/>hci</a>
<a href=https://echowings.github.io/tags/ceph/>ceph</a>
<a href=https://echowings.github.io/tags/cluster/>cluster</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>Last updated on Jun 29, 2023 01:52 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=https://echowings.github.io/p/how-to-import-disk-to-ceph/><div class=article-details><h2 class=article-title>How to Import Disk to Ceph</h2></div></a></article><article class=has-image><a href=https://echowings.github.io/p/how-to-install-proxmox-ve-8-on-debian-12/><div class=article-image><img src="https://picsum.photos/800/600.webp?random=aa27590c" loading=lazy data-key data-hash="https://picsum.photos/800/600.webp?random=aa27590c"></div><div class=article-details><h2 class=article-title>How to install proxmox ve 8 on debian 12</h2></div></a></article><article><a href=https://echowings.github.io/p/how-to-install-proxmox-ve-6-on-debian-10/><div class=article-details><h2 class=article-title>How to Install Proxmox VE 6 on Debian 10</h2></div></a></article><article><a href=https://echowings.github.io/p/how-to-extend-all-available-disk-to-local-data/><div class=article-details><h2 class=article-title>How to Extend All Available Disk to Local Data</h2></div></a></article><article><a href=https://echowings.github.io/p/some_tips_for_management_promxmoxve/><div class=article-details><h2 class=article-title>Some_tips_for_management_promxmoxve</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=echowings/blogcomment issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2018 -
2023 Steve's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=https://echowings.github.io/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>