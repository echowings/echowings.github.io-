<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>networking on Steve's Blog</title><link>https://echowings.github.io/categories/networking/</link><description>Recent content in networking on Steve's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 26 Apr 2022 00:17:15 +0800</lastBuildDate><atom:link href="https://echowings.github.io/categories/networking/index.xml" rel="self" type="application/rss+xml"/><item><title>How to Enable Http Api Service on VyOS--copy</title><link>https://echowings.github.io/p/page/</link><pubDate>Tue, 26 Apr 2022 00:17:15 +0800</pubDate><guid>https://echowings.github.io/p/page/</guid><description>&lt;img src="https://picsum.photos/800/600.webp?random=71ff97d5" alt="Featured image of post How to Enable Http Api Service on VyOS--copy" />&lt;p>&lt;strong>How to enable API serivce on VyOS&lt;/strong>&lt;/p>
&lt;h1 id="how-to-enable-api-serivce-on-vyos">How to enable API serivce on VyOS&lt;/h1>
&lt;p>After these days, I wrote some vyos shell script to auto detect network status and automatacally change some settings. In the way There will be new configuration to loading directly and hold the configuration mode for a longer time. This is not in a smart way.&lt;/p>
&lt;p>Another better option, What if we can change settings of vyos with api?&lt;/p>
&lt;h2 id="enable-api-http-service-localy">Enable api http service localy&lt;/h2>
&lt;h3 id="enable-apt-service-with-socket-mode">Enable apt service with socket mode&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https api socket
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="test-settings">Test settings&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">curl --unix-socket /run/api.sock -X POST -Fkey&lt;span class="o">=&lt;/span>qwerty -Fdata&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{&amp;#34;op&amp;#34;: &amp;#34;showConfig&amp;#34;, &amp;#34;path&amp;#34;: []}&amp;#39;&lt;/span> http://localhost/retrieve
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="enable-api-https-service-with-lets-encryption-free-ssl">Enable api https service with let&amp;rsquo;s encryption free ssl&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/vbash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nb">source&lt;/span> /opt/vyatta/etc/functions/script-template
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Define variable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;my_id&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">APIKEY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;12345&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">APIPORT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1234&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">VHOST&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myvps&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">FULL_FQDN&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;xxx.xxx.xxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LISTEN_ADDRESS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;IP ADDRESS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">EMAIL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;my@emal.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https api key id &lt;span class="nv">$ID&lt;/span> key &lt;span class="nv">$APIKEY&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https certificates certbot domain-name &lt;span class="nv">$FULL_FQDN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https certificates certbot email &lt;span class="nv">$EMAIL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https api strict
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https virtual-host &lt;span class="nv">$VHOST&lt;/span> listen-address &lt;span class="nv">$LISTEN_ADDRESS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https virtual-host &lt;span class="nv">$VHOST&lt;/span> listen-port &lt;span class="nv">$APIPORT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service https virtual-host &lt;span class="nv">$VHOST&lt;/span> server-name &lt;span class="nv">$FULL_FQDN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to Install Freedns Go on Vyos</title><link>https://echowings.github.io/p/how-to-install-freedns-go-on-vyos/</link><pubDate>Mon, 11 Jan 2021 01:13:07 +0800</pubDate><guid>https://echowings.github.io/p/how-to-install-freedns-go-on-vyos/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Switch to root mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo su
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Define freedns version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">freedns_version&lt;/span>&lt;span class="o">=&lt;/span>v2020.9.17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Create dcompass temp folder&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mkdir -p /tmp/freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Swich to folder just we created.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /tmp/freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Download dcompass binary &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo curl -fsSLO &lt;span class="s2">&amp;#34;https://github.com/tuna/freedns-go/releases/download/&lt;/span>&lt;span class="nv">$freedns_version&lt;/span>&lt;span class="s2">/freedns-go-linux-amd64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp -af /tmp/freedns/freedns-go-linux-amd64 /usr/local/bin/freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chown root:root /usr/local/bin/freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod +x /usr/local/bin/freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo bash -c &lt;span class="s1">&amp;#39;cat &amp;gt; /lib/systemd/system/freedns.service&amp;#39;&lt;/span> &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Unit]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Description=freedns service
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Service]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">ExecStart=/usr/local/bin/freedns -f 114.114.114.114:53 -c 8.8.8.8:53 -l 127.0.0.3:53
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">Restart=on-failure
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">RestartSec=42s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">[Install]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">WantedBy=multi-user.target
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Reload systemclt daemon&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Delete temp directory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /tmp/freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Enable service of dcompass auto startup when system reboot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Restart service of freedns&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart freedns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Check dcompass status of freedns.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status freedns
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to Reset Vyos to Default Settings</title><link>https://echowings.github.io/p/how-to-reset-vyos-to-default-settings/</link><pubDate>Fri, 04 Sep 2020 22:48:34 +0800</pubDate><guid>https://echowings.github.io/p/how-to-reset-vyos-to-default-settings/</guid><description>&lt;h1 id="how-to-reset-vyos-to-default-settings">How to reset VyOS to default settings&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">load /opt/vyatta/etc/config.boot.default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to make Destination Base Routing With Vyos</title><link>https://echowings.github.io/p/how-to-make-destination-base-routing-with-vyos/</link><pubDate>Thu, 03 Sep 2020 16:36:31 +0800</pubDate><guid>https://echowings.github.io/p/how-to-make-destination-base-routing-with-vyos/</guid><description>&lt;h1 id="how-to-make-destination-base-routing-with-vyos">How to make Destination Base Routing with Vyos&lt;/h1>
&lt;p>I have 2 network interfaces. one for user access inboard network,another for user to access network aboard. How to make it work with vyos?&lt;/p>
&lt;h2 id="make-a-network-group">Make a network group&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Define a netwrok-group&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall group network-group china-ip-ranges
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Define lan network group&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall group network-group lan-net-group network &lt;span class="s1">&amp;#39;192.168.11.0/24&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="set-policy">set policy&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> policy route network-shunt rule &lt;span class="m">20&lt;/span> destination group network-group &lt;span class="s1">&amp;#39;china-ip-ranges&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> policy route network-shunt rule &lt;span class="m">20&lt;/span> &lt;span class="nb">set&lt;/span> table &lt;span class="s1">&amp;#39;20&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> policy route network-shunt rule &lt;span class="m">20&lt;/span> &lt;span class="nb">source&lt;/span> group network-group &lt;span class="s1">&amp;#39;lan-net-group&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> policy route network-shunt rule &lt;span class="m">30&lt;/span> &lt;span class="nb">set&lt;/span> table &lt;span class="s1">&amp;#39;30&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> policy route network-shunt rule &lt;span class="m">30&lt;/span> &lt;span class="nb">source&lt;/span> group network-group &lt;span class="s1">&amp;#39;lan-net-group&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="download-and-set-the-network-group-with-ipset">Download and set the network-group with ipset&lt;/h2>
&lt;ul>
&lt;li>Download and make a list for network-group loading when booting.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#create the update shell script&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /config/scripts/generate_china_ip_address.sh &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">wget -c http://ftp.apnic.net/stats/apnic/delegated-apnic-latest -O - | cat | awk -F &amp;#39;|&amp;#39; &amp;#39;/CN/&amp;amp;&amp;amp;/ipv4/ {print $4 &amp;#34;/&amp;#34; 32-log($5)/log(2)}&amp;#39; | cat &amp;gt; /config/chinaiprange.txt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># make the script an run&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x /config/scripts/generate_china_ip_address.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Run the script&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/config/scripts/generate_china_ip_address.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Create boot loading script&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cat &amp;gt;&amp;gt; /config/scripts/vyos-postconfig-bootup.script &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">for l in `cat /config/chinaiprange.txt`; do sudo ipset add china-ip-ranges $l;done
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="set-protocol">Set protocol&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> protocols static interface-route 0.0.0.0/0 next-hop-interface pppoe0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> protocols static interface-route 172.16.131.0/24 next-hop-interface wg01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> protocols static table &lt;span class="m">20&lt;/span> interface-route 0.0.0.0/0 next-hop-interface pppoe0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> protocols static table &lt;span class="m">30&lt;/span> route 0.0.0.0/0 next-hop 172.16.131.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="apply-pbr-policy-on-lan-interface">Apply PBR Policy on lan interface&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces bridge br0 policy route network-shunt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to Config Ddns for Vyos With Dns.he.net</title><link>https://echowings.github.io/p/how-to-config-ddns-for-vyos-with-dns.he.net/</link><pubDate>Wed, 05 Aug 2020 16:26:46 +0800</pubDate><guid>https://echowings.github.io/p/how-to-config-ddns-for-vyos-with-dns.he.net/</guid><description>&lt;h1 id="how-to-config-ddns-for-vyos-with-dnshenet">How to config DDNS for vyos with dns.he.net&lt;/h1>
&lt;h2 id="register-a-recored">Register A Recored&lt;/h2>
&lt;ol>
&lt;li>Register a domian &lt;code>host.mydomain.com&lt;/code> on your &lt;a class="link" href="https://dns.he.net" target="_blank" rel="noopener"
>https://dns.he.net&lt;/a>&lt;/li>
&lt;li>Generate a key &lt;code>64LGiLiuoiuoiuoi&lt;/code>&lt;/li>
&lt;/ol>
&lt;h2 id="run-command-to-setup-the-ddns-service">Run command to setup the ddns service&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service dns dynamic interface pppoe0 service dyndns host-name &lt;span class="s1">&amp;#39;host.mydomain.com&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service dns dynamic interface pppoe0 service dyndns login &lt;span class="s1">&amp;#39;host.mydomain.com&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service dns dynamic interface pppoe0 service dyndns password &lt;span class="s1">&amp;#39;64LGiLiuoiuoiuoi&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> service dns dynamic interface pppoe0 service dyndns server &lt;span class="s1">&amp;#39;dyn.dns.he.net&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to Build L2tp Over Ipsec VPN With Vyos</title><link>https://echowings.github.io/p/how-to-build-l2tp-over-ipsec-vpn-with-vyos/</link><pubDate>Wed, 05 Aug 2020 10:57:22 +0800</pubDate><guid>https://echowings.github.io/p/how-to-build-l2tp-over-ipsec-vpn-with-vyos/</guid><description>&lt;h1 id="how-to-build-l2tp-over-ipsec-vpn-with-vyos">How to build L2tp over ipsec vpn with vyos&lt;/h1>
&lt;p>Today, I will show you how to build a l2tp over ipsec vpn with adsl wan address.&lt;/p>
&lt;h3 id="setup-vpn-on-vyos">Setup vpn on vyos&lt;/h3>
&lt;hr>
&lt;h3 id="generate-a-preshare-key">Generate a preshare key&lt;/h3>
&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">$ generate wireguard preshared-key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uND0O6RYI1O833NL2+qwSrW4htMll1hJAUM2nPQaa8k&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="with-authentication-local">With authentication local&lt;/h3>
&lt;hr>
&lt;ol>
&lt;li>configuration VPN&lt;/li>
&lt;/ol>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>WAN interface&lt;/td>
&lt;td>pppoe0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>l2tp vpn network&lt;/td>
&lt;td>172.16.100.0/24&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PRESHARE KEY&lt;/td>
&lt;td>uND0O6RYI1O833NL2+qwSrW4htMll1hJAUM2nPQaa8k=&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>DNS server 01&lt;/td>
&lt;td>192.168.0.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>DNS Server 02&lt;/td>
&lt;td>1921.68.0.2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec auto-update &lt;span class="s1">&amp;#39;30&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ipsec-interfaces interface &lt;span class="s1">&amp;#39;pppoe0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec nat-networks allowed-network 0.0.0.0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec nat-traversal &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access authentication mode &lt;span class="s1">&amp;#39;local&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access authentication require &lt;span class="s1">&amp;#39;mschap-v2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access client-ip-pool start &lt;span class="s1">&amp;#39;172.16.100.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access client-ip-pool stop &lt;span class="s1">&amp;#39;172.16.100.254&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access dns-servers server-1 &lt;span class="s1">&amp;#39;192.168.0.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access ipsec-settings authentication mode &lt;span class="s1">&amp;#39;pre-shared-secret&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access ipsec-settings authentication pre-shared-secret &lt;span class="s1">&amp;#39;uND0O6RYI1O833NL2+qwSrW4htMll1hJAUM2nPQaa8k=&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access ipsec-settings ike-lifetime &lt;span class="s1">&amp;#39;3600&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access ipsec-settings lifetime &lt;span class="s1">&amp;#39;3600&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-access outside-address &lt;span class="s1">&amp;#39;0.0.0.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="auth--users--to-access-vpn">Auth users to access vpn&lt;/h3>
&lt;hr>
&lt;ol>
&lt;li>Generate password&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dd &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>/dev/urandom &lt;span class="nv">bs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="nv">count&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">15&lt;/span> &lt;span class="p">|&lt;/span> base64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>create user named &lt;code>zhangsan&lt;/code> with password &lt;code>J+Yi8o5ICLjKtezv0+i9&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn l2tp remote-acces authentication local-users username zhangshan password J+Yi8o5ICLjKtezv0+i9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="start-the-service">Start the service&lt;/h3>
&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> xl2tpd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart xl2tpd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="vpn-setup-script-for-windows-10">vpn setup script for windows 10&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bat" data-lang="bat">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">@&lt;/span>&lt;span class="k">echo&lt;/span> off&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="k">PUSHD&lt;/span> &lt;span class="nv">%~DP0&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>&lt;span class="k">TITLE&lt;/span> ikev2 VPN InstallUninstall programme
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mode con cols=160 lines=50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">set&lt;/span> &lt;span class="nv">TempFile_Name&lt;/span>&lt;span class="p">=&lt;/span>&lt;span class="nv">%SystemRoot%&lt;/span>\System32\BatTestUACin_SysRt&lt;span class="nv">%Random%&lt;/span>.batemp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span> &lt;span class="k">echo&lt;/span> &lt;span class="s2">&amp;#34;BAT Test UAC in Temp&amp;#34;&lt;/span> &lt;span class="p">&amp;gt;&lt;/span>&lt;span class="nv">%TempFile_Name%&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="k">exist&lt;/span> &lt;span class="nv">%TempFile_Name%&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">del&lt;/span> &lt;span class="nv">%TempFile_Name%&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul&lt;span class="p">&amp;amp;&amp;amp;&lt;/span>&lt;span class="k">goto&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="nl">install&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Please run the script as administrator,Press any key to quit... &lt;span class="p">&amp;amp;&amp;amp;&lt;/span>&lt;span class="k">goto&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="nl">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;VPN List:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>; Welcome! This programme will help your install MY-VPN, or uninstall it.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">:&lt;/span>&lt;span class="nl">install&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">cls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;1:MY-VPN(L2tp/ipsec)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Please select Install or Uninstall VPN(ikev2)(Enter &amp;#39;i&amp;#39; for install, &amp;#39;u&amp;#39; for uninstall, &amp;#39;q&amp;#39; for quit):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;i:Install MY-VPN(L2TP/IPSEC VPN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;u:Uninstall MY-VPN(L2TP/IPSEC VPN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;q:Quit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">set/p&lt;/span> &lt;span class="nv">choose1&lt;/span>&lt;span class="p">=&lt;/span>Please enter your selection and press enter key to confirm:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span> &lt;span class="nv">%choose1%&lt;/span>&lt;span class="p">|&lt;/span>findstr /i &lt;span class="s2">&amp;#34;[iuq]&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul&lt;span class="p">&amp;amp;&amp;amp;&lt;/span>&lt;span class="k">goto&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="nl">%choose1%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">goto&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="nl">install&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">:&lt;/span>&lt;span class="nl">i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">cls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Install 1:MY-VPN(L2TP/IPSEC VPN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;===========================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;***Step 1:Delete VPN with the same name ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {Remove-VpnConnection -Name &amp;#34;&lt;/span>MY-VPN&lt;span class="s2">&amp;#34; -Force -PassThru;}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;***Step 2: Install new VPN***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {Enable-PSRemoting -Force;}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {Add-VpnConnection -Name &amp;#34;&lt;/span>MY-VPN&lt;span class="s2">&amp;#34; -ServerAddress &amp;#34;&lt;/span>myvpn.mydomain.com&lt;span class="s2">&amp;#34; -TunnelType &amp;#34;&lt;/span>L2tp&lt;span class="s2">&amp;#34; -EncryptionLevel &amp;#34;&lt;/span>Required&lt;span class="s2">&amp;#34; -AuthenticationMethod MSChapv2 -L2tpPsk &amp;#34;&lt;/span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&lt;span class="s2">&amp;#34; -Force -RememberCredential -DnsSuffix &amp;#34;&lt;/span>MYDOMAIN.NET&lt;span class="s2">&amp;#34; -PassThru;}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Done!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;***Step 3:Clean key in regedit***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {Remove-ItemProperty HKLM:\System\CurrentControlSet\Services\Rasman\Parameters -name &amp;#34;&lt;/span>NegotiateDH2048_AES256&lt;span class="s2">&amp;#34;; Remove-ItemProperty HKLM:\System\CurrentControlSet\Services\PolicyAgent -name &amp;#34;&lt;/span>AssumeUDPEncapsulationContextOnSendRule &lt;span class="s2">&amp;#34;;}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Done!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;***Step 4:Add key in Regedit***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {New-ItemProperty HKLM:\System\CurrentControlSet\Services\Rasman\Parameters -name &amp;#34;&lt;/span>NegotiateDH2048_AES256&lt;span class="s2">&amp;#34; -value 1 -propertyType dword; New-ItemProperty HKLM:\System\CurrentControlSet\Services\PolicyAgent -name &amp;#34;&lt;/span>AssumeUDPEncapsulationContextOnSendRule &lt;span class="s2">&amp;#34; -value 2 -propertyType dword;}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Done!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;***Step 5:Set regedit***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {Set-ItemProperty HKLM:\System\CurrentControlSet\Services\Rasman\Parameters -name &amp;#34;&lt;/span>NegotiateDH2048_AES256&lt;span class="s2">&amp;#34; -value 1; Set-ItemProperty HKLM:\System\CurrentControlSet\Services\PolicyAgent -name &amp;#34;&lt;/span>AssumeUDPEncapsulationContextOnSendRule &lt;span class="s2">&amp;#34; -value 2;}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Done!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;***Step 6:Reboot your Windows***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Press any key to reboot your windows, or press X to quit the script and manually reboot your windows.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pause&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">goto&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="nl">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">:&lt;/span>&lt;span class="nl">u&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">cls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Uninstall MY-VPN(L2TP/IPSEC VPN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;===========================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>powershell -Command &lt;span class="s2">&amp;#34;&amp;amp; {Remove-VpnConnection -Name &amp;#34;&lt;/span>MY-VPN&lt;span class="s2">&amp;#34; -Force -PassThru;}&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul &lt;span class="mi">2&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">echo&lt;/span>;Done, Press any key to quit...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">goto&lt;/span> &lt;span class="p">:&lt;/span>&lt;span class="nl">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">:&lt;/span>&lt;span class="nl">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">pause&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>nul
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to Build Ipsec Site to Site Vpn With Vyos and Pfsense</title><link>https://echowings.github.io/p/how-to-build-ipsec-site-to-site-vpn-with-vyos-and-pfsense/</link><pubDate>Thu, 19 Dec 2019 14:36:09 +0800</pubDate><guid>https://echowings.github.io/p/how-to-build-ipsec-site-to-site-vpn-with-vyos-and-pfsense/</guid><description>&lt;h1 id="how-to-build-ipse-site-to-site-vpn-with-vyos-and-pfsense">How to build ipse site-to-site VPN with vyos and pfsense&lt;/h1>
&lt;h2 id="vyos-vs-pfsense">Vyos VS pfsense&lt;/h2>
&lt;p>For build all kinds of network functions like nat,firewall, site-to-site vpn , dial in vpn with pfsense.It works well. But it has some Crons:&lt;/p>
&lt;ol>
&lt;li>Hard to upgrade version, it manybe crashed&lt;/li>
&lt;li>Didn&amp;rsquo;t support API.&lt;/li>
&lt;li>Heavy loading and low performance.&lt;/li>
&lt;/ol>
&lt;p>After try to replace pfsense to build all functions with vyos. It has a lot of pros:&lt;/p>
&lt;ol>
&lt;li>Easy upgrade and rollback&lt;/li>
&lt;li>Support http and python api&lt;/li>
&lt;li>Support ansible deploy&lt;/li>
&lt;li>Command line operation,just like juniper and cisco.&lt;/li>
&lt;/ol>
&lt;p>Today I will show you how to build ipsec site-to-site vpn with vyos and pfsense&lt;/p>
&lt;h2 id="prerequest">Prerequest&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>SITE A&lt;/th>
&lt;th>SITE B&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>WAN ADDRESS&lt;/td>
&lt;td>&lt;code>1.1.1.1&lt;/code>&lt;/td>
&lt;td>&lt;code>2.2.2.2&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WAN Interface&lt;/td>
&lt;td>&lt;code>eth0&lt;/code>&lt;/td>
&lt;td>&lt;code>eth0&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>LAN ADDRESS&lt;/td>
&lt;td>&lt;code>192.168.1.1/24&lt;/code>&lt;/td>
&lt;td>&lt;code>192.168.2.1/24&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>LAN NETWORK&lt;/td>
&lt;td>&lt;code>192.168.1.0/24&lt;/code>&lt;/td>
&lt;td>&lt;code>192.168.2.0/24&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>LAN Interface&lt;/td>
&lt;td>&lt;code>eth1&lt;/code>&lt;/td>
&lt;td>&lt;code>eth1&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>OS&lt;/td>
&lt;td>&lt;code>Vyos&lt;/code>&lt;/td>
&lt;td>&lt;code>pfsense&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pre-Shared Key&lt;/td>
&lt;td>&lt;code>*#JCenaoewaoi0298J299*8&amp;amp;^(%9))_&amp;amp;&amp;amp;&lt;/code>&lt;/td>
&lt;td>&lt;code>*#JCenaoewaoi0298J299*8&amp;amp;^(%9))_&amp;amp;&amp;amp;&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="configure-vyos">Configure vyos&lt;/h2>
&lt;p>Configure &lt;code>Site A&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ipsec-interfaces interface eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default dead-peer-detection action &lt;span class="s1">&amp;#39;hold&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default dead-peer-detection interval &lt;span class="s1">&amp;#39;30&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default dead-peer-detection timeout &lt;span class="s1">&amp;#39;120&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default ikev2-reauth &lt;span class="s1">&amp;#39;no&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default key-exchange &lt;span class="s1">&amp;#39;ikev2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default lifetime &lt;span class="s1">&amp;#39;10800&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default mobike &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default proposal &lt;span class="m">1&lt;/span> dh-group &lt;span class="s1">&amp;#39;14&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default proposal &lt;span class="m">1&lt;/span> encryption &lt;span class="s1">&amp;#39;aes256gcm128&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec ike-group IKE-Default proposal &lt;span class="m">1&lt;/span> &lt;span class="nb">hash&lt;/span> &lt;span class="s1">&amp;#39;sha256&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec esp-group ESP-Default compression &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec esp-group ESP-Default lifetime &lt;span class="s1">&amp;#39;3600&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec esp-group ESP-Default mode &lt;span class="s1">&amp;#39;tunnel&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec esp-group ESP-Default pfs &lt;span class="s1">&amp;#39;dh-group14&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec esp-group ESP-Default proposal &lt;span class="m">1&lt;/span> encryption &lt;span class="s1">&amp;#39;aes256gcm128&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec esp-group ESP-Default proposal &lt;span class="m">1&lt;/span> &lt;span class="nb">hash&lt;/span> &lt;span class="s1">&amp;#39;sha256&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 authentication id &lt;span class="s1">&amp;#39;1.1.1.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 authentication mode &lt;span class="s1">&amp;#39;pre-shared-secret&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 authentication pre-shared-secret &lt;span class="s1">&amp;#39;*#JCenaoewaoi0298J299*8&amp;amp;^(%9))_&amp;amp;&amp;amp;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 authentication remote-id &lt;span class="s1">&amp;#39;2.2.2.2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 connection-type &lt;span class="s1">&amp;#39;initiate&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 ike-group &lt;span class="s1">&amp;#39;IKE-Default&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 ikev2-reauth &lt;span class="s1">&amp;#39;inherit&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 local-address &lt;span class="s1">&amp;#39;1.1.1.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 tunnel &lt;span class="m">0&lt;/span> esp-group &lt;span class="s1">&amp;#39;ESP-Default&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 tunnel &lt;span class="m">0&lt;/span> &lt;span class="nb">local&lt;/span> prefix &lt;span class="s1">&amp;#39;192.168.1.0/24&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> vpn ipsec site-to-site peer 2.2.2.2 tunnel &lt;span class="m">0&lt;/span> remote prefix &lt;span class="s1">&amp;#39;192.168.2.0/24&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="configure-pfsense">Configure pfsense&lt;/h2>
&lt;p>Configure &lt;code>Site B&lt;/code>&lt;/p>
&lt;ol>
&lt;li>After login pfsense click &lt;code>VPN&lt;/code> | &lt;code>IPsec&lt;/code>;&lt;/li>
&lt;li>Then click &amp;lsquo;Add P1` button.&lt;/li>
&lt;li>configuraton as show below&lt;/li>
&lt;/ol>
&lt;h3 id="add-p1">Add P1&lt;/h3>
&lt;h2 id="general-information">General Information&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>Disabled&lt;/code>&lt;/td>
&lt;td>uncheck&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Key Exchange version&lt;/code>&lt;/td>
&lt;td>IKEv2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Internet Protocol&lt;/td>
&lt;td>IPv4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Interfae&lt;/td>
&lt;td>WAN&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Remote Gateway&lt;/td>
&lt;td>1.1.1.1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Description&lt;/td>
&lt;td>SITE-A-VPN&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="phase-1-proposal-authentication">Phase 1 Proposal (Authentication)&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Authentication Method&lt;/td>
&lt;td>Mutual PSK&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>My identifier&lt;/td>
&lt;td>My IP address&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Peer identifier&lt;/td>
&lt;td>Peer IP address&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pre-Shared Key&lt;/td>
&lt;td>&lt;code>*#JCenaoewaoi0298J299*8&amp;amp;^(%9))_&amp;amp;&amp;amp;&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="phase-1-proposalencryption-algorithm">Phase 1 Proposal(Encryption Algorithm)&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Algorithm&lt;/th>
&lt;th>Key length&lt;/th>
&lt;th>Hash&lt;/th>
&lt;th>DH Group&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Encryption Algorithm&lt;/td>
&lt;td>AES256-GCM&lt;/td>
&lt;td>128 bits&lt;/td>
&lt;td>SHA256&lt;/td>
&lt;td>14(2048bit)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Lifetime(Seconds)&lt;/td>
&lt;td>28800&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="advanced-options">Advanced Options&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>KEY&lt;/th>
&lt;th>VALUE&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Disable rekey&lt;/td>
&lt;td>uncheck&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Margintime(Seconds&lt;/td>
&lt;td>black&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Disable Reauth&lt;/td>
&lt;td>uncheck&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Responder Only&lt;/td>
&lt;td>Uncheck&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MOBIKE&lt;/td>
&lt;td>Disable&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Split connections&lt;/td>
&lt;td>uncheck&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Dead Peer Dection&lt;/td>
&lt;td>&amp;lsquo;Check on&amp;rsquo; Enable DPD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Delay&lt;/td>
&lt;td>120&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Max failures&lt;/td>
&lt;td>30&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="add-p2">Add P2&lt;/h3>
&lt;h2 id="general-information-1">General Information&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Disable&lt;/td>
&lt;td>unchecked&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mode&lt;/td>
&lt;td>Tunnel IPv4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Local network&lt;/td>
&lt;td>Network 192.168.2.0/24&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NAT/BINAT translation&lt;/td>
&lt;td>None&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Remote Network&lt;/td>
&lt;td>Network 192.168.1.0/24&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Description&lt;/td>
&lt;td>Site A&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="phase-2-proposalsakey-exchange">Phase 2 Proposal(SA/Key Exchange)&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Protocol&lt;/td>
&lt;td>ESP&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Encryption Algorithms&lt;/td>
&lt;td>AES256-GCM 128 bit&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hash Algorithms&lt;/td>
&lt;td>SHA256&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>PFS key group&lt;/td>
&lt;td>14(2048 bit)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lifttime&lt;/td>
&lt;td>3600&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="advanced-configuration">Advanced Configuration&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Value&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Automatically ping host&lt;/td>
&lt;td>192.168.1.1&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="change-firewall-to-allow-ipsec-vpn-connection">Change firewall to allow ipsec vpn connection&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Protocol&lt;/th>
&lt;th>Source&lt;/th>
&lt;th>Port&lt;/th>
&lt;th>Destination&lt;/th>
&lt;th>Port&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Ipv4 UDP&lt;/td>
&lt;td>1.1.1.1&lt;/td>
&lt;td>*&lt;/td>
&lt;td>WAN address&lt;/td>
&lt;td>500(ISAKMP)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>IPv4 UDP&lt;/td>
&lt;td>1.1.1.1&lt;/td>
&lt;td>*&lt;/td>
&lt;td>WAN address&lt;/td>
&lt;td>4500(IPsec NAT-T)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ipv4 ESP&lt;/td>
&lt;td>1.1.1.1&lt;/td>
&lt;td>*&lt;/td>
&lt;td>WAN address&lt;/td>
&lt;td>*&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&amp;mdash;The End&amp;mdash;&lt;/p></description></item><item><title>How to Install Elasticflow</title><link>https://echowings.github.io/p/how-to-install-elasticflow/</link><pubDate>Tue, 19 Nov 2019 17:11:27 +0800</pubDate><guid>https://echowings.github.io/p/how-to-install-elasticflow/</guid><description>&lt;h1 id="how-to-install-elasticflow">How to install Elasticflow&lt;/h1>
&lt;p>Today, i found a good software that is &lt;a class="link" href="https://github.com/robcowart/elastiflow" target="_blank" rel="noopener"
>Elasticflow&lt;/a>. It is so perfect for us to monitor status of our networking. So I tried to install it will docker-compose way. You know what, after servial hours, fixed a lot bugs it works.&lt;/p>
&lt;p>&lt;img src="https://user-images.githubusercontent.com/10326954/57181284-fc141a80-6e91-11e9-9ec5-d0864c25a088.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="download-and-modified-docker-composeyml-for-elasticflow">Download and modified &lt;code>docker-compose.yml&lt;/code> for elasticflow&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Download `docker-compose.yml` for elasticflow&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://raw.githubusercontent.com/robcowart/elastiflow/master/docker-compose.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># version 3.5.2 is now existed. So we need change it to `3.5.1`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/robcowart/elastiflow-logstash-oss:3.5.2/robcowart/elastiflow-logstash-oss:3.5.1/g&amp;#39;&lt;/span> -i docker-comopse.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Change volumes from `/var/lib/elastiflow_es to current folder`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &lt;span class="s1">&amp;#39;s/\/var\/lib\/elastiflow_es/.\/elastiflow_es/g&amp;#39;&lt;/span> docker-compose.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create data folder and change folder permission.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir elastiflow_es
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chown -R 1000:1000 ./elastiflow_es
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="up-and-run">Up and run&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker-compose up -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then we can access elasticflow via browser
&lt;a class="link" href="http://%3celastciflow_host_ip%3e:5601" target="_blank" rel="noopener"
>http://&amp;lt;elastciflow_host_ip&amp;gt;:5601&lt;/a>&lt;/p>
&lt;h2 id="swell">Swell&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/robcowart/elastiflow" target="_blank" rel="noopener"
>ElastiFlow&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/robcowart/elastiflow/issues/428" target="_blank" rel="noopener"
>Problem with elasticsearch-oss #428&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/robcowart/elastiflow/blob/master/DOCKER.md#prepare-the-data-path" target="_blank" rel="noopener"
>Running ElastiFlow on Docker&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>How to Setup Vyos as a Firewall</title><link>https://echowings.github.io/p/how-to-setup-vyos-as-a-firewall/</link><pubDate>Thu, 08 Aug 2019 13:58:35 +0800</pubDate><guid>https://echowings.github.io/p/how-to-setup-vyos-as-a-firewall/</guid><description>&lt;h1 id="how-to-setup-vyos-as-a-firewall">How to Setup Vyos as a Firewall&lt;/h1>
&lt;h2 id="setup-interface">Setup interface&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Interface&lt;/th>
&lt;th>IP Address&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>eth0&lt;/td>
&lt;td>pppoe&lt;/td>
&lt;td>WAN&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>eth1&lt;/td>
&lt;td>192.168.68.1 / 24&lt;/td>
&lt;td>DMZ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>eth2&lt;/td>
&lt;td>10.0.0.1 / 24&lt;/td>
&lt;td>LAN&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth0 pppoe &lt;span class="m">0&lt;/span> user-id &lt;span class="s1">&amp;#39;&amp;lt;pppoe accout&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth0 pppoe &lt;span class="m">0&lt;/span> password &lt;span class="s1">&amp;#39;&amp;lt;pppoe password&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth0 pppoe &lt;span class="m">0&lt;/span> name-server &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth0 description &lt;span class="s1">&amp;#39;WAN&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth1 address 192.168.68.1/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth1 description DMZ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth2 address 10.0.0.1/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interface ethernet eth2 description &lt;span class="s1">&amp;#39;LAN&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="dhcp-server">DHCP Server&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> shared-network-name lan.local subnet 192.168.68.0/24 default-router 192.168.68.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> shared-network-name lan.local subnet 192.168.68.0/24 dns-server 192.168.68.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> shared-network-name lan.local subnet 192.168.68.0/24 domain-name lan.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> shared-network-name lan.local subnet 192.168.68.0/24 range &lt;span class="m">0&lt;/span> start 192.168.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> shared-network-name lan.local subnet 192.168.68.0/24 range &lt;span class="m">0&lt;/span> stop 192.168.68.254&lt;span class="err">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="dns-forwarding">DNS forwarding&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> cache-size &lt;span class="s1">&amp;#39;0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> listen-address 192.168.68.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> name-server &amp;lt;public dns server ip ,like 8.8.8.8&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="set-loging-banner">Set loging banner&lt;/h2>
&lt;p>You are able to set post-login or pre-login messages with the following lines:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> system login banner pre-login &lt;span class="s2">&amp;#34;UNAUTHORIZED USE OF THIS SYSTEM IS PROHIBITED\n&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> system login banner post-login &lt;span class="s2">&amp;#34;Welcome to VyOS&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="nat">NAT&lt;/h2>
&lt;h3 id="snat">SNAT&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> &lt;span class="nb">source&lt;/span> rule &lt;span class="m">10&lt;/span> outbound-interface pppoe0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> &lt;span class="nb">source&lt;/span> rule &lt;span class="m">10&lt;/span> &lt;span class="nb">source&lt;/span> address 192.168.68.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> &lt;span class="nb">source&lt;/span> rule &lt;span class="m">10&lt;/span> translation address masquerade
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="dnat">DNAT&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> nat destination rule &lt;span class="m">10&lt;/span> destination address &lt;span class="s1">&amp;#39;10.0.0.5&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> nat destination rule &lt;span class="m">10&lt;/span> destination port &lt;span class="s1">&amp;#39;3389&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> nat destination rule &lt;span class="m">10&lt;/span> inbound-interface &lt;span class="s1">&amp;#39;eth2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> nat destination rule &lt;span class="m">10&lt;/span> protocol &lt;span class="s1">&amp;#39;tcp_udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> nat destination rule &lt;span class="m">10&lt;/span> translation address &lt;span class="s1">&amp;#39;192.168.68.50&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> nat destination rule &lt;span class="m">10&lt;/span> translation port &lt;span class="s1">&amp;#39;3389&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="default-routing">Default routing&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> static interface-route 0.0.0.0/0 next-hop-interface pppoe0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="setting-of-firewall">Setting of firewall&lt;/h2>
&lt;h3 id="zone-base-firewall">Zone base firewall&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;span class="lnt">96
&lt;/span>&lt;span class="lnt">97
&lt;/span>&lt;span class="lnt">98
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Chang firewall to statue firewall&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall state-policy established action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall state-policy related action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall state-policy invalid action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Set Zone for interfaces&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone dmz interface &lt;span class="s1">&amp;#39;eth1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone private interface &lt;span class="s1">&amp;#39;eth2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone &lt;span class="nb">local&lt;/span> local-zone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone public interface &lt;span class="s1">&amp;#39;pppoe0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># define firewall policy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">10&lt;/span> action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">10&lt;/span> destination address &lt;span class="s1">&amp;#39;192.168.68.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">10&lt;/span> destination port &lt;span class="s1">&amp;#39;53&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">10&lt;/span> protocol &lt;span class="s1">&amp;#39;udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">11&lt;/span> action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">11&lt;/span> icmp type-name &lt;span class="s1">&amp;#39;echo-request&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-local rule &lt;span class="m">11&lt;/span> protocol &lt;span class="s1">&amp;#39;icmp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-private default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-private rule &lt;span class="m">10&lt;/span> action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-private rule &lt;span class="m">10&lt;/span> destination address &lt;span class="s1">&amp;#39;192.168.68.1&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-private rule &lt;span class="m">10&lt;/span> destination port &lt;span class="s1">&amp;#39;53&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-private rule &lt;span class="m">10&lt;/span> protocol &lt;span class="s1">&amp;#39;udp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name dmz-public default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name local-dmz default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name local-private default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name local-public default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name private-dmz default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name private-local default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Allow ping&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name private-local rule &lt;span class="m">1&lt;/span> action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name private-local rule &lt;span class="m">1&lt;/span> icmp type-name &lt;span class="s1">&amp;#39;echo-request&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name private-local rule &lt;span class="m">1&lt;/span> protocol &lt;span class="s1">&amp;#39;icmp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name private-public default-action &lt;span class="s1">&amp;#39;accept&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name public-dmz default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name public-local default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall name public-private default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone dmz default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone private default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone public default-action &lt;span class="s1">&amp;#39;drop&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone dmz from &lt;span class="nb">local&lt;/span> firewall name &lt;span class="s1">&amp;#39;local-dmz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone dmz from private firewall name &lt;span class="s1">&amp;#39;private-dmz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone dmz from public firewall name &lt;span class="s1">&amp;#39;public-dmz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone &lt;span class="nb">local&lt;/span> from dmz firewall name &lt;span class="s1">&amp;#39;dmz-local&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone &lt;span class="nb">local&lt;/span> from private firewall name &lt;span class="s1">&amp;#39;private-local&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone &lt;span class="nb">local&lt;/span> from public firewall name &lt;span class="s1">&amp;#39;public-local&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone private from dmz firewall name &lt;span class="s1">&amp;#39;dmz-private&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone private from &lt;span class="nb">local&lt;/span> firewall name &lt;span class="s1">&amp;#39;local-private&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone private from public firewall name &lt;span class="s1">&amp;#39;public-private&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone public from dmz firewall name &lt;span class="s1">&amp;#39;dmz-public&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone public from &lt;span class="nb">local&lt;/span> firewall name &lt;span class="s1">&amp;#39;local-public&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> zone-policy zone public from private firewall name &lt;span class="s1">&amp;#39;private-public&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall all-ping &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall broadcast-ping &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall config-trap &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall receive-redirects &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall send-redirects &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall source-validation &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall syn-cookies &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall twa-hazards-protection &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall ip-src-route &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall ipv6-receive-redirects &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall ipv6-src-route &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> firewall log-martians &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>How to Install driver of Mellanox ConnetcX 3 10Gbps Network Adpater in Promxox-VE 5.x or Debian 9</title><link>https://echowings.github.io/p/how-to-install-driver-of-mellanox-connetcx-3-10gbps-network-adpater-in-promxox-ve-5.x-or-debian-9/</link><pubDate>Wed, 05 Jun 2019 11:52:23 +0800</pubDate><guid>https://echowings.github.io/p/how-to-install-driver-of-mellanox-connetcx-3-10gbps-network-adpater-in-promxox-ve-5.x-or-debian-9/</guid><description>&lt;h1 id="how-to-install-dirver-of-mellanox-connectx-3-10gbps-netowrk-adapter-in-proxmox-ve-5x-or-diban-9">How to install dirver of mellanox ConnectX 3 10Gbps netowrk adapter in proxmox-ve 5.x or diban 9&lt;/h1>
&lt;p>To &lt;/p>
&lt;h2 id="install-dependencies-software">Install dependencies software&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#dependencies&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get -y install debhelper autotools-dev dkms zlib1g-dev python
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget quilt python-libxml2 swig dpatch graphviz chrpath pve-headers
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="download-driver-for-mellanox-connectx-3-for-debian-96">Download driver for mellanox connectx 3 for debian 9.6&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">wget http://content.mellanox.com/ofed/MLNX_EN-4.6-1.0.1.1/mlnx-en-4.6-1.0.1.1-debian9.6-x86_64.tgz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="install-drivers">Install drivers&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">tar -zxvf mlnx-en-4.6-1.0.1.1-debian9.6-x86_64.tgz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> mlnx-en-4.6-1.0.1.1-debian9.6-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod +x install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./install --skip-distro-check
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="swell">Swell&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="http://www.mellanox.com/page/products_dyn?product_family=27" target="_blank" rel="noopener"
>Mellanox EN Driver for Linux
&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://forums.servethehome.com/index.php?resources/install-mellanox-driver-proxmox-ve-5-1.35/" target="_blank" rel="noopener"
>How-to Guide Install Mellanox Driver Proxmox VE 5.1&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Vyos How to Setup Wireguard</title><link>https://echowings.github.io/p/vyos-how-to-setup-wireguard/</link><pubDate>Wed, 17 Apr 2019 12:31:08 +0800</pubDate><guid>https://echowings.github.io/p/vyos-how-to-setup-wireguard/</guid><description>&lt;h1 id="how-to-conifugre-wireguard-in-vyos">How to conifugre wireguard in vyos&lt;/h1>
&lt;p>WireGuard is an extremely simple yet fast and modern VPN that utilizes state-of-the-art &lt;a class="link" href="https://www.wireguard.com/protocol/" target="_blank" rel="noopener"
>cryptography&lt;/a>.&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.wireguard.com/" target="_blank" rel="noopener"
>Wireguard&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Today I will try to deploy wireguard with two vyos .&lt;/p>
&lt;h2 id="site-to-sit-mode">Site-to-Sit mode&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Toplogy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>--------------------------------&lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>---------------------------------&lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Server &lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> Client &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>-----cloud ----&lt;span class="p">|&lt;/span> wan:&lt;span class="si">${&lt;/span>&lt;span class="nv">wan&lt;/span>&lt;span class="p">-address&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> wireguard tunnel interface:wg01&lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span> Wireguard tunnel interface:wg01 &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>--------------------------------&lt;span class="p">|&lt;/span> &lt;span class="p">|&lt;/span>---------------------------------&lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="server-configuration">Server configuration&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Generates a new keypair, if one exists already is asks you if you want to overwrite the existing one.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">generate wireguard keypair
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Show the private key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show wireguard privkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Show the public key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show wireguard pubkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Enter configuration mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#set virtual network interfaces for wireguard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 address &lt;span class="s1">&amp;#39;172.16.100.1/24&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set Wireguard listen port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 port &lt;span class="s1">&amp;#39;50100&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Add CLIENT1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set wireguard allow client ip ranges to access.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer CLIENT1 allowed-ips &lt;span class="s1">&amp;#39;172.16.100.2/32&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set how offten to send keep alives in seconds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer CLIENT1 persistent-keepalive &lt;span class="s1">&amp;#39;15&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set presharekey&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer CLIENT1 preshared-key gLdIlCM/AsobjfDgFK/cdgsAcjILTzLY4df5BskRcqY&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set client public key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer CLIENT1 pubkey &lt;span class="s1">&amp;#39;${client-pubkey}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#set static routing.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> protocols static interface-route &lt;span class="s1">&amp;#39;172.16.100.0/24&amp;#39;&lt;/span> next-hop-interface wg01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#make configuration applied&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Save configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="client-configuration">Client configuration&lt;/h3>
&lt;h4 id="1-vyos-wireguard-client">1. vyos wireguard client&lt;/h4>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Generates a new keypair, if one exists already is asks you if you want to overwrite the existing one.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">generate wireguard keypair
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Show the private key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show wireguard privkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Show the public key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show wireguard pubkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set wireguard virtual network interfaces&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 address &lt;span class="s1">&amp;#39;172.16.100.2/32&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#set wireguard accept packets of network.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer SERVER allow-ips &lt;span class="s1">&amp;#39;0.0.0.0/0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set connection to server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer SERVER endpoint &lt;span class="s1">&amp;#39;${server-wan-address}:50100&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set how offten to send keep alives in seconds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer SERVEr persistent-keepalive &lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set public key for server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer SERVER pubkey &lt;span class="s1">&amp;#39;${server-pubkey}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Set presharekey&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> interfaces wireguard wg01 peer SERVER preshared-key gLdIlCM/AsobjfDgFK/cdgsAcjILTzLY4df5BskRcqY&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#set static routing to client.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> protocols static interface-route &lt;span class="s1">&amp;#39;172.16.100.0/24&amp;#39;&lt;/span> next-hop-interface wg01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Make the settings applied!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#save configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Test wireguard connection&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="2-macos-wireguard-client">2. macos wireguard client&lt;/h5>
&lt;ol>
&lt;li>Download wireguard client for macos: &lt;a class="link" href="https://itunes.apple.com/us/app/wireguard/id1451685025?ls=1&amp;amp;mt=12" target="_blank" rel="noopener"
>Download from AppStore&lt;/a>&lt;/li>
&lt;li>set configure like this&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="err">Interface&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">PrivateKey&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="err">AJ&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="err">oJcAbxCmeovofOMrJooMMlLMNNKGWuTqffF&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="err">oXVU=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Address&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="mf">100.3&lt;/span>&lt;span class="err">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">DNS&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="err">Peer&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">PublicKey&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="err">m&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="err">oJcAbxCmeovofOMrPCCCDkGWuTqfkGWufeovofEII=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">PresharedKey&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="err">k&lt;/span>&lt;span class="mi">82&lt;/span>&lt;span class="err">ffjxKzt&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="err">vy&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="err">JR&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="err">lUMRUj&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="err">eH&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="err">PGRkLgqk)knYIHaM=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">AllowedIPs&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="err">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="err">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Endpoint&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="err">$WIREGUARD_SERVER_ADDRESS:$PORT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">PersistentKeepalive&lt;/span> &lt;span class="err">=&lt;/span> &lt;span class="mi">15&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="3-andoridios">3. andorid/ios&lt;/h4>
&lt;ol>
&lt;li>Edit a configuration and save it as a config file.&lt;/li>
&lt;li>install qeencode&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install qrencode
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qrencode
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">qrencode -t ansiutf8 &amp;lt; client_wireguard_ios.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>with wireguard client scan qr to confirm it.&lt;/li>
&lt;/ol>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://wiki.vyos.net/wiki/Wireguard" target="_blank" rel="noopener"
>Wireguard&lt;/a>&lt;/li>
&lt;li>&lt;/li>
&lt;/ul></description></item><item><title>Deploy Overture With Docker and Freebsd</title><link>https://echowings.github.io/p/deploy-overture-with-docker-and-freebsd/</link><pubDate>Tue, 18 Dec 2018 00:44:13 +0800</pubDate><guid>https://echowings.github.io/p/deploy-overture-with-docker-and-freebsd/</guid><description>&lt;h1 id="run-overture-on-docker-and-freebsd-12">Run overture on Docker and FreeBSD 12&lt;/h1>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">ENV&lt;/span> foo /overture&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">WORKDIR&lt;/span>&lt;span class="s"> ${foo}&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y ca-certificates&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> &lt;span class="nb">printf&lt;/span> &lt;span class="s2">&amp;#34;deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse\n deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\n deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\n deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse&amp;#34;&lt;/span> &amp;gt; /etc/apt/sources.list&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apt-get update&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apt-get upgrade -y&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apt-get install -y wget curl unzip apt-utils vim&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> &lt;span class="nb">cd&lt;/span> /overture&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> wget https://github.com/shawn1m/overture/releases/download/v1.5-rc1/overture-linux-amd64.zip&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> unzip overture-linux-amd64.zip&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> curl https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt &lt;span class="p">|&lt;/span> base64 -d &lt;span class="p">|&lt;/span> sort -u &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;/^$\|@@/d&amp;#39;&lt;/span>&lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s#!.\+##; s#|##g; s#@##g; s#http:\/\/##; s#https:\/\/##;&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;/\*/d; /apple\.com/d; /sina\.cn/d; /sina\.com\.cn/d; /baidu\.com/d; /qq\.com/d&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;/^[0-9]\+\.[0-9]\+\.[0-9]\+\.[0-9]\+$/d&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> grep &lt;span class="s1">&amp;#39;^[0-9a-zA-Z\.-]\+$&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> grep &lt;span class="s1">&amp;#39;\.&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s#^\.\+##&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sort -u &amp;gt; /tmp/temp_gfwlist.txt&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> curl https://raw.githubusercontent.com/hq450/fancyss/master/rules/gfwlist.conf &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s/ipset=\/\.//g; s/\/gfwlist//g; /^server/d&amp;#39;&lt;/span> &amp;gt; /tmp/temp_koolshare.txt&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> cat /tmp/temp_gfwlist.txt /tmp/temp_koolshare.txt &lt;span class="p">|&lt;/span> sort -u &amp;gt; gfw_all_domain.txt&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> wget https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> &lt;span class="nb">printf&lt;/span> &lt;span class="s1">&amp;#39;{ \n &amp;#34;BindAddress&amp;#34;: &amp;#34;:53&amp;#34;,\n &amp;#34;PrimaryDNS&amp;#34;: [\n {\n &amp;#34;Name&amp;#34;: &amp;#34;DNSPod&amp;#34;,\n &amp;#34;Address&amp;#34;: &amp;#34;114.114.114.114:53&amp;#34;,\n &amp;#34;Protocol&amp;#34;: &amp;#34;udp&amp;#34;,\n &amp;#34;SOCKS5Address&amp;#34;: &amp;#34;&amp;#34;,\n &amp;#34;Timeout&amp;#34;: 6,\n &amp;#34;EDNSClientSubnet&amp;#34;: {\n &amp;#34;Policy&amp;#34;: &amp;#34;auto&amp;#34;,\n &amp;#34;ExternalIP&amp;#34;: &amp;#34;222.90.74.60&amp;#34;,\n &amp;#34;NoCookie&amp;#34;: true\n }\n }\n ],\n &amp;#34;AlternativeDNS&amp;#34;: [\n {\n &amp;#34;Name&amp;#34;: &amp;#34;OpenDNS&amp;#34;,\n &amp;#34;Address&amp;#34;: &amp;#34;208.67.222.222:443&amp;#34;,\n &amp;#34;Protocol&amp;#34;: &amp;#34;tcp&amp;#34;,\n &amp;#34;SOCKS5Address&amp;#34;: &amp;#34;&amp;#34;,\n &amp;#34;Timeout&amp;#34;: 6,\n &amp;#34;EDNSClientSubnet&amp;#34;: {\n &amp;#34;Policy&amp;#34;: &amp;#34;manual&amp;#34;,\n &amp;#34;ExternalIP&amp;#34;: &amp;#34;202.60.225.114&amp;#34;,\n &amp;#34;NoCookie&amp;#34;: true\n }\n }\n ],\n &amp;#34;OnlyPrimaryDNS&amp;#34;: false,\n &amp;#34;IPv6UseAlternativeDNS&amp;#34;: false,\n &amp;#34;IPNetworkFile&amp;#34;: {\n &amp;#34;Primary&amp;#34;: &amp;#34;./china_ip_list.txt&amp;#34;,\n &amp;#34;Alternative&amp;#34;: &amp;#34;./ip_network_alternative_sample&amp;#34;\n },\n &amp;#34;DomainFile&amp;#34;: {\n &amp;#34;Primary&amp;#34;: &amp;#34;./domain_primary_sample&amp;#34;,\n &amp;#34;Alternative&amp;#34;: &amp;#34;./gfw_all_domain.txt&amp;#34;\n },\n &amp;#34;HostsFile&amp;#34;: &amp;#34;./hosts_sample&amp;#34;,\n &amp;#34;MinimumTTL&amp;#34;: 0,\n &amp;#34;CacheSize&amp;#34; : 0,\n &amp;#34;RejectQtype&amp;#34;: [255]\n }&amp;#39;&lt;/span> &amp;gt; config.json&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;./overture-linux-amd64&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c">#ENTRYPOINT [&amp;#34;./overture-linux-amd64&amp;#34;]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="freebsd-rcd-file">FreeBSD rc.d file&lt;/h2>
&lt;p>&lt;code>cat /usr/local/etc/rc.d/overture&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-rc.d" data-lang="rc.d">&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span>&lt;span class="o">!/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">$FreeBSD&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">head&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">net&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">overture&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">files&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">overture&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">in&lt;/span> &lt;span class="mi">335066&lt;/span> &lt;span class="mi">2018&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">18&lt;/span> &lt;span class="mi">11&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">33&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="n">SteveDong&lt;/span> &lt;span class="n">$&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">PROVIDE&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">overture&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">REQUIRE&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">LOGIN&lt;/span> &lt;span class="n">cleanvar&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">KEYWORD&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">shutdown&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">Add&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">following&lt;/span> &lt;span class="n">lines&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">conf&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">overture&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">overture_enable&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="kt">bool&lt;/span>&lt;span class="o">):&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="s">&amp;#34;NO&amp;#34;&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="k">default&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">Set&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="s">&amp;#34;YES&amp;#34;&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">overture&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">overture_config&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">):&lt;/span> &lt;span class="n">overture&lt;/span> &lt;span class="n">config&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">Default&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="s">&amp;#34;/usr/local/etc/overture/config.json&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">.&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">subr&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;overture&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">rcvar&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">overture_enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load_rc_config&lt;/span> &lt;span class="n">$name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">:&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_enable&lt;/span>&lt;span class="o">:=&lt;/span>&lt;span class="s">&amp;#34;NO&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">:&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_user&lt;/span>&lt;span class="o">:=&lt;/span>&lt;span class="s">&amp;#34;root&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">:&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_group&lt;/span>&lt;span class="o">:=&lt;/span>&lt;span class="s">&amp;#34;nobody&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">error_log_file&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/var/log/overture_error&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_args&lt;/span>&lt;span class="o">:=&lt;/span>&lt;span class="s">&amp;#34;-p ${cpu_core} -c ${overture_config} -l ${logfile}&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">:&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_config&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/usr/local/etc/overture/config.json&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">command&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/usr/sbin/daemon&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">procname&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/usr/local/bin/overture&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pidfile&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/var/run/overture.pid&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logfile&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/var/log/overture&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">error_log_file&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/var/log/overture_error&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">requried_files&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;${overture_config}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span> &lt;span class="n">find&lt;/span> &lt;span class="n">how&lt;/span> &lt;span class="n">many&lt;/span> &lt;span class="n">cores&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">computer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cpu_core&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">$&lt;/span>&lt;span class="o">(&lt;/span>&lt;span class="n">cat&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dmesg&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="na">boot&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="n">CPU&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="n">FreeBSD&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">awk&lt;/span> &lt;span class="o">{&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="n">print&lt;/span> &lt;span class="n">$5&lt;/span>&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">overture_args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;-p ${cpu_core} -c ${overture_config} -l ${logfile} 2&amp;gt;&amp;amp;1 &amp;gt; $error_log_file&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">command_args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;-p ${pidfile} /usr/bin/env ${procname} ${overture_args}&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">start_precmd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">overture_startprecmd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">overture_startprecmd&lt;/span>&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">pidfile&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">];&lt;/span> &lt;span class="n">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_user&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_group&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">pidfile&lt;/span>&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">logfile&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">];&lt;/span> &lt;span class="n">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_user&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_group&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">logfile&lt;/span>&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="o">!&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">e&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">error_log_file&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">];&lt;/span> &lt;span class="n">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">install&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_user&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">g&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">overture_group&lt;/span>&lt;span class="o">}&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">dev&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="kc">null&lt;/span> &lt;span class="n">$&lt;/span>&lt;span class="o">{&lt;/span>&lt;span class="n">error_log_file&lt;/span>&lt;span class="o">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">load_rc_config&lt;/span> &lt;span class="n">$name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">run_rc_command&lt;/span> &lt;span class="s">&amp;#34;$1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Building Network With Vyos 01---Basic Installing and Configuration</title><link>https://echowings.github.io/p/building-network-with-vyos-01---basic-installing-and-configuration/</link><pubDate>Fri, 26 Oct 2018 22:44:02 +0800</pubDate><guid>https://echowings.github.io/p/building-network-with-vyos-01---basic-installing-and-configuration/</guid><description>&lt;h1 id="building-network-with-vyos-01basic-installing-and-configuration">Building Network With Vyos.-.01.Basic Installing and Configuration&lt;/h1>
&lt;p>Vyos is a debian base router. it is fork form vyatta core.It is very stable and fast router OS. It hasnt web UI, but only command line configration just like JUNOS.&lt;/p>
&lt;p>At now, vyos version will be vyos version 1.2 released. I will wirte the turtural with vyos 1.2RC4.&lt;/p>
&lt;h2 id="install-vyos">Install vyos&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>Download vyos form the office website:&lt;/p>
&lt;ul>
&lt;li>Download Link: &lt;a class="link" href="https://downloads.vyos.io/testing/1.2.0-rc4/vyos-1.2.0-rc4-amd64.iso" target="_blank" rel="noopener"
>vyos-1.2.0-rc-4-amd64&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="write-iso-image-to-usb-disk">Write iso image to usb disk&lt;/h2>
&lt;ul>
&lt;li>Linux and Mac:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ddi &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>vyos-1.2.0-rc-4-amd64.iso &lt;span class="nv">of&lt;/span>&lt;span class="o">=&lt;/span>/dev/&lt;span class="nv">$yourusbdisk&lt;/span> &lt;span class="nv">bs&lt;/span>&lt;span class="o">=&lt;/span>1M
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Windows:&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>download Rufus: &lt;a class="link" href="https://rufus.ie/en_IE" target="_blank" rel="noopener"
>&lt;strong>rufus&lt;/strong>&lt;/a>&lt;/li>
&lt;li>select &lt;code>dd&lt;/code> mode to write disk.&lt;/li>
&lt;/ol>
&lt;h2 id="install-vyos-with-wizard">Install vyos with wizard.&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>press &lt;code>F11&lt;/code> or set COMS to boot from usb.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Enter Default username and password to login livecd.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>vyos login: vyos
Password: vyos&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Write image to local driver:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">```bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">install image
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Reboot System to boot from local disk.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">reboot now
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="basic-command">Basic Command&lt;/h2>
&lt;p>vyos command line include 2 mode: Operation mode and configure mode.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Operation Mode
shell command start with $.
These command usually show sysytem. information,reboot/shutdown system.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Configure Mode
shell command start with #.
These command usually change configuration of vyos.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="operation-mode">Operation Mode&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Enter configure mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Exit to operation Mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Check vyos version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Check vyos running time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show system uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Check system time and timezone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show date
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Reboot system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Shutdown System&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">poweroff now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#upgrade system image version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">add system image &lt;span class="nv">$URL_or_path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Reset configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Enter config mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">configure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#loading default configure&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">load /opt/vyatta/etc/config.boot.default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># commit loading default configure&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># save to default boot configure file.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">save
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Exit configure mode&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Reboot system now to finish loading default configuration.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#bonding&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;lt;conitune&amp;hellip;&amp;gt;&lt;/p></description></item></channel></rss>