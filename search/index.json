[{"content":"Working with Etcd Today, we will learn how to interactve with etcd . to backup and restore the etcd database. First thing first, let\u0026rsquo;s check the etcd pod name in our kubernetes cluster. Let\u0026rsquo;s go!\nCheck etcd pod name Run the command on master node to get the etcd pod name\n1 kubectl get pods -n kube-system output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 root@ubuntu-k8s-master:/home/ubuntu# kubectl get pods -n kube-system NAME READY STATUS RESTARTS AGE calico-kube-controllers-7b8458594b-5d84q 1/1 Running 86 (104m ago) 26h calico-node-2l8mt 1/1 Running 2 (104m ago) 2d17h calico-node-hrfjc 1/1 Running 2 (105m ago) 2d17h calico-node-rkwth 1/1 Running 5 (105m ago) 2d17h coredns-64897985d-cb85v 1/1 Running 1 (104m ago) 26h coredns-64897985d-fp25w 1/1 Running 1 (105m ago) 26h etcd-ubuntu-k8s-master 1/1 Running 73 (17m ago) 2d18h kube-apiserver-ubuntu-k8s-master 1/1 Running 63 (15m ago) 26h kube-controller-manager-ubuntu-k8s-master 1/1 Running 8 (105m ago) 26h kube-proxy-5xrhj 1/1 Running 2 (105m ago) 26h kube-proxy-qqkbz 1/1 Running 1 (105m ago) 26h kube-proxy-t7l2p 1/1 Running 1 (104m ago) 26h kube-scheduler-ubuntu-k8s-master 1/1 Running 7 (105m ago) 26h metrics-server-7cf8b65d65-wnvtd 1/1 Running 2 (105m ago) 2d17h My single kubernetes cluster has etcd pod named etcd-ubuntu-k8s-master\nExporing the ETCD cluster pod 1 2 # kubectl describe po \u0026lt;etcd-podnam\u0026gt; -n kube-system kubectl describe po etcd-ubuntu-k8s-master output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 root@ubuntu-k8s-master:/home/ubuntu# kubectl describe po etcd-ubuntu-k8s-master -n kube-system Name: etcd-ubuntu-k8s-master Namespace: kube-system Priority: 2000001000 Priority Class Name: system-node-critical Node: ubuntu-k8s-master/192.168.11.71 Start Time: Mon, 14 Nov 2022 07:54:51 +0000 Labels: component=etcd tier=control-plane Annotations: kubeadm.kubernetes.io/etcd.advertise-client-urls: https://192.168.11.71:2379 kubernetes.io/config.hash: 0855baf22e98bdcfb39a80e74a5324cb kubernetes.io/config.mirror: 0855baf22e98bdcfb39a80e74a5324cb kubernetes.io/config.seen: 2022-11-12T16:24:44.452715208Z kubernetes.io/config.source: file seccomp.security.alpha.kubernetes.io/pod: runtime/default Status: Running IP: 192.168.11.71 IPs: IP: 192.168.11.71 Controlled By: Node/ubuntu-k8s-master Containers: etcd: Container ID: containerd://65bbf08b85d61fe8ab3fef0224bce17dd48997fb59d6f2bc23a638ba729d00e0 Image: k8s.gcr.io/etcd:3.5.1-0 Image ID: k8s.gcr.io/etcd@sha256:64b9ea357325d5db9f8a723dcf503b5a449177b17ac87d69481e126bb724c263 Port: \u0026lt;none\u0026gt; Host Port: \u0026lt;none\u0026gt; Command: etcd --advertise-client-urls=https://192.168.11.71:2379 --cert-file=/etc/kubernetes/pki/etcd/server.crt --client-cert-auth=true --data-dir=/var/lib/etcd --experimental-initial-corrupt-check=true --initial-advertise-peer-urls=https://192.168.11.71:2380 --initial-cluster=ubuntu-k8s-master=https://192.168.11.71:2380 --key-file=/etc/kubernetes/pki/etcd/server.key --listen-client-urls=https://127.0.0.1:2379,https://192.168.11.71:2379 --listen-metrics-urls=http://127.0.0.1:2381 --listen-peer-urls=https://192.168.11.71:2380 --name=ubuntu-k8s-master --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt --peer-client-cert-auth=true --peer-key-file=/etc/kubernetes/pki/etcd/peer.key --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt --snapshot-count=10000 --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt State: Running Started: Tue, 15 Nov 2022 10:22:56 +0000 Last State: Terminated Reason: Error Exit Code: 2 Started: Tue, 15 Nov 2022 10:17:48 +0000 Finished: Tue, 15 Nov 2022 10:17:48 +0000 Ready: True Restart Count: 73 Requests: cpu: 100m memory: 100Mi Liveness: http-get http://127.0.0.1:2381/health delay=10s timeout=15s period=10s #success=1 #failure=8 Startup: http-get http://127.0.0.1:2381/health delay=10s timeout=15s period=10s #success=1 #failure=24 Environment: \u0026lt;none\u0026gt; Mounts: /etc/kubernetes/pki/etcd from etcd-certs (rw) /var/lib/etcd from etcd-data (rw) Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled True Volumes: etcd-certs: Type: HostPath (bare host directory volume) Path: /etc/kubernetes/pki/etcd HostPathType: DirectoryOrCreate etcd-data: Type: HostPath (bare host directory volume) Path: /var/lib/etcd HostPathType: DirectoryOrCreate QoS Class: Burstable Node-Selectors: \u0026lt;none\u0026gt; Tolerations: :NoExecute op=Exists Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Pulled 16m kubelet Container image \u0026#34;k8s.gcr.io/etcd:3.5.1-0\u0026#34; already present on machine Normal Created 16m kubelet Created container etcd Normal Started 16m kubelet Started container etcd We need remember\n1 2 3 4 5 # etcd data directory --data-dir=/var/lib/etcd # Etcd endpoint --listen-client-urls=https://127.0.0.1:2379,https://192.168.11.71:2379 Listing etcd cluster members 1 kubectl exec etcd-ubuntu-k8s-master -n kube-system -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --write-out=table member list\u0026#34; output:\n1 2 3 4 5 6 root@ubuntu-k8s-master:/home/ubuntu# kubectl exec etcd-ubuntu-k8s-master -n kube-system -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl member list --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --write-out=table\u0026#34; +------------------+---------+-------------------+-----------------------+----------------------------+------------+ | ID | STATUS | NAME | PEER ADDRS | CLIENT ADDRS | IS LEARNER | +------------------+---------+-------------------+-----------------------+----------------------------+------------+ | 8e9e05c52164694d | started | ubuntu-k8s-master | http://localhost:2380 | https://192.168.11.71:2379 | false | +------------------+---------+-------------------+-----------------------+----------------------------+------------+ Checking the etcd cluster status ETCDCTL_API=3 etcdctl endpoint status\n1 kubectl -n kube-system exec etcd-ubuntu-k8s-master -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl --endpoints=https://192.168.11.71:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --write-out=table endpoint status\u0026#34; output:\n1 2 3 4 5 +----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+ | ENDPOINT | ID | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS | +----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+ | https://192.168.11.71:2379 | 8e9e05c52164694d | 3.5.1 | 10 MB | true | false | 2 | 32504 | 32504 | | +----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+ 1 kubectl -n kube-system exec etcd-ubuntu-k8s-master -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl --endpoints=https://192.168.11.71:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --write-out=table endpoint health \u0026#34; output:\n1 2 3 4 5 +----------------------------+--------+-------------+-------+ | ENDPOINT | HEALTH | TOOK | ERROR | +----------------------------+--------+-------------+-------+ | https://192.168.11.71:2379 | true | 14.261475ms | | +----------------------------+--------+-------------+-------+ Installing etcd 1 2 3 4 wget https://github.com/etcd-io/etcd/releases/download/v3.5.5/etcd-v3.5.5-linux-amd64.tar.gz tar -zxvf etcd-v3.5.5-linux-amd64.tar.gz sudo mv etcd-v3.5.5-linux-amd64/etcd* /usr/local/bin etcdctl version or\n1 kubectl -n kube-system exec etcd-ubuntu-k8s-master -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl version\u0026#34; Backing up etcd SSH to the etcd cluster node. \u0026ndash;skip\u0026ndash;\ncheck out etcd status 1 2 3 # kubectl describe \u0026lt;etcd-podname\u0026gt; kubectl describe etcd-ubuntu-k8s-master kubectl -n kube-system exec etcd-ubuntu-k8s-master -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl --endpoints=https://192.168.11.71:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --write-out=table endpoint status\u0026#34; Perform the etcd backup 1 sudo kubectl -n kube-system exec etcd-ubuntu-k8s-master -- sh -c \u0026#34;ETCDCTL_API=3 etcdctl --endpoints=https://192.168.11.71:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot save\u0026#34; output\n1 2 3 4 5 6 snapshotdb\u0026#34;{\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1668525609.0965416,\u0026#34;caller\u0026#34;:\u0026#34;snapshot/v3_snapshot.go:68\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;created temporary db file\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;snapshotdb.part\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1668525609.1151485,\u0026#34;logger\u0026#34;:\u0026#34;client\u0026#34;,\u0026#34;caller\u0026#34;:\u0026#34;v3/maintenance.go:211\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;opened snapshot stream; downloading\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1668525609.115235,\u0026#34;caller\u0026#34;:\u0026#34;snapshot/v3_snapshot.go:76\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;fetching snapshot\u0026#34;,\u0026#34;endpoint\u0026#34;:\u0026#34;https://192.168.11.71:2379\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1668525609.3567731,\u0026#34;logger\u0026#34;:\u0026#34;client\u0026#34;,\u0026#34;caller\u0026#34;:\u0026#34;v3/maintenance.go:219\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;completed snapshot read; closing\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1668525609.393935,\u0026#34;caller\u0026#34;:\u0026#34;snapshot/v3_snapshot.go:91\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;fetched snapshot\u0026#34;,\u0026#34;endpoi:nt\u0026#34;:\u0026#34;https://192.168.11.71:2379\u0026#34;,\u0026#34;size\u0026#34;:\u0026#34;10 MB\u0026#34;,\u0026#34;took\u0026#34;:\u0026#34;now\u0026#34;} {\u0026#34;level\u0026#34;:\u0026#34;info\u0026#34;,\u0026#34;ts\u0026#34;:1668525609.3941526,\u0026#34;caller\u0026#34;:\u0026#34;snapshot/v3_snapshot.go:100\u0026#34;,\u0026#34;msg\u0026#34;:\u0026#34;saved\u0026#34;,\u0026#34;path\u0026#34;:\u0026#34;snapshotdb\u0026#34;} Exit the master nodes Restoring etcd SSH to the etcd cluster node. \u0026ndash; skip \u0026ndash;\nCheck the etcd status 1 2 3 4 5 sudo ETCDCTL_API=3 etcdctl --endpoint https://192.168.11.71:2379 \\ --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --cert=/etc/kubernetes/pki/etcd/server.crt \\ --key=/etc/kubernetes/pki/etcd/server.key \\ restore snapshotdb Restore the etcd backup 1 2 3 4 5 6 sudo ETCDCTL_API=3 etcdctl --endpoint https://192.168.11.71:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --cert=/etc/kubernetes/pki/etcd/server.crt \\ --key=/etc/kubernetes/pki/etcd/server.key \\ --write-out=table \\ endpoint status Exit the master node \u0026ndash;skip\u0026ndash;\n","date":"2022-11-15T18:32:33+08:00","image":"https://picsum.photos/800/600.webp?random=78542a6a","permalink":"https://echowings.github.io/p/working-with-etcd/","title":"Working With Etcd"},{"content":"How to upgrade kubernetes To upgrade kubernetes I will 2 steps to implement it.\nUpgrade master node Upgrade worker nodes Master node upgrade process Check out the current kubeadm and kubelet version First thing first, login the master node with ssh.\n1 2 3 4 5 6 7 8 kubeadm version kubectl --version ## Running result kubelet --version Kubernetes v1.23.10 kubeadm version kubeadm version: \u0026amp;version.Info{Major:\u0026#34;1\u0026#34;, Minor:\u0026#34;23\u0026#34;, GitVersion:\u0026#34;v1.23.10\u0026#34;, GitCommit:\u0026#34;7e54d50d3012cf3389e43b096ba35300f36e0817\u0026#34;, GitTreeState:\u0026#34;clean\u0026#34;, BuildDate:\u0026#34;2022-08-17T18:31:47Z\u0026#34;, GoVersion:\u0026#34;go1.17.13\u0026#34;, Compiler:\u0026#34;gc\u0026#34;, Platform:\u0026#34;linux/amd64\u0026#34;} Install the new kubeadm version We will upgrade kubernetes from v1.23.10-00 to 1.23.11-00\n1 2 3 4 5 6 7 8 9 10 11 12 13 sudo su # Update apt list apt update # Check the latest version available apt-cache madison kubeadm apt-mark unhold kubeadm \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; apt-get install -y kubeadm=1.23.11-00 \u0026amp;\u0026amp; \\ apt-mark hold kubeadm # Check kubeadm version kubeadm version Plan the kubeadm upgrade 1 kubeadm upgrade plan Apply the kubeadm upgrade 1 kubeadm upgrade apply v1.23.11 Cordon the node 1 2 3 4 # check nodes name kubectl get nodes # drain the master nodes named \u0026#39;ubuntu-k8s-master\u0026#39; kubectl drain ubuntu-k8s-master --ignore-daemonsets Upgrade the kubelet and kubectl 1 2 3 4 5 6 7 apt-mark unhold kubelet kubectl \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; apt-get install -y kubelet=1.23.11-00 kubectl=1.23.11-00 \u0026amp;\u0026amp; \\ apt-mark hold kubelet kubectl # Restart the kubelet sudo systemctl daemon-reload sudo systemctl restart kubelet Uncordon the node 1 kubectl uncordon ubuntu-k8s-master Upgrade Worker Nodes Check out the current kubeadm and kubelet version 1 2 kubeadm version kubelet --version Install the new kubeadm version 1 2 3 4 sudo su apt-mark unhold kubeadm \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; apt-get install -y kubeadm=1.23.11-00 \u0026amp;\u0026amp; \\ apt-mark hold kubeadm Plan the kubeadm upgrade Apply the kubeadm upgrade 1 kubeadm upgrade node cordon the worker node 1 kubectl drain ubuntu-k8s-node01 Upgrade the kubelet 1 2 3 4 5 6 7 apt-mark unhold kubelet kubectl \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; apt-get install -y kubelet=1.23.11-00 kubectl=1.23.11-00 \u0026amp;\u0026amp; \\ apt-mark hold kubelet kubectl # Restart the kubelet for the changes to take effect: sudo systemctl daemon-reload sudo systemctl restart kubelet uncordon the node 1 kubectl uncordon ubuntu-k8s-node01 Exit the worker node ","date":"2022-11-14T15:19:53+08:00","image":"https://picsum.photos/800/600.webp?random=50442c4a","permalink":"https://echowings.github.io/p/how-to-upgrade-kubernetes/","title":"How to Upgrade Kubernetes"},{"content":"How to Install SSHPASS on VyOS 1.3.x how-to-install-sshpass-on- vyos-1.3.x Since vyos 1.3.x base on debian 10, so we can install sshpass 1.06 for debian on vyos 1.3.x\nDownload and install sshpass 1.06 for debian 10 1 2 3 wget http://ftp.de.debian.org/debian/pool/main/s/sshpass/sshpass_1.06-1_amd64.deb sudo dpkg -i sshpass_1.06-1_amd64.deb Run sshpass 1 2 3 4 5 6 7 8 9 10 11 12 13 # run command via ssh without inactively sshpass -p \u0026#39;ssh_password\u0026#39; ssh -t root@ssh_host -p 22 \u0026#39;uptime\u0026#39; # Copy files to remote sshpass -p \u0026#39;ssh_password\u0026#39; scp -P 22 myfile.txt gcadmin@ssh_host # loop running command for i in 192.168.11.5{1..3};do sshpass -p \u0026#39;ssh_password\u0026#39; ssh -t root@$i -p 22 \u0026#39;uptime\u0026#39;;done # Loop copy files for i in host1 host2 host3;do echo $i \u0026amp;\u0026amp; sshpass -p \u0026#39;ssh_password\u0026#39; scp -P 22 myfile.txt gcadmin@$i;done ","date":"2022-11-14T09:09:33+08:00","image":"https://picsum.photos/800/600.webp?random=81ff83c3","permalink":"https://echowings.github.io/p/how-to-install-sshpass-on-vyos-1.3.x/","title":"How to Install Sshpass on Vyos 1.3.x"},{"content":"How to install kubernetes on ubuntu 20.04 Kubernetes is new linux os at nowadays. This is manually install kubernetes on ubuntu 20.04 with kubeadm. I have 3 proxmox ve servers. then I plan to install 3 ubuntu virtual machines on eache proxmox ve server.\nNo. Name OS IP ADDRESS 01 ubuntu-k8s-master ubuntu 20.04 LTS 192.168.11.71 02 ubuntu-k8s-node01 ubuntu 20.04 LTS 192.168.11.72 03 ubuntu-k8s-node02 ubuntu 20.04 LTS 192.168.11.73 Here is my plan to install kubernetes:\nCreate ubuntu 20.04 cloud image on 3 proxmox ve server Delpy 3 ubuntu 20.04 virtual machines on each 3 proxmox ve server.(1 for kubernetes master node, other 2 for kubernetes work nodes) Install kubeadm,kubelet,kubectl,containerd on each nodes(include master node and worker nodes) Initalize Kubernetes on master node and install calico network CNI Let worker nodes join kubernets cluster. Provision 3 ubuntu server on 3 proxmox ve nodes Create ubuntu 20.04 template on 3 proxmox ve nodes Run following command on eache proxmox ve server to create ubuntu 20.04 server template with cloudinit enabled.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 cat \u0026lt;\u0026lt; \u0026#39;EOF\u0026#39; | tee create_ubuntu_20.04_template.sh #!/bin/bash VMID=9003 IMAGE_NAME=\u0026#34;focal-server-cloudimg-amd64.img\u0026#34; VM_NAME=\u0026#34;ubuntu-20.04TLS-template\u0026#34; STORAGE=\u0026#34;SSD\u0026#34; STORAGE_FULL_PATH=\u0026#34;/mnt/pve\u0026#34; VCPUS=4 VM_MEMORY=4096 #STORAGE_FULL_PATH=\u0026#34;/var/lib/vz\u0026#34; # Download ubuntu 20.04 LTS cloud image [ ! -f /var/lib/vz/template/qcow/focal-server-cloudimg-amd64.img ] \u0026amp;\u0026amp; curl -fsSL https://cloud-images.ubuntu.com/focal/current/focal-server-cloudimg-amd64.img -o /var/lib/vz/template/qcow/focal-server-cloudimg-amd64.img qm create $VMID --name ${VM_NAME} \\ --memory ${VM_MEMORY} \\ --net0 virtio,bridge=vmbr0 \\ --cores ${VCPUS} \\ --sockets 1 \\ --cpu cputype=host \\ --description \u0026#34;${VM_NAME}\u0026#34; \\ --kvm 1 \\ --machine q35 qm importdisk $VMID /var/lib/vz/template/qcow/${IMAGE_NAME} ${STORAGE} qm set $VMID --scsihw virtio-scsi-pci --virtio0 ${STORAGE}:${VMID}/vm-$VMID-disk-0.raw qm set $VMID --serial0 socket qm set $VMID --boot c --bootdisk virtio0 qm set $VMID --agent 1 qm set $VMID --hotplug disk,network,usb qm set $VMID --vcpus ${VCPUS} qm set $VMID --vga qxl qm set $VMID --name ${VM_NAME} qm set $VMID --ide2 ${STORAGE}:cloudinit qm set $VMID --serial0 socket --vga serial0 qm set $VMID --sshkey /etc/pve/pub_keys/pub_key.pub qm set $VMID --ciuser ubuntu qm set $VMID --cipassword MyPassW0rd qm set $VMID --ipconfig0 ip=dhcp qm resize $VMID virtio0 +50G qemu-img convert -f raw ${STORAGE_FULL_PATH}/${STORAGE}/images/$VMID/vm-$VMID-disk-0.raw -O qcow2 ${STORAGE_FULL_PATH}/${STORAGE}/images/$VMID/vm-$VMID-disk-0.qcow2 sed -i \u0026#39;s/.raw/.qcow2/g\u0026#39; /etc/pve/qemu-server/${VMID}.conf rm -rf ${STORAGE_FULL_PATH}/${STORAGE}/images/${VMID}/*.raw qm set $VMID --template EOF Run the command on proxmxo ve server to create ubuntu server 20.04 template 1 2 # Run script to create ubuntu 20.04 template bash create_ubuntu_20.04_template.sh Create 3 kubernetes nodes from template Create ubuntu server 20.04 as kubernetes nodes from template\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Run commands on proxmox ve server 01 qm clone 9003 113 --full --name ubuntu-k8s-master qm set 113 --ipconfig0 ip=192.168.11.71/24,gw=192.168.11.1 qm set 113 --onboot 1 # Run commands on proxmox ve server 02 qm clone 9003 113 --full --name ubuntu-k8s-node01 qm set 113 --ipconfig0 ip=192.168.11.72/24,gw=192.168.11.1 qm set 113 --onboot 1 # Run commands on proxmox ve server 03 qm clone 9003 113 --full --name ubuntu-k8s-node02 qm set 113 --ipconfig0 ip=192.168.11.73/24,gw=192.168.11.1 qm set 113 --onboot 1 Install Prerequest packects Change ubuntu sourcelist and update OS then reboot it if necessary. Change ubuntu sourcelist and update packages\n1 2 3 4 5 6 7 source /etc/os-release echo $VERSION_CODENAME [ ! -f /etc/apt/sources.list.bak ] \u0026amp;\u0026amp;mv /etc/apt/sources.list{,.bak} [ ! -f /etc/apt/sources.list ] \u0026amp;\u0026amp;curl -fsSL https://mirrors.ustc.edu.cn/repogen/conf/ubuntu-https-4-${VERSION_CODENAME} -o /etc/apt/sources.list sudo apt-get update sudo apt -y full-upgrade [ -f /var/run/reboot-requried ] \u0026amp;\u0026amp; sudo reboot -f Forwarding IPv4 and letting iptables see bridged traffic 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/kubernetes.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/kubernetes.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Reload sysctl sudo sysctl --system Install containerd runtime 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 sudo apt-get update #sudo apt-get install ca-certificates curl gnupg lsb-release # Install required packages sudo apt install -y curl gnupg2 software-properties-common apt-transport-https ca-certificates lsb-release # Add Docker\u0026#39;s offical GPG key sudo mkdir -p /etc/apt/keyrings [ ! -f /etc/apt/keyrings/docker.gpg ] \u0026amp;\u0026amp;curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg [ ! -f /etc/apt/sources.list.d/docker.list ] \u0026amp;\u0026amp;echo \\ \u0026#34;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\u0026#34; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null # Install sudo apt update sudo apt install -y containerd.io Modify containerd configuration 1 2 3 4 5 6 7 8 [ ! -f /etc/containerd ] \u0026amp;\u0026amp; mkdir -p /etc/containerd sudo rm -rf /etc/containerd/config.toml sudo containerd config default | sudo tee /etc/containerd/config.toml #set plugins.cri.systemd_cgroup = true in /etc/containerd/config.toml sudo sed -i \u0026#39;s/SystemdCgroup\\ =\\ false/SystemdCgroup\\ =\\ true/g\u0026#39; /etc/containerd/config.toml sudo systemctl restart containerd sudo systemctl enable containerd Disable SWAP 1 2 3 4 5 6 # sudo sed -i \u0026#39;/swap/d\u0026#39; /etc/fstab # Search for a swap line and add # (hashtag) sign in front of the line. sudo sed -i \u0026#39;/ swap / s/^\\(.*\\)$/#\\1/g\u0026#39; /etc/fstab sudo swapoff -a sudo mount -a free -h Install kubectl，kubeadm, kubelet 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 sudo apt-get install -y ca-certificates curl apt-transport-https vim git curl wget # if you use Debian 9(stretch) or earlier you would also need to install `apt-transport-https` sudo apt-get install -y apt-transport-https # Download the Google Cloud public signing key [ ! -f /usr/share/keyrings/kubernetes-archive-keyring.gpg ]\u0026amp;\u0026amp;sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg # Add the kubernetes apt repository [ ! -f /etc/apt/sources.list.d/kubernetes.list ] \u0026amp;\u0026amp; echo \u0026#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main\u0026#34; | sudo tee /etc/apt/sources.list.d/kubernetes.list apt update # Chek kubeadm version for us to select the right version of kubernete to install apt-cache madison kubeadm #1.23.10-00 sudo apt-get install -y kubelet=1.23.10-00 kubeadm=1.23.10-00 kubectl=1.23.10-00 # Provent auto update new version # Hold the current version sudo apt-mark hold kubelet kubeadm kubectl # Verify whether kubectl has been successfully installed by running the following command upon the completion of the previous steps: kubectl version --client kubeadm version kubelet --version Setup master node Inital Kubernetes master node 1 2 3 4 5 6 7 sudo kubeadm config images pull kubeadm init --pod-network-cidr=10.244.0.0/16 --upload-certs mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config Install network CNI calico on master node 1 2 3 4 5 kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml # Monitor pod status watch kubectl get pods -n calico-system kubectl get pods -n calico-system -w Option: Single kubernetes nodes to remove taint on master nodes 1 2 3 # Single node k8s #kubectl taint nodes --all node-role.kubernetes.io/master- #kubectl taint nodes --all node-role.kubernetes.io/control-plane- Option: query join command 1 2 # if you forget the join information, you can query it with commands as show below kubeadm token create --print-join-command Option: Reset nodes and try it agaion 1 2 sudo su kubeadm reset -f Setup Worker Nodes 1 2 3 4 sudo kubeadm config images pull kubeadm join 192.168.11.71:6443 --token akn012.rp0e7oxw0qn7b5o3 \\ --discovery-token-ca-cert-hash sha256:f78548da4af356ea8b006531962673b5945dd1c36588e137c6ec44c99d4ad7e1 Check Node status 1 2 kubectl get nodes kubectl get pods -A -o wide Reference Deploy metrics-server\nDeploy kubevirt\nKubernetes Kubevirt DEPLOY A KUBERNETES CLUSTER USING ANSIBLE\nInstall Kubernetes Cluster on Ubuntu 20.04 with kubeadm\n","date":"2022-11-13T18:53:31+08:00","image":"https://picsum.photos/800/600.webp?random=dddca1a9","permalink":"https://echowings.github.io/p/how-to-install-kubernetes-on-ubuntu-20.04-with-kubeadm/","title":"How to install kubernetes on ubuntu 20.04 with kubeadm"},{"content":"Shell Script to Update Cloudflare Ddns Script 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 #!/bin/bash ############## User Configuration ############### # Define programme path # location_path=\u0026#34;/config/scripts/ddns\u0026#34; location_path=$(dirname -- \u0026#34;$0\u0026#34;) # You Registered CloudFlare Mail Account auth_email=\u0026#34;\u0026#34; # CloudFlare Global API Key auth_key=\u0026#34;\u0026#34; # Root Doman Name zone_name=\u0026#34;\u0026#34; # IP Type，Enter \u0026#39;ipv4\u0026#39; or \u0026#39;ipv6\u0026#39; ,at here we got paramter from our input type=$1 # DDNS Domain Name record_name=$2 # WAN INTERFACE INTERFACE=\u0026#34;\u0026#34; ############# Script ############ # The before WAN IP ip_file=\u0026#34;$location_path/$1_$2_ip.txt\u0026#34; # Domain id information # Domain id information id_file=\u0026#34;$location_path/$1_$2_cloudflare.ids\u0026#34; # Log location log_file=\u0026#34;$location_path/cloudflare.log\u0026#34; ################ Don\u0026#39;t change here ############### ################## Function #################### record_type=\u0026#34;\u0026#34; ip=\u0026#34;\u0026#34; zone_identifier=\u0026#34;\u0026#34; record_identifier=\u0026#34;\u0026#34; update=\u0026#34;\u0026#34; # Log function log() { if [ \u0026#34;$1\u0026#34; ]; then echo -e \u0026#34;[$(date)] - $1\u0026#34; \u0026gt;\u0026gt; $log_file fi } #To get local IP address get_ip() { if [ $type == \u0026#34;ipv4\u0026#34; ]; then record_type=\u0026#34;A\u0026#34; ip=$(ip addr | grep ${INTERFACE} -A2 | grep inet | grep -v inet6 | awk \u0026#39;{print $2}\u0026#39;) elif [ $type == \u0026#34;ipv6\u0026#34; ]; then record_type=\u0026#34;AAAA\u0026#34; ip=$(ip addr | grep ${INTERFACE} -A2 | grep inet6 | awk \u0026#39;{print $2}\u0026#39; | cut -d \u0026#39;/\u0026#39; -f1) else echo \u0026#34;Type wrong\u0026#34; log \u0026#34;Type wrong\u0026#34; exit 0 fi } # Check IP changed or not, if there\u0026#39;s no change, then terminal programme check_ip_change() { if [ -f $ip_file ]; then old_ip=$(cat $ip_file) if [ \u0026#34;$ip\u0026#34; == \u0026#34;$old_ip\u0026#34; ]; then echo \u0026#34;IP has not changed.\u0026#34; log \u0026#34;IP has not changed.\u0026#34; exit 0 fi fi } #Get zone_id subdomain ID get_id() { if [ -f $id_file ] \u0026amp;\u0026amp; [ $(wc -l $id_file | cut -d \u0026#34; \u0026#34; -f 1) == 2 ]; then zone_identifier=$(head -1 $id_file) record_identifier=$(tail -1 $id_file) else zone_identifier=$(curl -s -X GET \u0026#34;https://api.cloudflare.com/client/v4/zones?name=$zone_name\u0026#34; -H \u0026#34;X-Auth-Email: $auth_email\u0026#34; -H \u0026#34;X-Auth-Key: $auth_key\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; | grep -Po \u0026#39;(?\u0026lt;=\u0026#34;id\u0026#34;:\u0026#34;)[^\u0026#34;]*\u0026#39; | head -1 ) rec_response_json=`curl -X GET \u0026#34;https://api.cloudflare.com/client/v4/zones/$zone_identifier/dns_records?name=$record_name\u0026#34; -H \u0026#34;X-Auth-Email: $auth_email\u0026#34; -H \u0026#34;X-Auth-Key: $auth_key\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34;` record_identifier=`echo $rec_response_json | grep -Po \u0026#39;(?\u0026lt;=\u0026#34;id\u0026#34;:\u0026#34;)[^\u0026#34;]*\u0026#39;` echo \u0026#34;$zone_identifier\u0026#34; \u0026gt; $id_file echo \u0026#34;$record_identifier\u0026#34; \u0026gt;\u0026gt; $id_file fi } #Update DNS record update_dns() { update=$(curl -s -X PUT \u0026#34;https://api.cloudflare.com/client/v4/zones/$zone_identifier/dns_records/$record_identifier\u0026#34; -H \u0026#34;X-Auth-Email: $auth_email\u0026#34; -H \u0026#34;X-Auth-Key: $auth_key\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; --data \u0026#34;{\\\u0026#34;id\\\u0026#34;:\\\u0026#34;$zone_identifier\\\u0026#34;,\\\u0026#34;type\\\u0026#34;:\\\u0026#34;$record_type\\\u0026#34;,\\\u0026#34;name\\\u0026#34;:\\\u0026#34;$record_name\\\u0026#34;,\\\u0026#34;content\\\u0026#34;:\\\u0026#34;$ip\\\u0026#34;}\u0026#34;) } ################### Main ################### log \u0026#34;Script start.\u0026#34; #Got IP Address get_ip # Check got the right ip address if [ \u0026#34;$ip\u0026#34; == \u0026#34;\u0026#34; ]; then echo \u0026#34;Can not get IP address.Please check your network connection.\u0026#34; log \u0026#34;Can not get IP address.Please check your network connection.\u0026#34; exit 0 fi # Check IP changed or not check_ip_change # Get zone_id and sumdomain record ID get_id # Check get ID successfully or not if [ \u0026#34;$zone_identifier\u0026#34; == \u0026#34;\u0026#34; ]; then echo \u0026#34;Can not get zone_id.\u0026#34; log \u0026#34;Can not get zone_id.\u0026#34; exit 0 elif [ \u0026#34;$record_identifier\u0026#34; == \u0026#34;\u0026#34; ]; then echo \u0026#34;Can not get record_id.\u0026#34; log \u0026#34;Can not get record_id.\u0026#34; exit 0 fi # Update DNS Record update_dns # Check DNS record updated or not if [[ $update == *\u0026#34;\\\u0026#34;success\\\u0026#34;:false\u0026#34;* ]]; then log \u0026#34;API UPDATE FAILED. DUMPING RESULTS:\\n$update\u0026#34; echo -e \u0026#34;API UPDATE FAILED. DUMPING RESULTS:\\n$update\u0026#34; exit 0 else echo \u0026#34;$ip\u0026#34; \u0026gt; $ip_file log \u0026#34;$record_name IP changed to: $ip\u0026#34; echo \u0026#34;$record_name IP changed to: $ip\u0026#34; fi How to run the script 1 2 3 4 5 #update A record sudo bash /config/scripts/ddns/cloudflare-ddns.sh ipv4 \u0026lt;MY_DOMAIN_NAME\u0026gt; #update AAAA record sudo bash /config/scripts/ddns/cloudflare-ddns.sh ipv6 \u0026lt;MY_DOMAIN_NAME\u0026gt; ","date":"2022-10-09T09:50:14+08:00","image":"https://picsum.photos/800/600.webp?random=7257319e","permalink":"https://echowings.github.io/p/shell-script-to-update-cloudflare-ddns/","title":"Shell Script to Update Cloudflare Ddns"},{"content":"How to enable API serivce on VyOS\nHow to enable API serivce on VyOS After these days, I wrote some vyos shell script to auto detect network status and automatacally change some settings. In the way There will be new configuration to loading directly and hold the configuration mode for a longer time. This is not in a smart way.\nAnother better option, What if we can change settings of vyos with api?\nEnable api http service localy Enable apt service with socket mode 1 set service https api socket Test settings 1 curl --unix-socket /run/api.sock -X POST -Fkey=qwerty -Fdata=\u0026#39;{\u0026#34;op\u0026#34;: \u0026#34;showConfig\u0026#34;, \u0026#34;path\u0026#34;: []}\u0026#39; http://localhost/retrieve Enable api https service with let\u0026rsquo;s encryption free ssl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/vbash source /opt/vyatta/etc/functions/script-template configure # Define variable ID=\u0026#34;my_id\u0026#34; APIKEY=\u0026#34;12345\u0026#34; APIPORT=\u0026#34;1234\u0026#34; VHOST=\u0026#34;myvps\u0026#34; FULL_FQDN=\u0026#34;xxx.xxx.xxx\u0026#34; LISTEN_ADDRESS=\u0026#34;IP ADDRESS\u0026#34; EMAIL=\u0026#34;my@emal.com\u0026#34; set service https api key id $ID key $APIKEY set service https certificates certbot domain-name $FULL_FQDN set service https certificates certbot email $EMAIL set service https api strict set service https virtual-host $VHOST listen-address $LISTEN_ADDRESS set service https virtual-host $VHOST listen-port $APIPORT set service https virtual-host $VHOST server-name $FULL_FQDN commit save exit ","date":"2022-04-26T00:17:15+08:00","image":"https://picsum.photos/800/600.webp?random=71ff97d5","permalink":"https://echowings.github.io/p/how-to-enable-http-api-service-on-vyos/","title":"How to Enable Http Api Service on VyOS"},{"content":"You can learn how to build hugo blog with loveit theme. With github action\u0026rsquo;s help you can auto deploy to github page\nInstall Hugo Install theme and plugin 1 2 3 4 5 6 7 8 git init git remote add origin git@github.com:echowings/blogs.git git submodule add https://github.com/dillonzq/LoveIt.git themes/LoveIt git submodule add https://github.com/kaushalmodi/hugo-search-fuse-js.git themes/hugo-search-fuse-js git submodule add --force -b master git@github.com:echowings/echowings.github.io.git public 1 2 3 {{\u0026lt; mermaid \u0026gt;}} GRAPH LR; A--\u0026gt;B ","date":"2022-04-01T18:15:20+08:00","permalink":"https://echowings.github.io/p/how-to-install-hugo-with-loveit-theme/","title":"How to Install Hugo With Loveit Theme"},{"content":"How to deploy vlmcsd with docker-compose 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 FROM alpine:latest as builder WORKDIR /root RUN sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories RUN apk add --no-cache git make build-base \u0026amp;\u0026amp; \\ \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* \u0026amp;\u0026amp; rm -rf /var/cache/apk/* \u0026amp;\u0026amp; \\ git clone --branch master --single-branch https://github.com/Wind4/vlmcsd.git \u0026amp;\u0026amp; \\ cd vlmcsd \u0026amp;\u0026amp; \\ make FROM alpine:latest COPY --from=builder /root/vlmcsd/bin/vlmcsd /vlmcsd RUN apk add --no-cache tzdata EXPOSE 1688/tcp CMD [\u0026#34;/vlmcsd\u0026#34;, \u0026#34;-D\u0026#34;, \u0026#34;-d\u0026#34;, \u0026#34;-t\u0026#34;, \u0026#34;3\u0026#34;, \u0026#34;-e\u0026#34;, \u0026#34;-v\u0026#34;] ","date":"2021-08-22T22:46:37+08:00","permalink":"https://echowings.github.io/p/how-to-deploy-vlmcsd-with-docker-compose/","title":"How to Deploy Vlmcsd With Docker-Compose"},{"content":"#How to batch rename filesname\n1 ls *.mp4| awk -F\u0026#34; 【中文 www.zhongwen.zw 】\u0026#34; \u0026#39;{print \u0026#34;mv \\\u0026#34;\u0026#34;$0\u0026#34;\\\u0026#34; \\\u0026#34;\u0026#34;$1$2\u0026#34;\\\u0026#34;\u0026#34;}\u0026#39; | bash: ","date":"2021-08-01T21:51:14+08:00","permalink":"https://echowings.github.io/p/how-to-batch-rename-filesname/","title":"How to Batch Rename Filesname"},{"content":"How to delete ghost monitor in ceph cluster Today , after I let a new server join pve cluster. ceph mon is stopped. I want to start or delete it , I always got a failed notification. After search and try to fix it. At last I fixed it.Here is what I had do\nIssue description 1 2 3 4 root@xa-autotest-hci04:~# pveceph createmon monitor \u0026#39;xa-autotest-hci04\u0026#39; already exists root@xa-autotest-hci04:~# pveceph mon destroy xa-autotest-hci04 no such monitor id \u0026#39;xa-autotest-hci04\u0026#39; How to fixed it 1 2 3 4 5 6 7 8 9 10 11 12 #stop ceph-mon@xa-autotest-hci04 service systemctl stop ceph-mon@xa-autotest-hci04 #Disable ceph-mon@xa-autotest-hci04 service systemctl disable ceph-mon@xa-autotest-hci04 pveceph purge rm -rf /var/lib/ceph/mon/ceph-xa-autotest-hci04 pveceph createmon #Created symlink /etc/systemd/system/ceph-mon.target.wants/ceph-mon@xa-autotest-hci04.service -\u0026gt; /lib/systemd/system/ceph-mon@.service. ","date":"2021-07-01T14:06:58+08:00","permalink":"https://echowings.github.io/p/how-to-delete-ghost-monitor-in-ceph-cluster/","title":"How to Delete Ghost Monitor in Ceph Cluster"},{"content":"##How to let a new server join the exist HCI cluster\n1. Insall the pve on the server \u0026ndash;skip\u0026mdash;\n2. Let the new server join the pve cluster 1 2 #ssh login the server pvecm add 10.32.4.37 3. configure NTP server 1 2 3 4 5 cat \u0026gt;\u0026gt; /etc/systemd/timesyncd.conf \u0026lt;\u0026lt; EOF NTP=192.168.0.2 192.168.0.3 EOF # Restart systemd-timesyncd service to apply settings systemctl restart systemd-timesyncd 4. Install ceph 1 pveceph install 5. Partition nvme disk partitin 1-6 for block.wal(ceph) partition 7-12 for block.db(ceph) partition 13-18 for bcache 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 parted -s /dev/nvme1n1 mktable gpt parted -s /dev/nvme1n1 mkpart primary 1M 10G parted -s /dev/nvme1n1 mkpart primary 10G 20G parted -s /dev/nvme1n1 mkpart primary 20G 30G parted -s /dev/nvme1n1 mkpart primary 30G 40G parted -s /dev/nvme1n1 mkpart primary 40G 50G parted -s /dev/nvme1n1 mkpart primary 50G 60G parted -s /dev/nvme1n1 mkpart primary 60G 110G parted -s /dev/nvme1n1 mkpart primary 110G 160G parted -s /dev/nvme1n1 mkpart primary 160G 210G parted -s /dev/nvme1n1 mkpart primary 210G 260G parted -s /dev/nvme1n1 mkpart primary 260G 310G parted -s /dev/nvme1n1 mkpart primary 310G 360G parted -s /dev/nvme1n1 mkpart primary 360G 433G parted -s /dev/nvme1n1 mkpart primary 433G 506G parted -s /dev/nvme1n1 mkpart primary 506G 579G parted -s /dev/nvme1n1 mkpart primary 579G 652G parted -s /dev/nvme1n1 mkpart primary 652G 725G parted -s /dev/nvme1n1 mkpart primary 725G 800G parted -s /dev/nvme2n1 mktable gpt parted -s /dev/nvme2n1 mkpart primary 1M 10G parted -s /dev/nvme2n1 mkpart primary 10G 20G parted -s /dev/nvme2n1 mkpart primary 20G 30G parted -s /dev/nvme2n1 mkpart primary 30G 40G parted -s /dev/nvme2n1 mkpart primary 40G 50G parted -s /dev/nvme2n1 mkpart primary 50G 60G parted -s /dev/nvme2n1 mkpart primary 60G 110G parted -s /dev/nvme2n1 mkpart primary 110G 160G parted -s /dev/nvme2n1 mkpart primary 160G 210G parted -s /dev/nvme2n1 mkpart primary 210G 260G parted -s /dev/nvme2n1 mkpart primary 260G 310G parted -s /dev/nvme2n1 mkpart primary 310G 360G parted -s /dev/nvme2n1 mkpart primary 360G 433G parted -s /dev/nvme2n1 mkpart primary 433G 506G parted -s /dev/nvme2n1 mkpart primary 506G 579G parted -s /dev/nvme2n1 mkpart primary 579G 652G parted -s /dev/nvme2n1 mkpart primary 652G 725G parted -s /dev/nvme2n1 mkpart primary 725G 800G 6. list disk by-id 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # list sas disk by id ls -al | grep wwn lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000c500943614ab -\u0026gt; ../../sdl lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca0801eb5c8 -\u0026gt; ../../sdc lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca080248ff8 -\u0026gt; ../../sdh lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca08024aca8 -\u0026gt; ../../sdk lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca08024f0d0 -\u0026gt; ../../sdi lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca080253734 -\u0026gt; ../../sdj lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca0802601cc -\u0026gt; ../../sdf lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca0802735ec -\u0026gt; ../../sda lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca0802747c8 -\u0026gt; ../../sdd lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca0802afad0 -\u0026gt; ../../sdb lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca0802ba6ac -\u0026gt; ../../sdg lrwxrwxrwx 1 root root 9 Jul 1 05:49 wwn-0x5000cca080326bd0 -\u0026gt; ../../sde 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #list nvme disk by uuid ls -al | grep nvme-MT lrwxrwxrwx 1 root root 13 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN -\u0026gt; ../../nvme1n1 lrwxrwxrwx 1 root root 15 Jul 1 06:07 nvme-MT0800KEXUU_CVFT73520058800MGN-part1 -\u0026gt; ../../nvme1n1p1 lrwxrwxrwx 1 root root 16 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part10 -\u0026gt; ../../nvme1n1p10 lrwxrwxrwx 1 root root 16 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part11 -\u0026gt; ../../nvme1n1p11 lrwxrwxrwx 1 root root 16 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part12 -\u0026gt; ../../nvme1n1p12 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN-part13 -\u0026gt; ../../nvme1n1p13 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN-part14 -\u0026gt; ../../nvme1n1p14 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN-part15 -\u0026gt; ../../nvme1n1p15 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN-part16 -\u0026gt; ../../nvme1n1p16 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN-part17 -\u0026gt; ../../nvme1n1p17 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT73520058800MGN-part18 -\u0026gt; ../../nvme1n1p18 lrwxrwxrwx 1 root root 15 Jul 1 06:07 nvme-MT0800KEXUU_CVFT73520058800MGN-part2 -\u0026gt; ../../nvme1n1p2 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part3 -\u0026gt; ../../nvme1n1p3 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part4 -\u0026gt; ../../nvme1n1p4 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part5 -\u0026gt; ../../nvme1n1p5 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part6 -\u0026gt; ../../nvme1n1p6 lrwxrwxrwx 1 root root 15 Jul 1 06:07 nvme-MT0800KEXUU_CVFT73520058800MGN-part7 -\u0026gt; ../../nvme1n1p7 lrwxrwxrwx 1 root root 15 Jul 1 06:07 nvme-MT0800KEXUU_CVFT73520058800MGN-part8 -\u0026gt; ../../nvme1n1p8 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT73520058800MGN-part9 -\u0026gt; ../../nvme1n1p9 lrwxrwxrwx 1 root root 13 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN -\u0026gt; ../../nvme2n1 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT7352005S800MGN-part1 -\u0026gt; ../../nvme2n1p1 lrwxrwxrwx 1 root root 16 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part10 -\u0026gt; ../../nvme2n1p10 lrwxrwxrwx 1 root root 16 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part11 -\u0026gt; ../../nvme2n1p11 lrwxrwxrwx 1 root root 16 Jul 1 06:10 nvme-MT0800KEXUU_CVFT7352005S800MGN-part12 -\u0026gt; ../../nvme2n1p12 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN-part13 -\u0026gt; ../../nvme2n1p13 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN-part14 -\u0026gt; ../../nvme2n1p14 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN-part15 -\u0026gt; ../../nvme2n1p15 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN-part16 -\u0026gt; ../../nvme2n1p16 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN-part17 -\u0026gt; ../../nvme2n1p17 lrwxrwxrwx 1 root root 16 Jul 1 05:49 nvme-MT0800KEXUU_CVFT7352005S800MGN-part18 -\u0026gt; ../../nvme2n1p18 lrwxrwxrwx 1 root root 15 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part2 -\u0026gt; ../../nvme2n1p2 lrwxrwxrwx 1 root root 15 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part3 -\u0026gt; ../../nvme2n1p3 lrwxrwxrwx 1 root root 15 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part4 -\u0026gt; ../../nvme2n1p4 lrwxrwxrwx 1 root root 15 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part5 -\u0026gt; ../../nvme2n1p5 lrwxrwxrwx 1 root root 15 Jul 1 06:10 nvme-MT0800KEXUU_CVFT7352005S800MGN-part6 -\u0026gt; ../../nvme2n1p6 lrwxrwxrwx 1 root root 15 Jul 1 06:08 nvme-MT0800KEXUU_CVFT7352005S800MGN-part7 -\u0026gt; ../../nvme2n1p7 lrwxrwxrwx 1 root root 15 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part8 -\u0026gt; ../../nvme2n1p8 lrwxrwxrwx 1 root root 15 Jul 1 06:09 nvme-MT0800KEXUU_CVFT7352005S800MGN-part9 -\u0026gt; ../../nvme2n1p9 after sort the data ,will will got this list\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 #sas disk /dev/disk/by-id/wwn-0x5000cca0802735ec /dev/disk/by-id/wwn-0x5000cca0802afad0 /dev/disk/by-id/wwn-0x5000cca0801eb5c8 /dev/disk/by-id/wwn-0x5000cca0802747c8 /dev/disk/by-id/wwn-0x5000cca080326bd0 /dev/disk/by-id/wwn-0x5000cca0802601cc /dev/disk/by-id/wwn-0x5000cca0802ba6ac /dev/disk/by-id/wwn-0x5000cca080248ff8 /dev/disk/by-id/wwn-0x5000cca08024f0d0 /dev/disk/by-id/wwn-0x5000cca080253734 /dev/disk/by-id/wwn-0x5000cca08024aca8 /dev/disk/by-id/wwn-0x5000c500943614ab # nvme /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part1 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part2 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part3 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part4 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part5 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part6 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part7 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part8 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part9 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part10 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part11 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part12 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part1 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part2 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part3 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part4 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part5 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part6 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part7 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part8 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part9 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part10 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part11 /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part12 7. Make Bcache disk 1 2 3 4 5 6 7 8 9 10 11 12 make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part13 -B /dev/disk/by-id/wwn-0x5000cca0802735ec --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part14 -B /dev/disk/by-id/wwn-0x5000cca0802afad0 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part15 -B /dev/disk/by-id/wwn-0x5000cca0801eb5c8 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part16 -B /dev/disk/by-id/wwn-0x5000cca0802747c8 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part17 -B /dev/disk/by-id/wwn-0x5000cca080326bd0 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT73520058800MGN-part18 -B /dev/disk/by-id/wwn-0x5000cca0802601cc --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part13 -B /dev/disk/by-id/wwn-0x5000cca0802ba6ac --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part14 -B /dev/disk/by-id/wwn-0x5000cca080248ff8 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part15 -B /dev/disk/by-id/wwn-0x5000cca08024f0d0 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part16 -B /dev/disk/by-id/wwn-0x5000cca080253734 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part17 -B /dev/disk/by-id/wwn-0x5000cca08024aca8 --writeback make-bcache -C /dev/disk/by-id/nvme-MT0800KEXUU_CVFT7352005S800MGN-part18 -B /dev/disk/by-id/wwn-0x5000c500943614ab --writeback 8. Reboot to make bcache works 1 reboot now 9. create OSD 1 2 3 4 5 6 7 8 9 10 11 12 ceph-volume lvm create --bluestore --data /dev/bcache0 --block.wal /dev/nvme1n1p1 --block.db /dev/nvme1n1p7 ceph-volume lvm create --bluestore --data /dev/bcache1 --block.wal /dev/nvme1n1p2 --block.db /dev/nvme1n1p8 ceph-volume lvm create --bluestore --data /dev/bcache2 --block.wal /dev/nvme1n1p3 --block.db /dev/nvme1n1p9 ceph-volume lvm create --bluestore --data /dev/bcache3 --block.wal /dev/nvme1n1p4 --block.db /dev/nvme1n1p10 ceph-volume lvm create --bluestore --data /dev/bcache4 --block.wal /dev/nvme1n1p5 --block.db /dev/nvme1n1p11 ceph-volume lvm create --bluestore --data /dev/bcache5 --block.wal /dev/nvme1n1p6 --block.db /dev/nvme1n1p12 ceph-volume lvm create --bluestore --data /dev/bcache6 --block.wal /dev/nvme2n1p1 --block.db /dev/nvme2n1p7 ceph-volume lvm create --bluestore --data /dev/bcache7 --block.wal /dev/nvme2n1p2 --block.db /dev/nvme2n1p8 ceph-volume lvm create --bluestore --data /dev/bcache8 --block.wal /dev/nvme2n1p3 --block.db /dev/nvme2n1p9 ceph-volume lvm create --bluestore --data /dev/bcache9 --block.wal /dev/nvme2n1p4 --block.db /dev/nvme2n1p10 ceph-volume lvm create --bluestore --data /dev/bcache10 --block.wal /dev/nvme2n1p5 --block.db /dev/nvme2n1p11 ceph-volume lvm create --bluestore --data /dev/bcache11 --block.wal /dev/nvme2n1p6 --block.db /dev/nvme2n1p12 ","date":"2021-07-01T06:38:10+08:00","permalink":"https://echowings.github.io/p/how-to-let-a-new-server-join-hci-system/","title":"How to Let a New Server Join Hci System"},{"content":"How to configure cisco catalyst switch Clean session 1 2 3 4 5 #Show current login users show users # terminal a user clear line vty 0 Set Session timeout exec timeout command is sused to specify the timeout for exec sessions[telnet/ssh] whereas session timeout command specifies the idle timeout period for all the sessions.\n1 2 3 4 5 6 7 config t line vty 0 15 exec-timeout 10 session-timeout 10 #Check configure sh run | be line vty How to fix %Error opening tftp://255.255.255.255/network-confg (Timed out) 1 no service config Set ip address and default gateway 1 2 3 4 ip default-gateway 192.168.0.1 interface vlan 1 ip address 192.168.0.2 255.255.255.0 Set hostname and domain-name 1 2 3 config t hostname myswitch ip domain-name mydomain.com Enable ssh login Generate the RSA keys 1 2 3 4 5 6 7 8 myswitch(config)# crypto key generate rsa The name for the keys will be: myswitch.thegeekstuff.com Choose the size of the key modulus in the range of 360 to 2048 for your General Purpose Keys. Choosing a key modulus greater than 512 may take a few minutes. How many bits in the modulus [512]: 1024 % Generating 1024 bit RSA keys, keys will be non-exportable...[OK] Setup the line vty configurations 1 2 3 4 5 6 line vty 0 4 session-timeout 10 transport input ssh login local password 7 exit Set the console line 1 2 3 line console 0 logging synchronus login local Create the username password 1 2 3 config t username $USERNAME password $MYPASSWORD enable secret $MYENABLEPASSWORD enable service password-encryption 1 service password-encryption Verify SSH access 1 show ip ssh Configure port-channel 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 interface Port-channel1 description testing switchport trunk allowed vlan 4-12 switchport trunk encapsulation dot1q switchport mode trunk # network port settings interface GigabitEthernet1/0/27 description lacp-wifi-network switchport trunk encapsulation dot1q switchport mode trunk channel-protocol lacp channel-group 3 mode active ! interface GigabitEthernet1/0/28 description lacp-wifi-network switchport trunk encapsulation dot1q switchport mode trunk channel-protocol lacp channel-group 3 mode active Access mode 1 2 3 interface GigabitEthernet1/0/29 switchport access vlan 60 switchport mode access SNMP 1 snmp-server community public RO NTP 1 2 ntp source vlan 20 ntp server 10.32.0.2 source vlan 20 PBR 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 # Enable PBR on cisco 3750x sdm prefer routing #save configuration write #Reload switch to let it works. reload #check sdm status show sdm prefer # Define access list ip access-list extended wifi permit ip 10.32.200.0 0.0.0.255 any deny ip any any #define reout-map and set routing policy route-map wifi-2rd-gw permit 10 match ip address wifi set ip next-hop 192.168.99.2 #select a vlan to apply PBR interface Vlan30 ip policy route-map wifi-2rd-gw Reference: %Error opening tftp://255.255.255.255/network-confg (Timed out) to increase SSH session timeout How to Enable SSH on Cisco Switch, Router and ASA ","date":"2021-05-11T11:29:28+08:00","permalink":"https://echowings.github.io/p/how-to-configure-cisco-catalyst-switch/","title":"How to configure cisco catalyst switch"},{"content":"How to Install K8S [TOC]\nPrerequest 下载所需的yaml文件 下载地址:https://github.com/luckylucky421/kubernetes1.17.3/tree/master 2. 初始化k8s集群需要的镜像\n下载链接: https://pan.baidu.com/s/1k1heJy8lLnDk2JEFyRyJdA 提取码: udkj\nPrepare 5 centos Set timezone on centos 1 timedatectl set-timezone Asia/Chongqing Set hostname 1 hostnamectl set-hostname xak8smaster01 Modifiy yum sourcelist 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup curl -fo /etc/yum.repos.d/CentOS-Base.repo -L http://mirrors.aliyun.com/repo/Centos-7.repo yum makecache fast cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 EOF yum clean all yum makecache fast yum -y update yum -y install yum-utils device-mapper-persistent-data lvm2 yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo yum clean all yum makecache fast yum -y install wget net-tools nfs-utils lrzsz gcc gcc-c++ make cmake libxml2-devel openssl-devel curl curl-devel unzip sudo ntp libaio-devel wget vim ncurses-devel autoconf automake zlib-devel python-devel epel-release openssh-server socat ipvsadm conntrack ntpdate systemctl stop firewalld \u0026amp;\u0026amp; systemctl disable firewalld yum install iptables-services -y service iptables stop \u0026amp;\u0026amp; systemctl disable iptables ntpdate cn.pool.ntp.org #crontab -e #* */1 * * * /usr/sbin/ntpdate cn.pool.ntp.org crontab -l | { cat; echo \u0026#34;* */1 * * * /usr/sbin/ntpdate cn.pool.ntp.org\u0026#34;; } | crontab - service crond restart sed -i \u0026#39;s/SELINUX=enforcing/SELINUX=disabled/g\u0026#39; /etc/sysconfig/selinux sed -i \u0026#39;s/SELINUX=enforcing/SELINUX=disabled/g\u0026#39; /etc/selinux/config reboot -r swapoff -a sed -i \u0026#39;s/.*swap.*/#\u0026amp;/\u0026#39; /etc/fstab cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sysctl --system cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/hosts 10.32.0.91 xak8smaster01 10.32.0.92 xak8smaster02 10.32.0.93 xak8smaster03 10.32.0.94 xak8smaster04 10.32.0.95 xak8snode01 10.32.0.96 xak8snode02 EOF ssh-keygen -t rsa sed -i \u0026#39;s/#PermitRootLogin\\ yes/PermitRootLogin\\ yes/g\u0026#39; /etc/ssh/sshd_config sed -i \u0026#39;s/PasswordAuthentication\\ no/PasswordAuthentication\\ yes/g\u0026#39; /etc/ssh/sshd_config cat /etc/ssh/sshd_config | grep PermitRootLogin cat /etc/ssh/sshd_config | grep PasswordAuthentication systemctl daemon-reload systemctl restart sshd ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02 cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; 1.sh ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode02 EOF sh 1.sh cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; 1.sh ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster01 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster02 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster03 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8smaster04 ssh-copy-id -i ~/.ssh/id_rsa.pub root@xak8snode01 EOF sh 1.sh yum list docker-ce --showduplicates |sort -r cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt;EOF { \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;], \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;100m\u0026#34; }, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;storage-opts\u0026#34;: [ \u0026#34;overlay2.override_kernel_check=true\u0026#34; ] } EOF systemctl daemon-reload \u0026amp;\u0026amp; systemctl restart docker echo 1 \u0026gt; /proc/sys/net/bridge/bridge-nf-call-iptables echo 1 \u0026gt;/proc/sys/net/bridge/bridge-nf-call-ip6tables echo \u0026#34;\u0026#34;\u0026#34; vm.swappiness = 0 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-ip6tables = 1 \u0026#34;\u0026#34;\u0026#34; \u0026gt; /etc/sysctl.conf sysctl -p cat \u0026gt; /etc/sysconfig/modules/ipvs.modules \u0026lt;\u0026lt;EOF #!/bin/bash ipvs_modules=\u0026#34;ip_vs ip_vs_lc ip_vs_wlc ip_vs_rr ip_vs_wrr ip_vs_lblc ip_vs_lblcr ip_vs_dh ip_vs_sh ip_vs_fo ip_vs_nq ip_vs_sed ip_vs_ftp nf_conntrack\u0026#34; for kernel_module in \\${ipvs_modules}; do /sbin/modinfo -F filename \\${kernel_module} \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 if [ $? -eq 0 ]; then /sbin/modprobe \\${kernel_module} fi done EOF yum install -y conntrack-tools ipvsadm ipset conntrack libseccomp chmod 755 /etc/sysconfig/modules/ipvs.modules \u0026amp;\u0026amp; bash /etc/sysconfig/modules/ipvs.modules \u0026amp;\u0026amp; lsmod | grep ip_vs cat \u0026gt; /etc/sysctl.d/k8s.conf \u0026lt;\u0026lt; EOF net.ipv4.ip_forward = 1 net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 fs.may_detach_mounts = 1 vm.overcommit_memory=1 vm.panic_on_oom=0 fs.inotify.max_user_watches=89100 fs.file-max=52706963 fs.nr_open=52706963 net.ipv4.tcp_keepalive_time = 600 net.ipv4.tcp.keepaliv.probes = 3 net.ipv4.tcp_keepalive_intvl = 15 net.ipv4.tcp.max_tw_buckets = 36000 net.ipv4.tcp_tw_reuse = 1 net.ipv4.tcp.max_orphans = 327680 net.ipv4.tcp_orphan_retries = 3 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_max_syn_backlog = 16384 net.ipv4.ip_conntrack_max = 65536 net.ipv4.tcp_max_syn_backlog = 16384 net.ipv4.top_timestamps = 0 net.core.somaxconn = 16384 EOF sysctl --system docker pull k8s.gcr.io/kube-apiserver:v1.18.2 docker pull k8s.gcr.io/kube-controller-manager:v1.18.2 docker pull k8s.gcr.io/kube-scheduler:v1.18.2 docker pull k8s.gcr.io/kube-proxy:v1.18.2 ","date":"2021-04-08T18:03:14+08:00","permalink":"https://echowings.github.io/p/how-to-install-k8s/","title":"How to Install K8S"},{"content":"#Learning Golang notebook \u0026ndash;001\nHow to install golang Set go workspace Go still expects there to be a single workspace for third-party Go tools installe via go install.By default,this workspace is located in $HOME/go.\n1 2 3 $HOME/go/src $HOME/go/bin $HOME Install golang with homebrew 1 brew install go 2 set GOPATH on unix like os.\n1 2 3 cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; ~/.zshrc export GOPATH=$HOME/go export PATH=$PATH:%GOPATH/bin set GOPATH on window\n1 2 setx GOPATH $USERPROFILE%\\go setx path \u0026#34;%PATH%;%USERPROFILE%\\bin\u0026#34; GO command go run go build hello world 1 2 3 4 5 6 # hello.go pachage main import \u0026#34;fmt\u0026#34; func main(){ fmt.Println(\u0026#34;Hello, world!\u0026#34;) } 1 2 3 4 5 6 7 8 #Just run go code,without build binary in currently directory path.but build it in temporary direcory. go run hello.go #Build binary without run go build hello.go # Build specific binary name go build -o hellworld hello.go Install Third-Party Go Tools Install 3rd go tools 1 go install github.com/rakyll/hey@latest Upgrade 3rd go tools by run the install command again 1 2 3 4 5 6 7 8 go install github.com/rakyll/hey@latest # Install goimports go install golang.org/x/tools/cmd/goimports@latest #go: downloading golang.org/x/tools v0.1.0 #go: downloading golang.org/x/sys v0.0.0-20210119212857-b64e53b001e4 #go: downloading golang.org/x/mod v0.3.0 #go: downloading golang.org/x/xerrors v0.0.0-20200804184101-5ec99f83aff1 goimport 1 2 3 4 goimports -l -w . # The `-l` flag tells `goimports` to print the files with incorrect formatting to the console # The `-w` flag tells `goimports` to modify the files in-place. # The . specifies the files to be scanned: everything in the current directory and all of its sub-directories. golint Install golint 1 go install golang.org/x/lint/golint@latest Run it 1 2 # Run golint over your entire project golint ./... ","date":"2021-04-07T18:07:23+08:00","permalink":"https://echowings.github.io/p/learning-golang-01/","title":"Learning Golang 01"},{"content":"How to init Local project and push it to git server Create local project 1 git init Create a repositories on git server 1 https://mygitserver/my/myproject.git Add remote origin 1 git remote add origin https://mygitserver/my/myproject.git Pull remote master branche and merge it with local master branche. 1 git pull origin master:master Push local branch to remote 1 git push -u origin master Add local project and push it on git server 1 2 3 git add -A git commit -m \u0026#34;Inistal at first\u0026#34; git push --set-upstream origin master ","date":"2021-04-01T19:23:10+08:00","permalink":"https://echowings.github.io/p/how-to-init-local-project-and-push-to-git-server/","title":"How to Init Local Project and Push to Git Server"},{"content":"How to Install Gitea with Docker-Compose 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; docker-compose.yaml version: \u0026#34;3\u0026#34; networks: gitea: external: false services: server: image: gitea/gitea:1.13.6 container_name: gitea environment: - USER_UID=1000 - USER_GID=1000 - DB_TYPE=mysql - DB_HOST=db:3306 - DB_NAME=gitea - DB_USER=gitea - DB_PASSWD=gitea restart: always networks: - gitea volumes: - ./gitea:/data - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro ports: - \u0026#34;3000:3000\u0026#34; - \u0026#34;222:22\u0026#34; depends_on: - db db: image: mysql:5.7 restart: always environment: - MYSQL_ROOT_PASSWORD=gitea - MYSQL_USER=gitea - MYSQL_PASSWORD=gitea - MYSQL_DATABASE=gitea networks: - gitea volumes: - ./mysql:/var/lib/mysql EOF Run it 1 2 docker-compose pull docker-compose up -d Setup http://xa-gitea:3000 ","date":"2021-03-31T10:49:33+08:00","permalink":"https://echowings.github.io/p/how-to-install-gitea-with-docker-compose/","title":"How to Install Gitea With Docker-Compose"},{"content":"How to rename VMID on PVE 1 2 3 4 5 6 7 8 9 VMID=121 \u0026amp;\u0026amp; \\ NEW_VMID=1001 \u0026amp;\u0026amp; \\ POOL_NAME=tank \u0026amp;\u0026amp; \\ qm unlock $VMID \u0026amp;\u0026amp; \\ qm stop $VMID \u0026amp;\u0026amp; \\ sed -i \u0026#34;s/$VMID/$NEW_VMID/g\u0026#34; /etc/pve/qemu-server/$VMID.conf \u0026amp;\u0026amp; \\ mv /etc/pve/qemu-server/$VMID.conf /etc/pve/qemu-server/$NEW_VMID.conf \u0026amp;\u0026amp; \\ rbd --pool $POOL_NAME rename vm-$VMID-disk-0 vm-$NEW_VMID-disk-0 \u0026amp;\u0026amp;\\ qm start $NEW_VMID ","date":"2021-03-26T15:23:43+08:00","permalink":"https://echowings.github.io/p/how-to-rename-vm-id-on-pve/","title":"How to Rename Vm Id on Pve"},{"content":"How to setup open cas on pve 6.x Install prepare software 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y make gcc build-essential apt install -y pve-kernel-$(uname -r) apt install -y pve-headers-$(uname -r) OPENCAS_VERSION=20.12.2.0444 OPENCAS_SOFTWARE=open-cas-linux-$OPENCAS_VERSION.release wget https://github.com/Open-CAS/open-cas-linux/releases/download/v20.12.2/$OPENCAS_SOFTWARE.tar.gz tar -zxvf $OPENCAS_SOFTWARE.tar.gz # compile with DKMS apt update \u0026amp;\u0026amp; apt install -y dkms cp -r $OPENCAS_SOFTWARE /usr/src/ cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt;/usr/src/$OPENCAS_SOFTWARE/dkms.conf PACKAGE_NAME=\u0026#34;open-cas-linux\u0026#34; #PACKAGE_VERSION=\u0026#34;20.12.2.0444\u0026#34; PACKAGE_VERSION=\u0026#34;$OPENCAS_VERSION\u0026#34; PRE_BUILD=\u0026#34;configure\u0026#34; AUTOINSTALL=\u0026#34;yes\u0026#34; CLEAN=\u0026#34;make clean\u0026#34; MAKE[0]=\u0026#34;\u0026#39;make\u0026#39;\u0026#34; BUILT_MODULE_NAME[0]=\u0026#34;cas_disk\u0026#34; BUILT_MODULE_LOCATION[0]=\u0026#34;modules/cas_disk\u0026#34; DEST_MODULE_LOCATION[0]=\u0026#34;/extra\u0026#34; BUILT_MODULE_NAME[1]=\u0026#34;cas_cache\u0026#34; BUILT_MODULE_LOCATION[1]=\u0026#34;modules/cas_cache\u0026#34; DEST_MODULE_LOCATION[1]=\u0026#34;/extra\u0026#34; EOF OPENCAS_VERSION=20.12.2.0444 OPENCAS_SOFTWARE=open-cas-linux-$OPENCAS_VERSION.release dkms add -m open-cas-linux -v $OPENCAS_VERSION.release dkms build -m open-cas-linux -v $OPENCAS_VERSION.release dkms install -m open-cas-linux -v $OPENCAS_VERSION.release Manually install 1 2 3 cd $OPENCAS_SOFTWARE ./configure make \u0026amp;\u0026amp; make install 1 2 3 4 5 6 7 8 9 10 11 12 apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y make gcc build-essential apt install -y linux-kernel-$(uname -r) apt install -y linux-headers-$(uname -r) apt install -y libelf-dev wget https://github.com/Open-CAS/open-cas-linux/releases/download/v20.12.2/open-cas-linux-20.12.2.0444.release.tar.gz tar -zxvf open-cas-linux-20.12.2.0444.release.tar.gz cd open-cas-linux-20.12.2.0444.release/ ./configure make \u0026amp;\u0026amp; make install ","date":"2021-03-13T14:49:17+08:00","permalink":"https://echowings.github.io/p/how-to-setup-opencase-on-pve6/","title":"How to Setup Opencase on Pve6"},{"content":"How to Install PBS on Debian 10 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free EOF apt update \u0026amp;\u0026amp; apt dist-upgrade -y apt install -y net-tools dnsutils vim firmware-linux-nonfree CODENAME=`cat /etc/os-release |grep CODENAME |cut -f 2 -d \u0026#34;=\u0026#34;` echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian/pbs $CODENAME pbs-no-subscription\u0026#34; \u0026gt; /etc/apt/sources.list.d/pbs-no-subscription.list wget https://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-6.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-6.x.gpg apt update \u0026amp;\u0026amp; apt full-upgrade -y apt install -y proxmox-backup-server rm -rf /etc/apt/sources.list.d/pbs-enterprise.list rm -rf /etc/apt/sources.list.d/ceph.list apt update \u0026amp;\u0026amp; apt -y dist-ugprade ","date":"2021-03-11T16:58:45+08:00","permalink":"https://echowings.github.io/p/how-to-install-pbs-on-debian-10/","title":"How to Install Pbs on Debian 10"},{"content":"How to operate becache Recently I just try to add bcache with zfs and ceph. So I just wirte down it.\nInstall bcache-tools Since bcache implement in Linux kernel. So it will default enabled. We just need to install bcache-tools to operate bcache.\n1 apt install -y bcache-tools Configure bcache 1 2 3 4 5 6 7 # make a cache disk for bcache .It must be a ssd disk. make-bcache -C /dev/nvme1n1 # make a disk as backend disk.It must be a slow sata/sas disk. make-bcache -B /dev/sda #if you have a lot of disks like me.your can add backend disk as this. make-bcache -B /dev/sd{a..f} ###Check bcache status\n1 lsblk Add bcache manually 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #show `cset.uuid root@xa-autotest-hci01:~# bcache-super-show /dev/sda sb.magic\tok sb.first_sector\t8 [match] sb.csum\tED8FD98E20A2E91E [match] sb.version\t1 [backing device] dev.label\t(empty) dev.uuid\te7b350fe-3496-47e2-a276-5faa5637f8a5 dev.sectors_per_block\t1 dev.sectors_per_bucket\t1024 dev.data.first_sector\t16 dev.data.cache_mode\t1 [writeback] dev.data.cache_state\t1 [clean] cset.uuid\td3fcd781-a10a-453a-96dd-6eba13abfc5b ####Add cache disk\n1 echo \u0026#34;d3fcd781-a10a-453a-96dd-6eba13abfc5b\u0026#34; \u0026gt; /sys/block/bcache0/bcache/attach if you have a lot of disk, you can add it with for loop.\n1 for i in range{0..5}; do `echo \u0026#34;d3fcd781-a10a-453a-96dd-6eba13abfc5b\u0026#34; \u0026gt; /sys/block/bcache$(expr $i)/bcache/attach`; done Delete cache disk if you want to delete bcache disk\n1 2 3 echo \u0026#34;d3fcd781-a10a-453a-96dd-6eba13abfc5b\u0026#34; \u0026gt; /sys/block/bcache0/bcache/detach # delete a lot disk for i in range{0..5}; do `echo \u0026#34;d3fcd781-a10a-453a-96dd-6eba13abfc5b\u0026#34; \u0026gt; /sys/block/bcache$(expr $i)/bcache/detach`; done unrigister cache disk 1 2 umount /dev/bcach0 echo 1 \u0026gt; /sys/block/bcache0/bcache/stop If you onle have one nvme disk and you can add them all in one make-bcache -C /dev/nvme1n1 -B /dev/sd{a..f} \u0026ndash;writeback\n1 2 3 4 5 ## Change bcache write policy ```bash make-bcache -B/dev/ Manually resigter udev disk 1 echo /dev/sdb \u0026gt; /sys/fs/bcache/register Change bcache write mode When you run command like make-bcache -C /dev/nvme1n1 -B /dev/sda it will be set write through mode. If you have UPS and you can change it to writeback mode.\n1 echo writeback \u0026gt; /sys/block/bcache0/bcache/cache_mode Check bcache status 1 2 3 4 5 6 7 8 cat /sys/block/bcache0/bcache/state no cache: this means you have not attached a caching device to your backing bcache device; clean: this means everything is ok. The cache is clean; dirty: this means everything is setup fine and that you have enabled writeback and that the cache is dirty; inconsistent: you are in trouble because the backing device is not in sync with the caching device; bcache-status lsblk bcache optimized 1 2 3 4 5 6 #modify cache policy cat /sys/block/bcache0/bcache/cache_mode echo writeback \u0026gt; /sys/block/bcache0/bcache/cache_mode #Disable ip track echo 0 \u0026gt; /sys/fs/bcache/$CacheSetUUID/congested_read_threshold_us echo 0 \u0026gt; /sys/fs/bcache/$CacheSetUUID/congested_write_threshold_us disable bcache 1 2 3 4 5 6 7 8 9 #check `CACHE_SET_UUID` ls /sys/fs/bcache #Unregister ssd cache disk echo 1 \u0026gt;/sys/fs/bcache/06e33354-7c21-4c52-990d-1a653617ab20/unregister #disable backend disk echo 1 \u0026gt; /sys/block/sdb/bcache/stop #write back cache to backend disk echo 0 \u0026gt; /sys/block/bcache0/bcache/writeback_percent ##Reference\nA block layer cache (bcache) bcache狀態和配置檔案詳細介紹(翻譯自官網） bcache手册 Linux下SSD缓存加速之bcache试用 bcache / 如何使用bcache构建LVM,软RAID / 如何优化bcache ","date":"2021-03-09T16:20:42+08:00","permalink":"https://echowings.github.io/p/bcache/","title":"Bcache"},{"content":"How to Install VLMCSD on debian VLMCSD vlmcsd-1113-2020-03-28-Hotbird64 Download and install 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 VLMCSD_VERSION=svn113 curl -fsSLO https://github.com/Wind4/vlmcsd/releases/download/$VLMCSD_VERSION/binaries.tar.gz tar -zxvf binaries.tar.gz sudo cp -af ./binaries/Linux/intel/glibc/vlmcsd-x64-glibc /usr/local/bin/ chown root:root /usr/local/bin/vlmcsd-x64-glibc chmod +x /usr/local/bin/vlmcsd-64-glibc sudo bash -c \u0026#39;cat \u0026gt; /lib/systemd/system/vlmcsd.service\u0026#39; \u0026lt;\u0026lt; EOF [Unit] Description=vlmcsd service [Service] ExecStart=/usr/local/bin/vlmcsd-x64-glibc -l /var/log/vlmcsd-64-glibc.log \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 Restart=on-failure RestartSec=42s [Install] WantedBy=multi-user.target EOF #Reload systemctl daemon sudo systemctl daemon-reload #Delete temp directory. sudo rm -rf ./binaries sudo rm -rf ./binaries.tar.gz #Enable service of dcompass auto startup when system reboot sudo systemctl enable vlmcsd #Restart service of vlmcsd sudo systemctl restart vlmcsd #Check dcompass status of freedns. sudo systemctl status vlmcsd bat file for client 1 2 3 4 5 6 7 8 9 10 11 12 13 14 echo \u0026#34;To active office\u0026#34; cd \u0026#34;c:\\Program Files\\Microsoft Office\\Office16\u0026#34; cscript ospp.vbs /sethst:$HOTSNAMTORIP:$PORT cscript ospp.vbs /inpkey:NMMKJ-6RK4F-KMJVX-8D9MJ-6MWKP cscript ospp.vbs /act echo \u0026#34;To active windows\u0026#34; slmgr /skms $HOSTNAMEORIP:$PORT slmgr /ato @pause Reference 在debian中搭建kms服务器 ","date":"2021-03-02T12:19:36+08:00","permalink":"https://echowings.github.io/p/how-to-install-vlmcsd-on-debian/","title":"How to Install Vlmcsd on Debian"},{"content":"How to Install Proxmox VE 6 on Debian 10 Install debian 10 Modifiy hostname and hosts file 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free EOF apt update \u0026amp;\u0026amp; apt dist-upgrade -y apt install -y net-tools dnsutils vim firmware-linux-nonfree #sed -i \u0026#39;s/127.0.1.1/10.32.4.37/g\u0026#39; /etc/hosts hostname --ip-address echo \u0026#34;deb http://mirrors.ustc.edu.cn/proxmox/debian/pve buster pve-no-subscription\u0026#34; \u0026gt; /etc/apt/sources.list.d/pve-install-repo.list wget http://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-6.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-6.x.gpg apt update \u0026amp;\u0026amp; apt -y full-upgrade apt install -y proxmox-ve postfix open-iscsi apt -y remove os-prober #Disable supscription alert sed -Ezi.bak \u0026#34;s/(Ext.Msg.show\\(\\{\\s+title: gettext\\(\u0026#39;No valid sub)/void\\(\\{ \\/\\/\\1/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service #Delete pve enterprise subscription rm -rf /etc/apt/sources.list.d/pve-enterprise.list #Modify ceph apt list source echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-octopus buster main\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list.d/ceph-octopus.list apt update \u0026amp;\u0026amp; apt full-upgrade -y apt install -y ifupdown2 acpid openvswitch-switch Reference Install Proxmox VE on Debian Buster ","date":"2021-03-01T13:28:01+08:00","permalink":"https://echowings.github.io/p/how-to-install-proxmox-ve-6-on-debian-10/","title":"How to Install Proxmox VE 6 on Debian 10"},{"content":"Install and Configure snmp on debian 10 INSTALL SNMP 1 2 apt install -y snmpd snmp libsnmp-dev CONFIGURE SNMP ON DEBIAN 10 backup original configure file. 1 cp /etc/snmp/snmpd.conf /etc/snmp/snmpd.conf.orig Edit snmpd.conf 1 2 agentAddress udp:127.0.0.1:161,udp:192.168.1.1:161 ","date":"2021-01-22T13:31:14+08:00","permalink":"https://echowings.github.io/p/install-and-configure-snmp-on-debian-10/","title":"Install and Configure Snmp on Debian 10"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #Switch to root mode sudo su #Define freedns version freedns_version=v2020.9.17 #Create dcompass temp folder sudo mkdir -p /tmp/freedns # Swich to folder just we created. cd /tmp/freedns #Download dcompass binary sudo curl -fsSLO \u0026#34;https://github.com/tuna/freedns-go/releases/download/$freedns_version/freedns-go-linux-amd64\u0026#34; sudo cp -af /tmp/freedns/freedns-go-linux-amd64 /usr/local/bin/freedns sudo chown root:root /usr/local/bin/freedns sudo chmod +x /usr/local/bin/freedns sudo bash -c \u0026#39;cat \u0026gt; /lib/systemd/system/freedns.service\u0026#39; \u0026lt;\u0026lt; EOF [Unit] Description=freedns service [Service] ExecStart=/usr/local/bin/freedns -f 114.114.114.114:53 -c 8.8.8.8:53 -l 127.0.0.3:53 Restart=on-failure RestartSec=42s [Install] WantedBy=multi-user.target EOF #Reload systemclt daemon sudo systemctl daemon-reload #Delete temp directory. sudo rm -rf /tmp/freedns #Enable service of dcompass auto startup when system reboot sudo systemctl enable freedns #Restart service of freedns sudo systemctl restart freedns #Check dcompass status of freedns. sudo systemctl status freedns ","date":"2021-01-11T01:13:07+08:00","permalink":"https://echowings.github.io/p/how-to-install-freedns-go-on-vyos/","title":"How to Install Freedns Go on Vyos"},{"content":"Extend disk with diskutils Delete partition \u0026ldquo;Free Space\u0026rdquo; to extend disk to current macos partition.\nFixed Error “The new size must be different than the existing size” 1 2 3 4 5 #repair (internal, disk0 - in your case) diskutil repairdisk disk0 #resize (synthesized, disk1 - in your case with HS) diskutil apfs resizeContainer disk1 0 Reference Cannot resize APFS partition - “The new size must be different than the existing size” ","date":"2021-01-04T18:33:47+08:00","permalink":"https://echowings.github.io/p/how-to-extend-free-disk-space-for-macos/","title":"How to Extend Free Disk Space for Macos"},{"content":"How to uninstlal windows update which install failed Uninstall failed windows update Reboot your pc or laptop and select troubleshoot Select to open the command prompt and stay away from any other auto repair options. Loading the software rigistry.\n1 2 3 4 5 6 7 8 #Load the softeware registry hive as follows. reg load hklm/temp c:\\windows\\system32\\config\\software #Delete the sessionPending registry key, if it exists by running: reg delete \u0026#34;HKLM\\temp\\Microsoft\\Windows\\CurrentVersion\\Component Based Servicing\\SessionPending\u0026#34; /v Exclusive # Unload the software registry hive: reg unload HKLM\\temp Remove failed updates with DISM command List failed updated. The yellow one are the ones of interest and you can see the first one never even got an install time.\n1 2 #List updates installed that caused issue. dism /image:c:\\ /get-packages 2. Remove error udpates with DISM.\n1 dism /image:c:\\ /remove-package /packagename:myproblematicpackagetoremove /scratchdir:c:\\temp 3. After finished uninstall error updates,we can reboot your pc.\nReference Quick Fix Publish : VM won’t boot after October 2017 Updates for Windows Server 2016 and Windows 10 (KB4041691) ","date":"2020-12-29T11:50:20+08:00","permalink":"https://echowings.github.io/p/how-to-uninstall-windows-update-which-install-failed/","title":"How to Uninstall Windows Update Which Install Failed"},{"content":"Dcompass github address Dcompass Address Dcompass Release bianry 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 #Switch to root mode sudo su #Define dcompass version dcompass_version=build-20210803_1007 #Create dcompass temp folder sudo mkdir -p /tmp/dcompass # Swich to folder just we created. cd /tmp/dcompass #Download dcompass binary sudo curl -fsSLO \u0026#34;https://github.com/LEXUGE/dcompass/releases/download/$dcompass_version/dcompass-x86_64-unknown-linux-musl-full\u0026#34; #Create dcompass configure folder sudo mkdir -p /etc/dcompass #Create dcompass configure yaml file sudo bash -c \u0026#39;cat \u0026gt; /etc/dcompass/config.yaml\u0026#39; \u0026lt;\u0026lt;EOF --- verbosity: \u0026#34;info\u0026#34; #address: 0.0.0.0:2053 address: 127.0.1.2:53 table: start: if: qtype: - AAAA then: # A list of actions is allowed here - blackhole # The next tag to go - end else: - dispatch dispatch: if: any then: - query: domestic - check_secure check_secure: if: geoip: codes: - CN else: - query: aboard - end upstreams: 114DNS: udp: addr: 114.114.114.114:53 Ali: udp: addr: 223.6.6.6:53 domestic: hybrid: - 114DNS - Ali googledns1: udp: addr: 8.8.8.8:53 googledns2: udp: addr: 8.8.4.4:53 aboard: hybrid: - googledns1 - googledns2 EOF sudo cp -af /tmp/dcompass/dcompass-x86_64-unknown-linux-musl-full /usr/local/bin/dcompass sudo chown root:root /usr/local/bin/dcompass sudo chmod +x /usr/local/bin/dcompass sudo bash -c \u0026#39;cat \u0026gt; /lib/systemd/system/dcompass.service\u0026#39; \u0026lt;\u0026lt; EOF [Unit] Description=dcompass service [Service] ExecStart=/usr/local/bin/dcompass -c /etc/dcompass/config.yaml Restart=on-failure RestartSec=42s [Install] WantedBy=multi-user.target EOF #Reload systemclt daemon sudo systemctl daemon-reload #Delete temp directory. sudo rm -rf /tmp/dcompass #Enable service of dcompass auto startup when system reboot sudo systemctl enable dcompass #Restart service of dcompass sudo systemctl restart dcompass #Check dcompass status of dcompass. sudo systemctl status dcompass ","date":"2020-12-22T02:57:46+08:00","permalink":"https://echowings.github.io/p/how-to-install-dcompass-on-vyos/","title":"How to Install Dcompass on Vyos"},{"content":"How to install squirrel as your chinese input method for your macos 1. Install squirrel 1 brew cask install squirrel 2. Logout and login or Reboot your mac Reboot your mac\n3. Copy squirrel configuration for you configuration file: https://github.com/wongdean/rime-settings#\n1 2 mkdir rime \u0026amp;\u0026amp; cd rime git clone https://github.com/wongdean/rime-settings.git 4. configure squrriel Press control + space key to enable squirrel. Then click settings... Copy all contents in rime-settings expect fonts folder to configure folder. ","date":"2020-11-20T17:47:43+08:00","permalink":"https://echowings.github.io/p/how-to-install-squirrel-on-macos/","title":"How to Install Squirrel on Macos"},{"content":"How to Create Debian10 template With Cloudinit for PVE 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 VMID=9002 VM_NAME=CentOS-7-x86_64-GenericCloud VM_DOWNLOAD_URL=http://mirrors.ustc.edu.cn/centos-cloud/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2.xz TEMPLATE_VM_NAME=$(echo $VM_NAME | sed \u0026#39;s/_/-/g\u0026#39;) STORAGE_PATH=local DEFAULT_PVE_PATH=/var/lib/vz/images #Change directory to `local` cd /var/lib/vz/images #Download centos 7 cloud images on proxmox ve wget $VM_DOWNLOAD_URL #unzip the file #xz -z (to zip file) #xz -k( to keep original file and valur `-0` to `-9` to set zip rate, default zip rate is -6 #xz -d (to unzip file) # xz -k (to keep zipped file not deleted) xz -d -k $VM_NAME.qcow2.xz qm create $VMID --memory 4096 --net0 virtio,bridge=vmbr0 --name $TEMPLATE_VM_NAME qm importdisk $VM_ID $VM_NAME.qcow2 $STORAGE_PATH qm set $VM_ID --scsihw virtio-scsi-pci --scsi0 $STORAGE_PATH:$VM_ID/vm-$VM_ID-disk-0.raw qm set $VM_ID --scsihw virtio-scsi-pci --scsi0 $STORAGE_PATH:$VM_ID/vm-$VM_ID-disk-0.raw qm set $VM_ID --boot c --bootdisk scsi0 qm set $VM_ID --serial0 socket --vga serial0 qm set $VM_ID --agent 1 qemu-img convert -f raw $DEFAULT_PVE_PATH/$VM_ID/vm-$VM_ID-disk-0.raw -O qcow2 $DEFAULT_PVE_PATH/$VM_ID/vm-$VM_ID-disk-0.qcow2 sed -i \u0026#39;s/.raw/.qcow2/g\u0026#39; /etc/pve/qemu-server/$VM_ID.conf qm start $VM_ID qm terminal $VM_ID #Change yum source form offical to mirrors.ustc.edu.cn sudo sed -e \u0026#39;s|^mirrorlist=|#mirrorlist=|g\u0026#39; \\ -e \u0026#39;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g\u0026#39; \\ -i.bak \\ /etc/yum.repos.d/CentOS-Base.repo yum makecache yum update yum upgrade ","date":"2020-09-20T14:56:48+08:00","permalink":"https://echowings.github.io/p/how-to-create-debian10-with-cloudinit-for-pve/","title":"How to Create Debian10 With Cloudinit for Pve"},{"content":"HOw to create CentOS 7 template for PVE 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 VMID=9002 VM_NAME=CentOS-7-x86_64-GenericCloud VM_DOWNLOAD_URL=http://mirrors.ustc.edu.cn/centos-cloud/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2.xz TEMPLATE_VM_NAME=$(echo $VM_NAME | sed \u0026#39;s/_/-/g\u0026#39;) STORAGE_PATH=local DEFAULT_PVE_PATH=/var/lib/vz/images #Change directory to `local` cd /var/lib/vz/images #Download centos 7 cloud images on proxmox ve wget $VM_DOWNLOAD_URL #unzip the file #xz -z (to zip file) #xz -k( to keep original file and valur `-0` to `-9` to set zip rate, default zip rate is -6 #xz -d (to unzip file) # xz -k (to keep zipped file not deleted) xz -d -k $VM_NAME.qcow2.xz qm create $VMID --memory 4096 --net0 virtio,bridge=vmbr0 --name $TEMPLATE_VM_NAME qm importdisk $VM_ID $VM_NAME.qcow2 $STORAGE_PATH qm set $VM_ID --scsihw virtio-scsi-pci --scsi0 $STORAGE_PATH:$VM_ID/vm-$VM_ID-disk-0.raw qm set $VM_ID --scsihw virtio-scsi-pci --scsi0 $STORAGE_PATH:$VM_ID/vm-$VM_ID-disk-0.raw qm set $VM_ID --boot c --bootdisk scsi0 qm set $VM_ID --serial0 socket --vga serial0 qm set $VM_ID --agent 1 qemu-img convert -f raw $DEFAULT_PVE_PATH/$VM_ID/vm-$VM_ID-disk-0.raw -O qcow2 $DEFAULT_PVE_PATH/$VM_ID/vm-$VM_ID-disk-0.qcow2 sed -i \u0026#39;s/.raw/.qcow2/g\u0026#39; /etc/pve/qemu-server/$VM_ID.conf qm start $VM_ID qm terminal $VM_ID #Change yum source form offical to mirrors.ustc.edu.cn sudo sed -e \u0026#39;s|^mirrorlist=|#mirrorlist=|g\u0026#39; \\ -e \u0026#39;s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.ustc.edu.cn/centos|g\u0026#39; \\ -i.bak \\ /etc/yum.repos.d/CentOS-Base.repo yum makecache yum update yum upgrade ","date":"2020-09-12T17:29:39+08:00","permalink":"https://echowings.github.io/p/how-to-create-centos7-template-for-pve/","title":"How to Create Centos7 Template for Pve"},{"content":"How to reset VyOS to default settings 1 2 3 4 configure load /opt/vyatta/etc/config.boot.default commit save ","date":"2020-09-04T22:48:34+08:00","permalink":"https://echowings.github.io/p/how-to-reset-vyos-to-default-settings/","title":"How to Reset Vyos to Default Settings"},{"content":"How to extend all available disk to local-data After install Proxmove VE, the local-data only have about 50GB disk availabe. But how to let all availabld disk space to the local-data? Here we go:\n1 2 3 4 5 6 7 8 # Remove local-data lvremove /dev/pve/data # Extend all available disk to /dev/pve/root lvresize -l +100%FREE /dev/pve/root #recreate pve-root resize2fs /dev/mapper/pve-root Reference Proxmox – Remove LVM local-data ","date":"2020-09-04T09:11:30+08:00","permalink":"https://echowings.github.io/p/how-to-extend-all-available-disk-to-local-data/","title":"How to Extend All Available Disk to Local Data"},{"content":"How to make Destination Base Routing with Vyos I have 2 network interfaces. one for user access inboard network,another for user to access network aboard. How to make it work with vyos?\nMake a network group 1 2 3 4 5 #Define a netwrok-group set firewall group network-group china-ip-ranges #Define lan network group set firewall group network-group lan-net-group network \u0026#39;192.168.11.0/24\u0026#39; set policy 1 2 3 4 5 set policy route network-shunt rule 20 destination group network-group \u0026#39;china-ip-ranges\u0026#39; set policy route network-shunt rule 20 set table \u0026#39;20\u0026#39; set policy route network-shunt rule 20 source group network-group \u0026#39;lan-net-group\u0026#39; set policy route network-shunt rule 30 set table \u0026#39;30\u0026#39; set policy route network-shunt rule 30 source group network-group \u0026#39;lan-net-group\u0026#39; Download and set the network-group with ipset Download and make a list for network-group loading when booting. 1 2 3 4 5 6 7 8 9 10 11 #create the update shell script cat \u0026gt; /config/scripts/generate_china_ip_address.sh \u0026lt;\u0026lt;EOF #!/bin/sh wget -c http://ftp.apnic.net/stats/apnic/delegated-apnic-latest -O - | cat | awk -F \u0026#39;|\u0026#39; \u0026#39;/CN/\u0026amp;\u0026amp;/ipv4/ {print $4 \u0026#34;/\u0026#34; 32-log($5)/log(2)}\u0026#39; | cat \u0026gt; /config/chinaiprange.txt EOF # make the script an run chmod +x /config/scripts/generate_china_ip_address.sh #Run the script /config/scripts/generate_china_ip_address.sh Create boot loading script 1 2 3 cat \u0026gt;\u0026gt; /config/scripts/vyos-postconfig-bootup.script \u0026lt;\u0026lt; EOF for l in `cat /config/chinaiprange.txt`; do sudo ipset add china-ip-ranges $l;done EOF Set protocol 1 2 3 4 set protocols static interface-route 0.0.0.0/0 next-hop-interface pppoe0 set protocols static interface-route 172.16.131.0/24 next-hop-interface wg01 set protocols static table 20 interface-route 0.0.0.0/0 next-hop-interface pppoe0 set protocols static table 30 route 0.0.0.0/0 next-hop 172.16.131.1 Apply PBR Policy on lan interface 1 set interfaces bridge br0 policy route network-shunt ","date":"2020-09-03T16:36:31+08:00","permalink":"https://echowings.github.io/p/how-to-make-destination-base-routing-with-vyos/","title":"How to make Destination Base Routing With Vyos"},{"content":"How to config DDNS for vyos with dns.he.net Register A Recored Register a domian host.mydomain.com on your https://dns.he.net Generate a key 64LGiLiuoiuoiuoi Run command to setup the ddns service 1 2 3 4 5 6 7 8 configure set service dns dynamic interface pppoe0 service dyndns host-name \u0026#39;host.mydomain.com\u0026#39; set service dns dynamic interface pppoe0 service dyndns login \u0026#39;host.mydomain.com\u0026#39; set service dns dynamic interface pppoe0 service dyndns password \u0026#39;64LGiLiuoiuoiuoi\u0026#39; set service dns dynamic interface pppoe0 service dyndns server \u0026#39;dyn.dns.he.net\u0026#39; commit save ","date":"2020-08-05T16:26:46+08:00","permalink":"https://echowings.github.io/p/how-to-config-ddns-for-vyos-with-dns.he.net/","title":"How to Config Ddns for Vyos With Dns.he.net"},{"content":"How to build L2tp over ipsec vpn with vyos Today, I will show you how to build a l2tp over ipsec vpn with adsl wan address.\nSetup vpn on vyos Generate a preshare key 1 2 $ generate wireguard preshared-key uND0O6RYI1O833NL2+qwSrW4htMll1hJAUM2nPQaa8k= With authentication local configuration VPN Key Value WAN interface pppoe0 l2tp vpn network 172.16.100.0/24 PRESHARE KEY uND0O6RYI1O833NL2+qwSrW4htMll1hJAUM2nPQaa8k= DNS server 01 192.168.0.1 DNS Server 02 1921.68.0.2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 configure set vpn ipsec auto-update \u0026#39;30\u0026#39; set vpn ipsec ipsec-interfaces interface \u0026#39;pppoe0\u0026#39; set vpn ipsec nat-networks allowed-network 0.0.0.0/0 set vpn ipsec nat-traversal \u0026#39;enable\u0026#39; set vpn l2tp remote-access authentication mode \u0026#39;local\u0026#39; set vpn l2tp remote-access authentication require \u0026#39;mschap-v2\u0026#39; set vpn l2tp remote-access client-ip-pool start \u0026#39;172.16.100.1\u0026#39; set vpn l2tp remote-access client-ip-pool stop \u0026#39;172.16.100.254\u0026#39; set vpn l2tp remote-access dns-servers server-1 \u0026#39;192.168.0.1\u0026#39; set vpn l2tp remote-access ipsec-settings authentication mode \u0026#39;pre-shared-secret\u0026#39; set vpn l2tp remote-access ipsec-settings authentication pre-shared-secret \u0026#39;uND0O6RYI1O833NL2+qwSrW4htMll1hJAUM2nPQaa8k=\u0026#39; set vpn l2tp remote-access ipsec-settings ike-lifetime \u0026#39;3600\u0026#39; set vpn l2tp remote-access ipsec-settings lifetime \u0026#39;3600\u0026#39; set vpn l2tp remote-access outside-address \u0026#39;0.0.0.0\u0026#39; Auth users to access vpn Generate password 1 dd if=/dev/urandom bs=1 count=15 | base64 create user named zhangsan with password J+Yi8o5ICLjKtezv0+i9 1 2 3 4 configure set vpn l2tp remote-acces\tauthentication local-users username zhangshan password J+Yi8o5ICLjKtezv0+i9 commit save Start the service 1 2 sudo systemctl enable xl2tpd sudo systemctl restart xl2tpd vpn setup script for windows 10 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 @echo off\u0026amp;PUSHD %~DP0 \u0026amp;TITLE ikev2 VPN InstallUninstall programme mode con cols=160 lines=50 set TempFile_Name=%SystemRoot%\\System32\\BatTestUACin_SysRt%Random%.batemp ( echo \u0026#34;BAT Test UAC in Temp\u0026#34; \u0026gt;%TempFile_Name% ) 1\u0026gt;nul 2\u0026gt;nul if exist %TempFile_Name% ( del %TempFile_Name% 1\u0026gt;nul 2\u0026gt;nul\u0026amp;\u0026amp;goto :install ) else ( echo;Please run the script as administrator,Press any key to quit... \u0026amp;\u0026amp;goto :end ) echo;VPN List: echo; Welcome! This programme will help your install MY-VPN, or uninstall it. :install cls echo;1:MY-VPN(L2tp/ipsec) echo;Please select Install or Uninstall VPN(ikev2)(Enter \u0026#39;i\u0026#39; for install, \u0026#39;u\u0026#39; for uninstall, \u0026#39;q\u0026#39; for quit): echo;i:Install MY-VPN(L2TP/IPSEC VPN) echo;u:Uninstall MY-VPN(L2TP/IPSEC VPN) echo;q:Quit set/p choose1=Please enter your selection and press enter key to confirm: echo %choose1%|findstr /i \u0026#34;[iuq]\u0026#34;\u0026gt;nul\u0026amp;\u0026amp;goto :%choose1% goto :install :i cls echo;Install 1:MY-VPN(L2TP/IPSEC VPN) echo;=========================== echo;***Step 1:Delete VPN with the same name *** (powershell -Command \u0026#34;\u0026amp; {Remove-VpnConnection -Name \u0026#34;MY-VPN\u0026#34; -Force -PassThru;}\u0026#34;) 1\u0026gt;nul 2\u0026gt;nul echo;Successfully! echo; echo;***Step 2: Install new VPN*** (powershell -Command \u0026#34;\u0026amp; {Enable-PSRemoting -Force;}\u0026#34;) 1\u0026gt;nul 2\u0026gt;nul (powershell -Command \u0026#34;\u0026amp; {Add-VpnConnection -Name \u0026#34;MY-VPN\u0026#34; -ServerAddress \u0026#34;myvpn.mydomain.com\u0026#34; -TunnelType \u0026#34;L2tp\u0026#34; -EncryptionLevel \u0026#34;Required\u0026#34; -AuthenticationMethod MSChapv2 -L2tpPsk \u0026#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\u0026#34; -Force -RememberCredential -DnsSuffix \u0026#34;MYDOMAIN.NET\u0026#34; -PassThru;}\u0026#34;) 1\u0026gt;nul 2\u0026gt;nul echo;Done! echo; echo;***Step 3:Clean key in regedit*** (powershell -Command \u0026#34;\u0026amp; {Remove-ItemProperty HKLM:\\System\\CurrentControlSet\\Services\\Rasman\\Parameters -name \u0026#34;NegotiateDH2048_AES256\u0026#34;; Remove-ItemProperty HKLM:\\System\\CurrentControlSet\\Services\\PolicyAgent -name \u0026#34;AssumeUDPEncapsulationContextOnSendRule \u0026#34;;}\u0026#34;) 1\u0026gt;nul 2\u0026gt;nul echo;Done! echo; echo;***Step 4:Add key in Regedit*** (powershell -Command \u0026#34;\u0026amp; {New-ItemProperty HKLM:\\System\\CurrentControlSet\\Services\\Rasman\\Parameters -name \u0026#34;NegotiateDH2048_AES256\u0026#34; -value 1 -propertyType dword; New-ItemProperty HKLM:\\System\\CurrentControlSet\\Services\\PolicyAgent -name \u0026#34;AssumeUDPEncapsulationContextOnSendRule \u0026#34; -value 2 -propertyType dword;}\u0026#34;) 1\u0026gt;nul 2\u0026gt;nul echo;Done! echo; echo;***Step 5:Set regedit*** powershell -Command \u0026#34;\u0026amp; {Set-ItemProperty HKLM:\\System\\CurrentControlSet\\Services\\Rasman\\Parameters -name \u0026#34;NegotiateDH2048_AES256\u0026#34; -value 1; Set-ItemProperty HKLM:\\System\\CurrentControlSet\\Services\\PolicyAgent -name \u0026#34;AssumeUDPEncapsulationContextOnSendRule \u0026#34; -value 2;}\u0026#34; echo;Done! echo; echo;***Step 6:Reboot your Windows*** echo;Press any key to reboot your windows, or press X to quit the script and manually reboot your windows. pause\u0026gt;nul goto :end :u cls echo;Uninstall MY-VPN(L2TP/IPSEC VPN) echo;=========================== (powershell -Command \u0026#34;\u0026amp; {Remove-VpnConnection -Name \u0026#34;MY-VPN\u0026#34; -Force -PassThru;}\u0026#34;) 1\u0026gt;nul 2\u0026gt;nul echo;Done, Press any key to quit... goto :end :end pause\u0026gt;nul ","date":"2020-08-05T10:57:22+08:00","permalink":"https://echowings.github.io/p/how-to-build-l2tp-over-ipsec-vpn-with-vyos/","title":"How to Build L2tp Over Ipsec VPN With Vyos"},{"content":"How to deploy Jisti Server with docker-compose Install jisti Server git clone latest version 1 2 3 git clone https://github.com/jitsi/docker-jitsi-meet \u0026amp;\u0026amp; cd docker-jitsi-meet cp env.example .env Generate security password 1 2 3 ./gen-passwords.sh #mkdir -p ~/.jitsi-meet-cfg/{web/letsencrypt,transcripts,prosody,jicofo,jvb} mkdir -p ~/.jitsi-meet-cfg/{web/letsencrypt,transcripts,prosody/config,prosody/prosody-plugins-custom,jicofo,jvb,jigasi,jibri} Modify .env copy env.example to .env. 1 cp env.example .env Modify key and value as followed. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 CONFIG=~/.jitsi-meet-cfg # Exposed HTTP port HTTP_PORT=80 # Exposed HTTPS port HTTPS_PORT=443 # System time zone TZ=Asia/Shanghai # Public URL for the web service PUBLIC_URL=https://meet.mydomain.com # # Let\u0026#39;s Encrypt configuration # # Enable Let\u0026#39;s Encrypt certificate generation ENABLE_LETSENCRYPT=1 # Domain for which to generate the certificate LETSENCRYPT_DOMAIN=meet.mydomain.com # E-Mail for receiving important account notifications (mandatory) LETSENCRYPT_EMAIL=myname@mydomain.com # Enable authentication ENABLE_AUTH=1 # Enable guest access ENABLE_GUESTS=1 # Select authentication type: internal, jwt or ldap AUTH_TYPE=internal # Redirect HTTP traffic to HTTPS # Necessary for Let\u0026#39;s Encrypt, relies on standard HTTPS port (443) ENABLE_HTTP_REDIRECT=1 Add Users for internal auth 1 2 3 docker exec -it docker-jitsi-meet_prosody_1 bash # create a user `user1` prosodyctl --config /config/prosody.cfg.lua register user1 meet.jitsi Run it 1 docker-compose up -d Backup 1 2 3 4 5 6 #for configure folder ~/.jitsi-meet-cfg # for letencryption folder ~/.jitsi-meet-cfg/web/letsencrypt # for configure ./.env Firewall Setup 1 2 3 4 5 6 7 8 9 10 apt install ufw ufw status ufw default deny ufw allow 22 ufw allow 443 ufw allow 80 ufw allow 10000/udp ufw allow 4443 ufw enable ufw status Reference Quick start 用docker安裝視訊會議 jitsi-meet ","date":"2020-05-21T22:49:44+08:00","permalink":"https://echowings.github.io/p/how-to-deploy-jitsi-server-with-docker-compose/","title":"How to Deploy Jitsi Server With Docker Compose"},{"content":"How to convert godaddy certification files from .cert to .pem Recently days, I met an issue to renew ssl certification file for a website. The former developer setup certification file to .pem. It take a long time to make it work. Here we go.\nConvert .crt to .pem 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # convert .key file to key.pem openssl rsa -in mywebsite.com.key -text \u0026gt; key.pem # convert .cert to cert.pem cat mywebsite.com.crt \u0026gt; cert.pem # add cert chain to the cert.pem cat mywebsite.com.ca-bundle \u0026gt;\u0026gt; cert.pem # clone pem cp cert.pem staging.pem # openssl dhparam -dsaparam -out /etc/nginx/ssl/dhparam.pem 4096 tar -cxvf tar -jcvf mywebsite.com-v3.tar.bz2 *.pem Upload mywebsite.com-v3.tar.bz2 to server and renew ssl certification 1 2 3 4 5 6 7 8 9 tar -jxvf mywebsite.com-v3.tar.bz2 mv all the pem file to /home/mywebsitepath # Testing nginx configuration docker exec -it nginx nginx -t # Restart nginx instance docker restart nginx ","date":"2020-01-21T16:49:32+08:00","permalink":"https://echowings.github.io/p/how-to-convert-cert-to-ssl/","title":"How to Convert Cert to Ssl"},{"content":"How to enable NTFS Read and Write in Macos Catalina 10.15 For a long time. It was much trouble to enable ntfs write mode in macos. Today I done it about enable ntfs wirte support with fuse and ntfs-3g.\nInstall FUSE for macos You can download latest FUSE for macOS from here: FUSE for macOS\nThen you can install it by yourself.\nInstall ntfs-3g 1 2 brew install ntfs-3g Replace ntfs-3g Since from OS X 10.11 version ,macos enabled system integrity protection we need to disable it to replace the ntfs_mount.\nSo we gonna to disable System integrity Protection in Recovery mode ,then boot to normal mode to replace ntfs_mount, at last we need to boot to recovery mode again to enable system integrity protection.\n1. Disable system integrity protection Shutdown your macos Press Command + R,the press power buttion to start macos and enter the recovery mode. After enter recovery mode, then we can open Terminal. Run command in Terminal csrutil disable. Reboot macos. 2. Replace mount_ntfs Open Terminal Enter commands as show below 1 2 3 sudo mount -uw / sudo mv /sbin/mount_ntfs /sbin/mount_ntfs.original sudo ln -s /usr/local/sbin/mount_ntfs /sbin/mount_ntfs Then shutdown your. macos. 3. Enable system integrity protection Press Command + R,the press power buttion to start macos and enter the recovery mode. After enter recovery mode, then we can open Terminal. Run command in Terminal csrutil enble. Reboot macos. 4. Follow the system notification to enable fuse ntfs After we boot macos normally, we need follow the system notification to enable permission for fuse ntfs.\nPro and Cons Pro: We can write ntfs format disk for free.\nCons: We need to do it again when we upgrade macos to a new major release.\nReference Enabling NTFS write in macOS 10.15 Catalina the Open source way About System Integrity Protection on your Mac ","date":"2019-12-27T11:20:00+08:00","permalink":"https://echowings.github.io/p/how-to-enable-ntfs-read-and-write-in-macos-catalina-10.15/","title":"How to Enable Ntfs Read and Write in Macos Catalina 10.15"},{"content":"How to Install Graylog with Docker-compose Hostname my-graylog Docker-compose.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 version: \u0026#39;2\u0026#39; services: # MongoDB: https://hub.docker.com/_/mongo/ mongodb: image: mongo:3 volumes: - ./data/mongo_data:/data/db - /etc/localtime:/etc/localtime:ro # Elasticsearch: https://www.elastic.co/guide/en/elasticsearch/reference/6.x/docker.html elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch-oss:6.8.2 volumes: - ./data/es_data:/usr/share/elasticsearch/data - /etc/localtime:/etc/localtime:ro environment: - http.host=0.0.0.0 - transport.host=localhost - network.host=0.0.0.0 - \u0026#34;ES_JAVA_OPTS=-Xms512m -Xmx512m\u0026#34; ulimits: memlock: soft: -1 hard: -1 mem_limit: 1g # Graylog: https://hub.docker.com/r/graylog/graylog/ graylog: image: graylog/graylog:3.1 volumes: - ./data/graylog_journal:/usr/share/graylog/data/journal - /etc/localtime:/etc/localtime:ro environment: # CHANGE ME (must be at least 16 characters)! - GRAYLOG_PASSWORD_SECRET=somepasswordpepper # Password: admin - GRAYLOG_ROOT_PASSWORD_SHA2=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 - GRAYLOG_HTTP_EXTERNAL_URI=http://my-graylog:9000/ links: - mongodb:mongo - elasticsearch depends_on: - mongodb - elasticsearch ports: # Graylog web interface and REST API - 9000:9000 # Syslog TCP - 1514:1514 # Syslog UDP - 1514:1514/udp # GELF TCP - 12201:12201 # GELF UDP - 12201:12201/udp # Volumes for persisting data, see https://docs.docker.com/engine/admin/volumes/volumes/ Start graylog 1 docker-compose up -d Fixed permission of folder 1 2 3 4 5 chown -R 1100:1100 data/graylog_journal/ chown -R 1000:1000 data/es_data/ docker-compose down docker-compose up -d ","date":"2019-12-24T11:27:21+08:00","permalink":"https://echowings.github.io/p/how-to-install-graylog-with-docker-compose/","title":"How to Install Graylog With Docker Compose"},{"content":"How to build ipse site-to-site VPN with vyos and pfsense Vyos VS pfsense For build all kinds of network functions like nat,firewall, site-to-site vpn , dial in vpn with pfsense.It works well. But it has some Crons:\nHard to upgrade version, it manybe crashed Didn\u0026rsquo;t support API. Heavy loading and low performance. After try to replace pfsense to build all functions with vyos. It has a lot of pros:\nEasy upgrade and rollback Support http and python api Support ansible deploy Command line operation,just like juniper and cisco. Today I will show you how to build ipsec site-to-site vpn with vyos and pfsense\nPrerequest SITE A SITE B WAN ADDRESS 1.1.1.1 2.2.2.2 WAN Interface eth0 eth0 LAN ADDRESS 192.168.1.1/24 192.168.2.1/24 LAN NETWORK 192.168.1.0/24 192.168.2.0/24 LAN Interface eth1 eth1 OS Vyos pfsense Pre-Shared Key *#JCenaoewaoi0298J299*8\u0026amp;^(%9))_\u0026amp;\u0026amp; *#JCenaoewaoi0298J299*8\u0026amp;^(%9))_\u0026amp;\u0026amp; Configure vyos Configure Site A\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 configure set vpn ipsec ipsec-interfaces interface eth0 set vpn ipsec ike-group IKE-Default dead-peer-detection action \u0026#39;hold\u0026#39; set vpn ipsec ike-group IKE-Default dead-peer-detection interval \u0026#39;30\u0026#39; set vpn ipsec ike-group IKE-Default dead-peer-detection timeout \u0026#39;120\u0026#39; set vpn ipsec ike-group IKE-Default ikev2-reauth \u0026#39;no\u0026#39; set vpn ipsec ike-group IKE-Default key-exchange \u0026#39;ikev2\u0026#39; set vpn ipsec ike-group IKE-Default lifetime \u0026#39;10800\u0026#39; set vpn ipsec ike-group IKE-Default mobike \u0026#39;disable\u0026#39; set vpn ipsec ike-group IKE-Default proposal 1 dh-group \u0026#39;14\u0026#39; set vpn ipsec ike-group IKE-Default proposal 1 encryption \u0026#39;aes256gcm128\u0026#39; set vpn ipsec ike-group IKE-Default proposal 1 hash \u0026#39;sha256\u0026#39; set vpn ipsec esp-group ESP-Default compression \u0026#39;disable\u0026#39; set vpn ipsec esp-group ESP-Default lifetime \u0026#39;3600\u0026#39; set vpn ipsec esp-group ESP-Default mode \u0026#39;tunnel\u0026#39; set vpn ipsec esp-group ESP-Default pfs \u0026#39;dh-group14\u0026#39; set vpn ipsec esp-group ESP-Default proposal 1 encryption \u0026#39;aes256gcm128\u0026#39; set vpn ipsec esp-group ESP-Default proposal 1 hash \u0026#39;sha256\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 authentication id \u0026#39;1.1.1.1\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 authentication mode \u0026#39;pre-shared-secret\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 authentication pre-shared-secret \u0026#39;*#JCenaoewaoi0298J299*8\u0026amp;^(%9))_\u0026amp;\u0026amp;\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 authentication remote-id \u0026#39;2.2.2.2\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 connection-type \u0026#39;initiate\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 ike-group \u0026#39;IKE-Default\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 ikev2-reauth \u0026#39;inherit\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 local-address \u0026#39;1.1.1.1\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 tunnel 0 esp-group \u0026#39;ESP-Default\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 tunnel 0 local prefix \u0026#39;192.168.1.0/24\u0026#39; set vpn ipsec site-to-site peer 2.2.2.2 tunnel 0 remote prefix \u0026#39;192.168.2.0/24\u0026#39; Configure pfsense Configure Site B\nAfter login pfsense click VPN | IPsec; Then click \u0026lsquo;Add P1` button. configuraton as show below Add P1 General Information Key Value Disabled uncheck Key Exchange version IKEv2 Internet Protocol IPv4 Interfae WAN Remote Gateway 1.1.1.1 Description SITE-A-VPN Phase 1 Proposal (Authentication) Key Value Authentication Method Mutual PSK My identifier My IP address Peer identifier Peer IP address Pre-Shared Key *#JCenaoewaoi0298J299*8\u0026amp;^(%9))_\u0026amp;\u0026amp; Phase 1 Proposal(Encryption Algorithm) Key Algorithm Key length Hash DH Group Encryption Algorithm AES256-GCM 128 bits SHA256 14(2048bit) Key Value Lifetime(Seconds) 28800 Advanced Options KEY VALUE Disable rekey uncheck Margintime(Seconds black Disable Reauth uncheck Responder Only Uncheck MOBIKE Disable Split connections uncheck Dead Peer Dection \u0026lsquo;Check on\u0026rsquo; Enable DPD Delay 120 Max failures 30 Add P2 General Information Key Value Disable unchecked Mode Tunnel IPv4 Local network Network 192.168.2.0/24 NAT/BINAT translation None Remote Network Network 192.168.1.0/24 Description Site A Phase 2 Proposal(SA/Key Exchange) Key Value Protocol ESP Encryption Algorithms AES256-GCM 128 bit Hash Algorithms SHA256 PFS key group 14(2048 bit) Lifttime 3600 Advanced Configuration Key Value Automatically ping host 192.168.1.1 Change firewall to allow ipsec vpn connection Protocol Source Port Destination Port Ipv4 UDP 1.1.1.1 * WAN address 500(ISAKMP) IPv4 UDP 1.1.1.1 * WAN address 4500(IPsec NAT-T) Ipv4 ESP 1.1.1.1 * WAN address * \u0026mdash;The End\u0026mdash;\n","date":"2019-12-19T14:36:09+08:00","permalink":"https://echowings.github.io/p/how-to-build-ipsec-site-to-site-vpn-with-vyos-and-pfsense/","title":"How to Build Ipsec Site to Site Vpn With Vyos and Pfsense"},{"content":"How to install Jenkins with docker compose Create Dockerfile With office jenkins docker images.change the jenkins mirrors and change alpine linux soure list to aliyun\n1 2 3 4 5 6 7 8 #Dockerfile FROM jenkins/jenkins:alpine USER root ENV JENKINS_MIRROR https://mirrors.tuna.tsinghua.edu.cn ENV JENKINS_UC_DOWNLOAD=\u0026#34;https://mirrors.tuna.tsinghua.edu.cn/jenkins/\u0026#34; RUN sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\u0026#39; /etc/apk/repositories \\ \u0026amp;\u0026amp; apk update \\ \u0026amp;\u0026amp; apk add docker nodejs nodejs-npm yarn Create docker-compose.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # docker-compose.yaml version: \u0026#34;2.4\u0026#34; services: jenkins: build: ./ #image: jenkins/jenkins:alpine container_name: jenkins ports: - \u0026#34;80:8080\u0026#34; - \u0026#34;50000:50000\u0026#34; environment: #- JAVA_OPTS=-Xmx1500m -Duser.timezone=GMT+8 - JAVA_OPTS=-Duser.timezone=GMT+8 - JENKINS_UC_DOWNLOAD=https://mirrors.tuna.tsinghua.edu.cn/jenkins/ volumes: - ./data/jenkins:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /root/.ssh/:/root/.ssh - /etc/localtime:/etc/localtime:ro # cpus: 3.5 # mem_limit: 1800m user: root restart: always Install Jenkins with Check initial Admin Password by run command as show below\n1 cat data/jenkins/secrets/initialAdminPassword Reference Jenkins for Docker 跳过插件安装及插件加速镜像设置 ","date":"2019-12-10T22:39:01+08:00","permalink":"https://echowings.github.io/p/how-to-install-jenkins-with-docker-compose/","title":"How to Install Jenkins With Docker Compose"},{"content":"How to Install gitlab with docer-compose 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 version: \u0026#34;3.5\u0026#34; services: gitlab: image: gitlab/gitlab-ce:latest container_name: gitlab restart: always hostname: \u0026#39;xa-gitlab\u0026#39; environment: GITLAB_OMNIBUS_CONFIG: | external_url \u0026#39;http://xa-gitlab\u0026#39; gitlab_rails[\u0026#39;backup_keep_time\u0026#39;] = 604800 gitlab_rails[\u0026#39;time_zone\u0026#39;] = \u0026#39;Asia/Shanghai\u0026#39; gitlab_rails[\u0026#39;gitlab_shell_ssh_port\u0026#39;] = 1022 #gitlab_rails[\u0026#39;ldap_enabled\u0026#39;] = true #gitlab_rails[\u0026#39;ldap_servers\u0026#39;] = YAML.load \u0026lt;\u0026lt;-EOS #main: # label: \u0026#39;LDAP\u0026#39; # host: \u0026#39;192.168.1.1\u0026#39; # port: 389 # uid: \u0026#39;uid\u0026#39; # bind_dn: \u0026#39;CN=admin,DC=lotbrick,DC=com\u0026#39; # password: \u0026#39;admin\u0026#39; # user_filter: \u0026#39;objectclass=person\u0026#39; # base: \u0026#39;ou=People,dc=xxxxx,dc=com\u0026#39; # active_directory: false # method: \u0026#39;plain\u0026#39; # attributes: # username: [\u0026#34;cn\u0026#34;] # email: [\u0026#39;email\u0026#39;] # name: \u0026#39;displayName\u0026#39; # first_name: \u0026#39;givenName\u0026#39; # last_name: \u0026#39;sn\u0026#39; #EOS ports: - \u0026#39;80:80\u0026#39; - \u0026#39;443:443\u0026#39; - \u0026#39;1022:22\u0026#39; volumes: - ./gitlab/config:/etc/gitlab - ./gitlab/logs:/var/log/gitlab - ./gitlab/data:/var/opt/gitlab # - \u0026#34;/etc/localtime:/etc/localtime:ro\u0026#34; Reference Docker+GitLab+LDAP部署过程 https://github.com/JyBigBoss/docker-compose/blob/master/gitlab/docker-compose.yaml ","date":"2019-11-27T12:24:57+08:00","permalink":"https://echowings.github.io/p/how-to-install-gitlab-with-docker-compose/","title":"How to Install Gitlab With Docker-Compose"},{"content":"How to Change Settings After Clone Debian 10 With Cloudinit Enable on Proxmox VE Issue I found an issue about create a linux vm as a template with cloudinit enabled. Seem like after cloned the virtual machine, the cloud-init cd rom didn\u0026rsquo;t be created automatically. We need to delete it,then change setings again to apply the apt source.\nsolution 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #!/usr/bin/env sh mv /etc/apt/sources.list /etc/apt/sources.list.backup wget https://mirrors.ustc.edu.cn/repogen/conf/debian-http-4-buster -O /etc/apt/sources.list apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y openssh-server git vim cloud-init apt-transport-https sed -i \u0026#39;s/http/https/g\u0026#39; /etc/apt/sources.list apt update \u0026amp;\u0026amp; apt -y dist-upgrade mv /etc/apt/sources.list /etc/apt/sources.list.backup wget https://mirrors.ustc.edu.cn/repogen/conf/debian-http-4-buster -O /etc/apt/sources.list apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y openssh-server git vim cloud-init apt-transport-https sed -i \u0026#39;s/http/https/g\u0026#39; /etc/apt/sources.list apt update \u0026amp;\u0026amp; apt -y dist-upgrade sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.docker.com/linux/debian \\ $(lsb_release -cs) \\ stable\u0026#34; sed -i \u0026#39;s/download.docker.com/mirrors.ustc.edu.cn\\/docker-ce/g\u0026#39; /etc/apt/sources.list cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/default/docker DOCKER_OPTS=\u0026#34;--registry-mirror=https://docker.mirrors.ustc.edu.cn/\u0026#34; EOF systemctl restart docker sudo sed -i \u0026#39;s/PasswordAuthentication\\ no/PasswordAuthentication\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd sudo sed -i \u0026#39;s/#PermitRootLogin\\ prohibit-password/PermitRootLogin\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd ","date":"2019-11-27T11:56:41+08:00","permalink":"https://echowings.github.io/p/how-to-change-settings-after-clone-debian-10-with-cloudinit-enable-on-proxmox-ve/","title":"How to Change Settings After Clone Debian 10 With Cloudinit Enable on Proxmox Ve"},{"content":"How to install Elasticflow Today, i found a good software that is Elasticflow. It is so perfect for us to monitor status of our networking. So I tried to install it will docker-compose way. You know what, after servial hours, fixed a lot bugs it works.\nDownload and modified docker-compose.yml for elasticflow 1 2 3 4 5 6 7 8 9 10 11 12 # Download `docker-compose.yml` for elasticflow wget https://raw.githubusercontent.com/robcowart/elastiflow/master/docker-compose.yml # version 3.5.2 is now existed. So we need change it to `3.5.1` sed -i \u0026#39;s/robcowart/elastiflow-logstash-oss:3.5.2/robcowart/elastiflow-logstash-oss:3.5.1/g\u0026#39; -i docker-comopse.yml #Change volumes from `/var/lib/elastiflow_es to current folder` sed -i \u0026#39;s/\\/var\\/lib\\/elastiflow_es/.\\/elastiflow_es/g\u0026#39; docker-compose.yml # Create data folder and change folder permission. mkdir elastiflow_es chown -R 1000:1000 ./elastiflow_es Up and run 1 docker-compose up -d Then we can access elasticflow via browser http://\u0026lt;elastciflow_host_ip\u0026gt;:5601\nSwell ElastiFlow™ Problem with elasticsearch-oss #428 Running ElastiFlow™ on Docker ","date":"2019-11-19T17:11:27+08:00","permalink":"https://echowings.github.io/p/how-to-install-elasticflow/","title":"How to Install Elasticflow"},{"content":"How to Deploy Cloud Images on PVE To deploy cloud images on pve has a lot of benifit, for example, auto expand disk capicity, auto update and auto deploy virtual machine.\nHow to deploy debian 10 colud image on pve I perfer to debian as my first choice between all of the linux distributes. since it has light footprinting and more stable.\n","date":"2019-11-14T13:40:56+08:00","permalink":"https://echowings.github.io/p/how-to-deploy-cloud-images-on-pve/","title":"How to Deploy Cloud Images on Pve"},{"content":"Some tips for management proxmxo VE Force shutdown a vm 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #List all vm in pve qm list # qm unlock the specific vm qm unlock \u0026lt;vmid\u0026gt; # qm stop the specific vm qm stop \u0026lt;vmid\u0026gt; # qm shutdown the specific vm qm shutdown \u0026lt;vmid\u0026gt; # Check vm status qm list | grep \u0026lt;vmid\u0026gt; ","date":"2019-10-22T10:23:46+08:00","permalink":"https://echowings.github.io/p/some_tips_for_management_promxmoxve/","title":"Some_tips_for_management_promxmoxve"},{"content":"{% raw %}\nHow to install and configure FreeRADIUS with Active Directory allow specific group of users to authenticate in Debian 10 serval years ago,I built freeradius server in centos 6 work with active directory. It works perfect with wifi authortication and ikev2 vpn authortication. But recently days, I found a bug that the radius server can not limit user access to a group in AD. So I\u0026rsquo;m trying to build a new freeradius server in debian 10. After a week work.At last I figure it out.\nInstall Software and configuration First thing first, We need install a debian 10 server on your virtualization platform. currently, I installed a debian server on proxmox ve platform.\nBasic Information Name Value Domain Name TESTING.LOCAL NTDomain Name TESTING RADIUS HOSTNAME MYRADIUS DOMAIN CONTROLLER MYDC02.TESTING.LOCAL DOMAIN CONTROLLER MYDC03.TESTING.LOCAL DOMAIN GROUP VPN_GROUP Change Debian settings Change hostname 1 hostnamectl set-hostname myradius Sync NTP time with domain controller Install chrony 1 2 apt purge ntp apt install -y chrony 1 2 3 4 vi /etc/chrony/chrony.conf #comment out `pool xxx iburst server \u0026lt;ip_of_dc01\u0026gt; iburst server \u0026lt;ip_of_dc02\u0026gt; iburst restart chrony service and force update times\n1 2 systemctl restart chrony chronyc sources Install samba and winbind and let Debian Host joined domain Install samba,winbind,krb5-user 1 2 3 apt update \u0026amp;\u0026amp; apt -y dist-ugprade apt install -y samba winbind krb5-user apt -y install winbind libpam-winbind libnss-winbind krb5-config samba-dsdb-modules samba-vfs-modules config samba config file 1 vi /etc/samba/smb.conf In [global] section, change settings form\n1 2 3 4 [global] ## Browsing/Identification ### # Change this to the workgroup/NT-domain name your Samba server will part of workgroup = WORKGROUP to\n1 2 3 4 5 6 7 8 9 10 11 12 13 [global] ## Browsing/Identification ### # Change this to the workgroup/NT-domain name your Samba server will part of workgroup = TESTING realm = TESTING.LOCAL security = ads idmap config * : backend =tdb idmap config * : range = 3000-7999 idmap config testing : backend = rid idmap config testing : range = 10000-999999 winbind use default domain = true winbind offline logon = false Modify /etc/nsswitch.conf 1 vi /etc/nsswitch.conf Change settings:\n1 2 passwd: files systemd group: files systemd to\n1 2 passwd: files systemd winbind group: files systemd winbind Modify /etc/krb5.conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 [libdefaults] default_realm=TESTING.LOCAL ... [realms] TESTING.LOCAL = { kdc = MYDC02.TESTING.LOCAL kdc = MYDC03.TESTING.LOCAL admin_server = TESTING.LOCAL default_domain = TESTING.LOCAL } ... [domain_realm] .testing.local = TESTING.LOCAL testing.local = TESTING.LOCAL Restart OS\n1 reboot Join domain\n1 2 #net join -U mypoweruser net ads join -U Administrator 1 2 3 4 5 Enter Administrator\u0026#39;s password: Using short domain name -- TESTING Joined \u0026#39;SMB\u0026#39; to dns domain \u0026#39;\u0026#39; No DNS domain configured for smb. Unable to perform DNS Update. DNS update failed: NT_STATUS_INVALID_PARAMETER Restart samba and winbind service\n1 systemctl restart smbd winbind Testing samba AD authentication:\nUsing winbind: 1 2 systemctl restart winbind wbinfo -a \u0026lt;user\u0026gt;%\u0026lt;password\u0026gt; You will get the following message if everything is correct:\n1 2 plaintext password authentication succeeded challenge/response password authentication succeeded Using ntlm_auth: 1 ntlm_auth --request-nt-key --domain=TESTING --username=\u0026lt;user\u0026gt; --password=\u0026lt;password\u0026gt; Then you will got success message:\n1 NT_STATUS_OK: Success (0x0) Install freeradius Install freeradius\n1 apt install -y freeradius Grant permission for freerad user on winbind\u0026rsquo;s socket:\n1 2 sudo usermod -a -G winbindd_priv freerad sudo chgrp winbindd_priv /var/lib/samba/winbindd_privileged/ Change MACHAP to use ntlm_auth:\n1 vi /etc/freeradius/3.0/mods-available/ntlm_auth change\n1 2 3 4 program = \u0026#34;/usr/bin/ntlm_auth --request-nt-key --domain=TESTING --username=%{mschap:User-Name} --password=%{User-Password}\u0026#34; #if you want to limted to a specific domain group please modified as this: program = \u0026#34;/usr/bin/ntlm_auth --request-nt-key --domain=$DOMAINNAME --require-membership-of=\u0026#39;$DOMAINNAME\\$DOMAIN_GROUP\u0026#39; --username=%{mschap:User-Name} --password=%{User-Password}\u0026#34; Change module mschap\n1 vi /etc/freeradius/3.0/mods-available/mschap change\n1 2 3 4 {% raw %} mschap { ntlm_auth = \u0026#34;/usr/bin/ntlm_auth --request-nt-key --domain=TESTING --username=%{%{Stripped-User-Name}:-%{%{User-Name}:-None}} --challenge=%{%{mschap:Challenge}:-00} --nt-response=%{%{mschap:NT-Response}:-00}\u0026#34; {% ednraw %} Change eap config.\n1 vi /etc/freeradius/3.0/mods-available/eap Change settings of default_eap_type.\n1 2 eap { default_eap_type = md5 to\n1 2 eap { default_eap_type = mschapv2 Then restart freeradius service\n1 systemctl restart freeradius Change /etc/freeradius/3.0/sites-enabled/default and /etc/freeradius/3.0/sites-enabled/inner-tunnel\n1 2 authenticate { ntlm_auth Configure RADIUS client\n1 vi /etc/freeradius/3.0/clients.conf 1 2 3 4 client 0.0.0.0/0 { secret = myauthpassword shortname = \u0026#34;nas access\u0026#34; } restart service of freeradius\n1 systemctl restart freeradius Test FreeRADIUS and MSCHAP:\n1 radtest -t mschap \u0026lt;user\u0026gt; \u0026lt;password\u0026gt; localhost 0 testing123 The results will be like:\n1 2 3 4 5 6 7 8 9 10 11 12 13 Sent Access-Request Id 9 from 0.0.0.0:59244 to 127.0.0.1:1812 length 134 User-Name = \u0026#34;user\u0026#34; MS-CHAP-Password = \u0026#34;password\u0026#34; NAS-IP-Address = 172.100.99.100 NAS-Port = 0 Message-Authenticator = 0x00 Cleartext-Password = \u0026#34;password\u0026#34; MS-CHAP-Challenge = 0x163bc4c900360a08 MS-CHAP-Response = 0x0001000000000000000000000000000000000000000000000000382764ceb05312077d21d71bf53ce917ef2e72a4ff83ca96 Received Access-Accept Id 9 from 127.0.0.1:1812 to 0.0.0.0:0 length 84 MS-CHAP-MPPE-Keys = 0x000000000000000065c53b0540ab884edc6779a1f370c0cb MS-MPPE-Encryption-Policy = Encryption-Allowed MS-MPPE-Encryption-Types = RC4-40or128-bit-Allowed Configure freeradius-ldap Auth with AD To limited to auth a AD group, we need to config freeradius auth with ldap.\nInstall freeradius-ldap 1 apt install -y freeradius-ldap Edit config edit /etc/freeradius/3.0/mods-available/ldap 1 vi /etc/freeradius/3.0/mods-available/ldap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 ldap { ... server = \u0026#39;dc01.mydomain.local\u0026#39; server = \u0026#39;dc02.mydomain.local\u0026#39; port = 389 identity = \u0026#39;aduser@mydomain.local\u0026#39; password = \u0026lt;mypassword\u0026gt; base_dn = \u0026#39;dc=mydomain,dc=local\u0026#39; ... } ... update { control:Password-With-Header += \u0026#39;userPassword\u0026#39; control:NT-Password := \u0026#39;ntPassword\u0026#39; reply:Reply-Message := \u0026#39;radiusReplyMessage\u0026#39; reply:Tunnel-Type := \u0026#39;radiusTunnelType\u0026#39; reply:Tunnel-Medium-Type := \u0026#39;radiusTunnelMediumType\u0026#39; reply:Tunnel-Private-Group-ID := \u0026#39;radiusTunnelPrivategroupId\u0026#39; # Where only a list is specified as the RADIUS attribute, # the value of the LDAP attribute is parsed as a valuepair # in the same format as the \u0026#39;valuepair_attribute\u0026#39; (above). control: += \u0026#39;radiusControlAttribute\u0026#39; request: += \u0026#39;radiusRequestAttribute\u0026#39; reply: += \u0026#39;radiusReplyAttribute\u0026#39; } ... edir = no ... } ... user { ... base_dn = \u0026#34;${..base_dn}\u0026#34; ... filter = \u0026#34;(sAMAccountName=%{%{Stripped-User-Name}:-%{User-Name}})\u0026#34; ... create a link to mode-enable 1 ln -s /etc/freeradius/3.0/mods-available/ldap /etc/freeradius/3.0/mods-enabled/ edit /etc/freeradius/3.0/sites-available/default 1 vi /etc/freeradius/3.0/sites-available/default 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ... authorize { ... ldap if ((ok || updated) \u0026amp;\u0026amp; User-Password) { update { control:Auth-Type := ldap } } ... authenticate { ... Auth-Type LDAP { ldap } ... } ... } Restart freeradius service 1 2 systemctl restart freeradius freeradius -fX testing ldap auth\n1 radtest \u0026lt;domain_accout\u0026gt; \u0026lt;password\u0026gt; localhost 0 testing123 Change /etc/freeradius/3.0/users to allow specific group VPN_GROUP of users to authenticate 1 vi /etc/freeradius/3.0/users 1 2 3 4 DEFAULT Auth-Type = ntlm_auth, LDAP-Group == \u0026#34;VPN_GROUP\u0026#34; ... DEFAULT Group != \u0026#34;VPN_GROUP\u0026#34;, Auth-Type := Reject Reply-Message = \u0026#34;Your are not permit to access VPN Connectiong\u0026#34; Change MACHAP to use ntlm_auth: 1 vi /etc/freeradius/3.0/mods-available/ntlm_auth change\n1 2 #if you want to limted to a specific domain group please modified as this: program = \u0026#34;/usr/bin/ntlm_auth --request-nt-key --domain=$DOMAINNAME --require-membership-of=\u0026#39;$DOMAINNAME\\$DOMAIN_GROUP\u0026#39; --username=%{mschap:User-Name} --password=%{User-Password}\u0026#34; Install mysql,daloradius to make management freeradius with web access Install mariadb database 1 apt install -y mariadb-server Renew certficiation We purchased godaddy certification, so we will replace ssl certification\nbackup default eap configure file\n1 cp /etc/freeradius/3.0/mods-enabled/eap /etc/freeradius/3.0/mods-enabled/eap.backup Place pem file to /etc/freeradius/3.0/certs/mycerts\n1 ls -al /etc/freeradius/3.0/certs/mycerts -rw-r\u0026ndash;r\u0026ndash; 1 root root 1728 Feb 21 11:11 mycerts-ca.pem -rw-r\u0026ndash;r\u0026ndash; 1 root root 1704 Feb 21 11:09 mycerts.key -rw-r\u0026ndash;r\u0026ndash; 1 root root 2248 Feb 21 11:13 mycerts.pem\n1 2 3 4 - Convert crt to pem ```bash openssl x509 -in mycert-ca.crt -out mycert-ca.pem -outform PEM Modified /etc/freeradius/3.0/mods-enabled/eap file.\n1 2 3 tls-config tls-common { #private_key_password = whatever private_key_file = /etc/freeradius/3.0/certs/vpn.grapecity.com.cn/mycerts.key \u0026hellip; certificate_file = /etc/freeradius/3.0/certs/vpn.grapecity.com.cn/mycerts.pem \u0026hellip; ca-file = /etc/freeradius/3.0/certs/vpn.grapecity.com.cn/mycerts-ca.pem\n1 2 3 4 5 - Restart freeradius service. ```bash systemctl restart freeradius {% endraw %}\nReference WPA2 Enterprise with FreeRADIUS and AD integration on Ubuntu16.04 调试freeradius 3.0 与microsoft AD通过LDAP认证的笔记 Configure FreeRADIUS with Active Driectory allow specific group of users to authenticate Join in Windows Active Directory Domain with Samba Winbind. 802.1x PEAP mschapv2认证证书问题 How to convert .crt to .pem [duplicate] ","date":"2019-10-13T14:52:31+08:00","permalink":"https://echowings.github.io/p/how-to-install-and-configure-freeradius-with-active-directory-allow-allow-specific-group-of-users-to-authenticate-in-debian-10/","title":"How to Install and Configure Freeradius With Active Directory Allow Allow Specific Group of Users to Authenticate in Debian 10"},{"content":"How to change default swap settings for Proxmox VE Check Default swap policy from value 60 to 0 1 2 cat /proc/sys/vm/swappiness #default value is 60 , it means when the memory remain 60, the swap will be enable Change swap policy 1 2 3 4 5 6 7 8 9 10 11 12 13 # Temp to change default swap enable when memory remain 0. sysctl vm.swappiness=0 # Permanent to change swapp cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/sysctl.conf vm.swappiness=0 #apply settings sysctl -p # check cat /proc/sys/vm/swappiness Vacuum swap 1 2 swapoff -a swapon -a ","date":"2019-08-09T16:16:39+08:00","permalink":"https://echowings.github.io/p/how-to-change-default-swap-settings-for-proxmox-ve/","title":"How to Change Default Swap Settings for Proxmox Ve"},{"content":"How to Setup Vyos as a Firewall Setup interface Interface IP Address Description eth0 pppoe WAN eth1 192.168.68.1 / 24 DMZ eth2 10.0.0.1 / 24 LAN 1 2 3 4 5 6 7 8 9 10 set interface ethernet eth0 pppoe 0 user-id \u0026#39;\u0026lt;pppoe accout\u0026gt;\u0026#39; set interface ethernet eth0 pppoe 0 password \u0026#39;\u0026lt;pppoe password\u0026gt;\u0026#39; set interface ethernet eth0 pppoe 0 name-server \u0026#39;none\u0026#39; set interface ethernet eth0 description \u0026#39;WAN\u0026#39; set interface ethernet eth1 address 192.168.68.1/24 set interface ethernet eth1 description DMZ set interface ethernet eth2 address 10.0.0.1/24 set interface ethernet eth2 description \u0026#39;LAN\u0026#39; DHCP Server 1 2 3 4 5 set shared-network-name lan.local subnet 192.168.68.0/24 default-router 192.168.68.1 set shared-network-name lan.local subnet 192.168.68.0/24 dns-server 192.168.68.1 set shared-network-name lan.local subnet 192.168.68.0/24 domain-name lan.local set shared-network-name lan.local subnet 192.168.68.0/24 range 0 start 192.168.50 set shared-network-name lan.local subnet 192.168.68.0/24 range 0 stop 192.168.68.254\u0026#39; DNS forwarding 1 2 3 set cache-size \u0026#39;0\u0026#39; set listen-address 192.168.68.1 set name-server \u0026lt;public dns server ip ,like 8.8.8.8\u0026gt; Set loging banner You are able to set post-login or pre-login messages with the following lines:\n1 2 set system login banner pre-login \u0026#34;UNAUTHORIZED USE OF THIS SYSTEM IS PROHIBITED\\n\u0026#34; set system login banner post-login \u0026#34;Welcome to VyOS\u0026#34; NAT SNAT 1 2 3 set source rule 10 outbound-interface pppoe0 set source rule 10 source address 192.168.68.0/24 set source rule 10 translation address masquerade DNAT 1 2 3 4 5 6 set nat destination rule 10 destination address \u0026#39;10.0.0.5\u0026#39; set nat destination rule 10 destination port \u0026#39;3389\u0026#39; set nat destination rule 10 inbound-interface \u0026#39;eth2\u0026#39; set nat destination rule 10 protocol \u0026#39;tcp_udp\u0026#39; set nat destination rule 10 translation address \u0026#39;192.168.68.50\u0026#39; set nat destination rule 10 translation port \u0026#39;3389\u0026#39; Default routing 1 set static interface-route 0.0.0.0/0 next-hop-interface pppoe0 Setting of firewall Zone base firewall 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 # Chang firewall to statue firewall set firewall state-policy established action \u0026#39;accept\u0026#39; set firewall state-policy related action \u0026#39;accept\u0026#39; set firewall state-policy invalid action \u0026#39;drop\u0026#39; # Set Zone for interfaces set zone-policy zone dmz interface \u0026#39;eth1\u0026#39; set zone-policy zone private interface \u0026#39;eth2\u0026#39; set zone-policy zone local local-zone set zone-policy zone public interface \u0026#39;pppoe0\u0026#39; # define firewall policy set firewall name dmz-local default-action \u0026#39;drop\u0026#39; set firewall name dmz-local rule 10 action \u0026#39;accept\u0026#39; set firewall name dmz-local rule 10 destination address \u0026#39;192.168.68.1\u0026#39; set firewall name dmz-local rule 10 destination port \u0026#39;53\u0026#39; set firewall name dmz-local rule 10 protocol \u0026#39;udp\u0026#39; set firewall name dmz-local rule 11 action \u0026#39;accept\u0026#39; set firewall name dmz-local rule 11 icmp type-name \u0026#39;echo-request\u0026#39; set firewall name dmz-local rule 11 protocol \u0026#39;icmp\u0026#39; set firewall name dmz-private default-action \u0026#39;drop\u0026#39; set firewall name dmz-private rule 10 action \u0026#39;accept\u0026#39; set firewall name dmz-private rule 10 destination address \u0026#39;192.168.68.1\u0026#39; set firewall name dmz-private rule 10 destination port \u0026#39;53\u0026#39; set firewall name dmz-private rule 10 protocol \u0026#39;udp\u0026#39; set firewall name dmz-public default-action \u0026#39;accept\u0026#39; set firewall name local-dmz default-action \u0026#39;accept\u0026#39; set firewall name local-private default-action \u0026#39;accept\u0026#39; set firewall name local-public default-action \u0026#39;accept\u0026#39; set firewall name private-dmz default-action \u0026#39;accept\u0026#39; set firewall name private-local default-action \u0026#39;accept\u0026#39; # Allow ping set firewall name private-local rule 1 action \u0026#39;accept\u0026#39; set firewall name private-local rule 1 icmp type-name \u0026#39;echo-request\u0026#39; set firewall name private-local rule 1 protocol \u0026#39;icmp\u0026#39; set firewall name private-public default-action \u0026#39;accept\u0026#39; set firewall name public-dmz default-action \u0026#39;drop\u0026#39; set firewall name public-local default-action \u0026#39;drop\u0026#39; set firewall name public-private default-action \u0026#39;drop\u0026#39; set zone-policy zone dmz default-action \u0026#39;drop\u0026#39; set zone-policy zone private default-action \u0026#39;drop\u0026#39; set zone-policy zone public default-action \u0026#39;drop\u0026#39; set zone-policy zone dmz from local firewall name \u0026#39;local-dmz\u0026#39; set zone-policy zone dmz from private firewall name \u0026#39;private-dmz\u0026#39; set zone-policy zone dmz from public firewall name \u0026#39;public-dmz\u0026#39; set zone-policy zone local from dmz firewall name \u0026#39;dmz-local\u0026#39; set zone-policy zone local from private firewall name \u0026#39;private-local\u0026#39; set zone-policy zone local from public firewall name \u0026#39;public-local\u0026#39; set zone-policy zone private from dmz firewall name \u0026#39;dmz-private\u0026#39; set zone-policy zone private from local firewall name \u0026#39;local-private\u0026#39; set zone-policy zone private from public firewall name \u0026#39;public-private\u0026#39; set zone-policy zone public from dmz firewall name \u0026#39;dmz-public\u0026#39; set zone-policy zone public from local firewall name \u0026#39;local-public\u0026#39; set zone-policy zone public from private firewall name \u0026#39;private-public\u0026#39; set firewall all-ping \u0026#39;enable\u0026#39; set firewall broadcast-ping \u0026#39;disable\u0026#39; set firewall config-trap \u0026#39;disable\u0026#39; set firewall receive-redirects \u0026#39;disable\u0026#39; set firewall send-redirects \u0026#39;enable\u0026#39; set firewall source-validation \u0026#39;disable\u0026#39; set firewall syn-cookies \u0026#39;enable\u0026#39; set firewall twa-hazards-protection \u0026#39;disable\u0026#39; set firewall ip-src-route \u0026#39;disable\u0026#39; set firewall ipv6-receive-redirects \u0026#39;disable\u0026#39; set firewall ipv6-src-route \u0026#39;disable\u0026#39; set firewall log-martians \u0026#39;enable\u0026#39; commit save ","date":"2019-08-08T13:58:35+08:00","permalink":"https://echowings.github.io/p/how-to-setup-vyos-as-a-firewall/","title":"How to Setup Vyos as a Firewall"},{"content":"How to Deploy Bookstack with Docker Compose Bookstack is a good opensource solution for enterprie document management with light footprinting. It support auth like ldap,active directory,google,azure,aws,slack etc. and it can export document as pdf file.\nPreparation Install docker and docker-compose on debian 10 Information for bookstack installation. Type Value Hostname mybookstack Domainame mydomain.local AD Auth User stevedong Domain Controller IP \u0026lt;domain contoller IP\u0026gt; Time Zone Asia/Shanghai How to fix export chinese pdf document with error Install chinese fonts on docker server host 1 apt install fonts-wqy-microhei fonts-wqy-zenhei xfonts-wqy customized dockerfile with option: 1 2 3 4 5 6 7 8 environments: # To let bookstack export pdf with chinese language supported. - WKHTMLTOPDF=/usr/bin/wkhtmltopdf # To let bookstack export pdf with chinese language supported. - LANG=C.UTF-8 volumes: # To let bookstack export pdf with chinese language supported. - /usr/share/fonts/truetype:/usr/share/fonts/truetype Enable Active Directory Auth 1 2 3 4 5 6 7 8 9 10 11 12 - AUTH_METHOD=ldap # LDAP Settings - LDAP_SERVER=ldap://\u0026lt;Domain_controller_IP\u0026gt;:389 - LDAP_BASE_DN=dc=mydomain,dc=local - LDAP_DN=stevedong@mydomain.local - LDAP_PASS=\u0026lt;password of AD USER\u0026gt; #use double $$ since we are using docker - LDAP_USER_FILTER=(\u0026amp;(sAMAccountName=$${user})) - LDAP_VERSION=3 - LDAP_EMAIL_ATTRIBUT=mail - LDAP_DISPLAY_NAME_ATTRIBUTE=cn save follow content to Docker-compose.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 bookstack: image: linuxserver/bookstack container_name: bookstack environment: - TZ=Asia/Shanghai - PUID=1000 - PGID=1000 - DB_HOST=bookstack_db - DB_USER=bookstack - DB_PASS=\u0026lt;changepassword\u0026gt; - DB_DATABASE=bookstackapp - APP_ENV=production - APP_DEBUG=false #- APP_LANG=zh_CN - APP_URL=http://mybookstack.mydomain.local # General auth # Change to local auth with replace `ldap` with `standard` - AUTH_METHOD=ldap # LDAP Settings - LDAP_SERVER=ldap://\u0026lt;Domain_controller_IP\u0026gt;:389 - LDAP_BASE_DN=dc=mydomain,dc=local #- LDAP_DN=cn=stevedong,dc=mydomain,dc=local - LDAP_DN=stevedong@mydomain.local - LDAP_PASS=\u0026lt;password of AD USER\u0026gt; #use double $$ since we are using docker - LDAP_USER_FILTER=(\u0026amp;(sAMAccountName=$${user})) - LDAP_VERSION=3 - LDAP_EMAIL_ATTRIBUT=mail #- LDAP_EMAIL_ATTRIBUT=false - LDAP_DISPLAY_NAME_ATTRIBUTE=cn #AD Group Sync - LDAP_USER_TO_GROUPS=true - LDAP_GROUP_ATTRIBUTE=\u0026#34;memberof\u0026#34; - LDAP_REMOVE_FROM_GROUPS=false - LDAP_AUTO_CONFIRM_EMAIL=true - LDAP_TLS_INSECURE=true # To let bookstack export pdf with chinese language supported. - WKHTMLTOPDF=/usr/bin/wkhtmltopdf # To let bookstack export pdf with chinese language supported. - LANG=C.UTF-8 volumes: - ./bookstack_config:/config #mapped docker server fonts to docker - /usr/share/fonts/truetype:/usr/share/fonts/truetype ports: - 80:80 restart: unless-stopped depends_on: - bookstack_db bookstack_db: image: linuxserver/mariadb container_name: bookstack_db environment: - PUID=1000 - PGID=1000 - MYSQL_ROOT_PASSWORD=\u0026lt;mysql password\u0026gt; - TZ=Asia/Shanghai - MYSQL_DATABASE=bookstackapp - MYSQL_USER=bookstack - MYSQL_PASSWORD=\u0026lt;mysql password\u0026gt; volumes: - ./db_config:/config restart: unless-stopped Run Docker-compose change value to fit your environment Run bookstack with command docker-compose up -d Test till you can login bookstack with an active directory user account. Change AD user role from viewer to Admin stop docker-compose docker-compose down Modify Docker-compose.yml to change - AUTH_METHOD=ldap to - AUTH_METHOD=standard Start docker-compsoe docker-compsoe up -d Login bookstack with username admin@admin.com and password password.Then change your AD user account role from guest to admin. Then stop docker with command docker-compsoe down Modify Docker-compose.yml to change -AUTH_METHOD=standard back to -AUTH_METHOD=ldap Start bookstack dockers with command docker-composed up -d. Then you can login bookstack with your AD account as an administrator. Reference solidnerd/docker-bookstack linuxserver/docker-bookstack Install and Configure BookStack Using Docker and LDAP successage/bookstack ","date":"2019-07-30T16:22:52+08:00","permalink":"https://echowings.github.io/p/how-to-deploy-bookstack-with-docker-compose/","title":"How to Deploy Bookstack With Docker Compose"},{"content":"How to configure debian 10 as a docker server After try to install docker in LXC with proxmox ve, there will be some issues to make docker stop working. At last, I gave up and brance pure linux as docker sever.\nInstall debian 10 in promxox ve Configure deiban 10 vm with \u0026lsquo;qemu-agent\u0026rsquo; checked.\nAfter install deiban 10 Change source list 1 2 3 4 5 6 7 mv /etc/apt/sources.list /etc/apt/sources.list.backup wget https://mirrors.ustc.edu.cn/repogen/conf/debian-http-4-buster -O /etc/apt/sources.list apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y openssh-server git vim cloud-init apt-transport-https sed -i \u0026#39;s/http/https/g\u0026#39; /etc/apt/sources.list apt update \u0026amp;\u0026amp; apt -y dist-upgrade To fix perl error warning option 1: 1 2 3 4 5 6 7 8 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF option 2: 1 2 3 4 sudo echo \u0026#34;LC_ALL=en_US.UTF-8\u0026#34; \u0026gt;\u0026gt; /etc/environment sudo echo \u0026#34;en_US.UTF-8 UTF-8\u0026#34; \u0026gt;\u0026gt; /etc/locale.gen sudo echo \u0026#34;LANG=en_US.UTF-8\u0026#34; \u0026gt; /etc/locale.conf sudo locale-gen en_US.UTF-8 vim setting How to Setup Vim cloud-init How to Setup Cloud Init in Proxmoxve Install docker on debian 10 Step 1: Install Dependency packages Start the installation by ensuring that all the packages used by docker as dependencies are installed.\n1 2 3 4 5 6 sudo apt-get -y install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg2 \\ software-properties-common Step 2: Add docker\u0026rsquo;s offical GPG key: Import Docker GPG key used for signing Docker packages:\n1 2 curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add - apt-key fingerprint 0EBFCD88 Step 3: Add the docker repository to Debian 10 1 2 3 4 sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.docker.com/linux/debian \\ $(lsb_release -cs) \\ stable\u0026#34; Step 4: Change docker repository to mirrors.ustc.edu.cn 1 sed -i \u0026#39;s/download.docker.com/mirrors.ustc.edu.cn\\/docker-ce/g\u0026#39; /etc/apt/sources.list Step 5: Install docker and docker-compose on debian 10 1 2 apt update apt -y install docker-ce docker-compose Step 6: Chang docker hub mirrors to mirrors.ustc.edu.cn 1 2 3 4 cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/default/docker DOCKER_OPTS=\u0026#34;--registry-mirror=https://docker.mirrors.ustc.edu.cn/\u0026#34; EOF systemctl restart docker Change Some settings Enable password authentication 1 2 3 sudo sed -i \u0026#39;s/PasswordAuthentication\\ no/PasswordAuthentication\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd Permit root can loing with password 1 2 3 sudo sed -i \u0026#39;s/#PermitRootLogin\\ prohibit-password/PermitRootLogin\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd Change machine-id 1 2 3 rm /var/lib/dbus/machine-id truncate -s 0 /etc/machine-id ln -s /etc/machine-id /var/lib/dbus/machine-id \u0026mdash;THE END\u0026mdash;\nSwell Cannot set LC_CTYPE to default locale: No such file or directory ","date":"2019-07-26T16:58:29+08:00","permalink":"https://echowings.github.io/p/how-to-configure-debian-10-as-a-docker-server/","title":"How to Configure Debian 10 as a Docker Server"},{"content":"How to deploy docker in debian 10 1 2 3 cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/docker/aemon.json\\n{\\n \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://docker.mirrors.ustc.edu.cn/\u0026#34;]\\n}\\n\\nEOF systemctl retart docker systemctl restart docker Install docker-compose 1 2 3 4 5 sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose ","date":"2019-07-19T10:52:56+08:00","permalink":"https://echowings.github.io/p/how-to-deploy-docker-in-debian-10/","title":"How to Deploy Docker in Debian 10"},{"content":"How to Modify Template im Proxox VE Sometime I wonder how to convert template back to vm and modify it and convert it back to vm? Here is the solution\nConvert Template to VM Delete template: 1 in vm config.\n1 sed -i \u0026#39;s/template:\\ 1//g\u0026#39; /etc/pve/qemu-server/{vm-id}.conf Change access permission of VM disk 1 2 3 cd /var/lib/vz/images/1{VM-ID}/ chattr -i * chmod 755 * Then covert it back to template ","date":"2019-07-18T12:23:01+08:00","permalink":"https://echowings.github.io/p/how-to-modify-template-in-proxmox-ve/","title":"How to Modify Template in Proxmox Ve"},{"content":"Install Proxmox VE 6.x After installed Proxmox VE 6.x, What we gone do ?\nDownload Proxmox VE 6.x iSO file in mirrors.ustc.edu.cn Download iso images from here:\nhttp://mirrors.ustc.edu.cn/proxmox/iso/\nFixe Perl error waring 1 2 3 4 5 6 7 8 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF Disable subscription Warning Disable subscription warning via script below 6.3\n1 sed -i.bak \u0026#34;s/data.status !== \u0026#39;Active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service Manually disable subscription warning 1 2 3 4 5 6 7 8 9 10 11 cd /usr/share/javascript/proxmox-widget-toolkit cp proxmoxlib.js proxmoxlib.js.bak nano proxmoxlib.js # change the value as show below if (data.status !== \u0026#39;Active\u0026#39;) { #to if (false) { #restart pveproxy.service systemctl restart pveproxy.service above 6.3\n1 sed -Ezi.bak \u0026#34;s/(Ext.Msg.show\\(\\{\\s+title: gettext\\(\u0026#39;No valid sub)/void\\(\\{ \\/\\/\\1/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service manual setup Manual Steps Here are alternative step by step instructions so you can understand what the above command is doing:\nChange to working directory 1 cd /usr/share/javascript/proxmox-widget-toolkit Make a backup 1 cp proxmoxlib.js proxmoxlib.js.bak Edit the file 1 nano proxmoxlib.js Locate the following code (Use ctrl+w in nano and search for “No valid subscription”) 1 2 Ext.Msg.show({ title: gettext(\u0026#39;No valid subscription\u0026#39;), Replace “Ext.Msg.show” with “void” 1 2 void({ //Ext.Msg.show({ title: gettext(\u0026#39;No valid subscription\u0026#39;), Restart the Proxmox web service (also be sure to clear your browser cache, depending on the browser you may need to open a new tab or restart the browser) 1 systemctl restart pveproxy.service Additional Notes You can quickly check if the change has been made:\n1 grep -n -B 1 \u0026#39;No valid sub\u0026#39; proxmoxlib.js You have three options to revert the changes:\nManually edit proxmoxlib.js to to undo the changes you made Restore the backup file you created from the proxmox-widget-toolkit directory 1 mv proxmoxlib.js.bak proxmoxlib.js Reinstall the proxmox-widget-toolkit package from the repository 1 apt-get install --reinstall proxmox-widget-toolkit Chang apt sourcelist to mirrors.ustc.edu.cn 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 #Backup sources.list mv /etc/apt/sources.list /etc/apt/sources.list.backup # Change debian 10 sourcelist to mirrors.ustc.edu.cn # https://mirrors.ustc.edu.cn/repogen/ cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ buster main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ buster-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ buster/updates main contrib non-free EOF # Add pve-no-subscription with mirrors.ustc.edu.cn #change pve 5.x update source list cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/proxmox/debian/pve/ buster pve-no-subscription EOF ##change ceph source list to utsc mirrors cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-nautilus/ buster main EOF # Add Key wget https://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-6.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-6.x.gpg # Delete `pve-enterprise.list` rm -rf /etc/apt/sources.list.d/pve-enterprise.list # Upgrade pve apt update \u0026amp;\u0026amp; apt -y dist-upgrade pveupdate \u0026amp;\u0026amp; pveupgrade -y # update grub settings update-grub Install openvswitch 1 apt install -y openvswitch-switch ","date":"2019-07-17T16:07:55+08:00","permalink":"https://echowings.github.io/p/install-proxmox-ve-6.x/","title":"Install Proxmox VE  6.x"},{"content":"How to upgrade RHEL6 with yum repo of centos Today I will show you how to setup rhel6 at proxmox VE.\nAfter installed REHL6.8,We didn\u0026rsquo;t have RHEL subscription,but how to get update and install software via yum ? The right answer is to change yum repo.\nFix perl error 1 2 3 4 5 6 7 8 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF Disable RHEL subsription 1 subscription-manager config --rhsm.manage_repos=0 Chang yum repo to Centos 6 delete rhel yum software 1 2 rpm -qa | grep yum rpm -qa | grep yum | xargs rpm -e --nodeps Download centos yum software 1 2 3 4 5 6 mkdir -p /tmp/yum cd /tmp/yum wget http://mirrors.163.com/centos/6/os/x86_64/Packages/python-iniparse-0.3.1-2.1.el6.noarch.rpm wget http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-3.2.29-81.el6.centos.noarch.rpm wget http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-metadata-parser-1.1.2-16.el6.x86_64.rpm wget http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.30-41.el6.noarch.rpm Install centos yum software 1 2 3 rpm -ivh python-iniparse-0.3.1-2.1.el6.noarch.rpm rpm -ivh yum-metadata-parser-1.1.2-16.el6.x86_64.rpm rpm -ivh yum-3.2.29-81.el6.centos.noarch.rpm yum-plugin-fastestmirror-1.1.30-41.el6.noarch.rpm Delete other repos file 1 rm -rf /etc/yum.repos.d/* Download yum.repos file of centos. 1 2 3 4 wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo sed -i \u0026#39;s/$releasever/6/g\u0026#39; CentOS-Base.repo yum clean all yum makecache Install cloud-ini and qemu-guest-agent 1 2 yum update yum install cloud-init qemu-guest-agent Then enable qemu agent in option and add a cloud-init disk in vm settings on proxmox ve.\nChange SSH config to allow user login with password 1 2 3 4 sudo sed -i \u0026#39;s/PasswordAuthentication\\ no/PasswordAuthentication\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo sed -i \u0026#39;s/#PermitRootLogin\\ prohibit-password/PermitRootLogin\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo service ssh restart sudo service sshd restart ","date":"2019-07-15T17:07:51+08:00","permalink":"https://echowings.github.io/p/how-to-upgrade-rhel6-with-yum-repo-of-centos/","title":"How to upgrade RHEL6 with yum repo of centos "},{"content":"How to setup cloud-init in prxmox ve Cloud-init can help us to deploy or change settings of linux virutal machine via api or manually by ourself.\nThere are two ways to setup cloud-init: command line or change settings in GUI.\nOption 1: Download cloud-init image and setup with shell Please reference my blog Build Ubuntu 18.04 server with cloudinit support\nOption 2: Manually Setup cloud-init We can do this with 2 steps. 1st step is to install linux(centos,debian,ubunt etc).\nInstall a linux I think this step is easy.\nInstall and setup cloud-init After installed an linux.\ndebian/ubuntu 1 2 apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y cloud-init RHEL/Centos 1 2 yum upate yum install -y cloud-init Create a cloud-init boot disk shutdown the vm shutdown -h now select the vm in PVE web GUI. Then click Hardware. click Add button and select Cloudinit drive. Select Storage on the storage. Then Click Create to create cloudinit drive. Right click the VM and click start to boot the VM. Change some settings After setup cloud-init, Seem like it automatically reset your sourelist to default settings and we couldn\u0026rsquo;t login via ssh with password.\nEnable password authentication 1 2 3 sudo sed -i \u0026#39;s/PasswordAuthentication\\ no/PasswordAuthentication\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd Permit root can loing with password 1 2 3 sudo sed -i \u0026#39;s/#PermitRootLogin\\ prohibit-password/PermitRootLogin\\ yes/g\u0026#39; /etc/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd Change machine-id 1 2 3 rm /var/lib/dbus/machine-id truncate -s 0 /etc/machine-id ln -s /etc/machine-id /var/lib/dbus/machine-id change hostname with ubuntu 18.04 1 2 3 4 5 6 7 8 9 10 11 12 sed -i \u0026#39;s/preserve_hostname:\\ false/preserve_hostname:\\ true/g\u0026#39; /etc/cloud/cloud.cfg #check settings cat /etc/cloud/cloud.cfg |grep preserve_hostname # If it works and you will see: #preserve_hostname: true #Set hostname to myserver-forloadbalance2-node175 hostnamectl set-hostname myserver-forloadbalance2-node-175 # reboot host reboot now Permit modified sourelist 1 2 3 sudo cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/cloud/cloud.cfg apt_preserve_sources_list: true EOF Then you can change sourelist without worried about the sourcelist will be overwriten by cloud-init\nMachines that fight over the same IP address ","date":"2019-07-12T14:04:03+08:00","permalink":"https://echowings.github.io/p/how-to-setup-cloud-init-in-proxmoxve/","title":"How to Setup Cloud Init in Proxmoxve"},{"content":"Build Ubuntu 18.04 with cloudinit support on proxmox VE To create a ubuntu images from iso file is not flexible for us to clone and deploy a new virtual machine. we can now setting networking, hostname or other configuration before boot the server with configuration. If we want to expand the capicity of the disk, we need a lot of command to reach the goal.\nWith cloudinit images it is easy to do that.\nDownlaod ubuntu 18.04 cloudinit images 1 2 3 4 5 6 7 8 9 10 11 #download cloudinit images of ubuntu 18.04 for kvm #change directory to dicrectory of image storage. cd /var/lib/vz/images #Option 1: For China User,Download images from ustc mirror for china users wget http://mirrors.ustc.edu.cn/ubuntu-cloud-images/bionic/current/bionic-server-cloudimg-amd64.img # Option 2: For other country,Download images from offical website. wget https://cloud-images.ubuntu.com/bionic/current/bionic-server-cloudimg-amd64.img Create cloudinit template 1 2 3 4 5 6 7 8 9 10 11 # create a new VM with name template-ubuntu18.04server-cloudinit qm create 9000 --memory 4096 --net0 virtio,bridge=vmbr0 --name template-ubuntu18.04server-cloudinit # import the downloaded disk to local-lvm storage qm importdisk 9000 bionic-server-cloudimg-amd64.img local-lvm # Attach the new disk to the vm as scsi driver qm set 9000 --scsihw virtio-scsi-pci --scsi0 local-lvm:9000/vm-9000-disk-0.raw Add Cloud-init CDROM drive The next step is to configure a CDROM drive which will be used to pass the Cloud-init data to the VM.\n1 2 qm set 9000 --ide2 local-lvm:cloudinit Make the virtual machine boot from cdrom to make cloud init running firstly.\n1 2 qm set 9000 --boot c --bootdisk scsi0 configure a serial console.\n1 2 qm set 9000 --serial0 socket --vga serial0 Convert the vm to template. We can not run the vm directly. By the way, to convert template to vm just edit vm configuration file to delete template: 1.\n1 2 3 vi /etc/pve/qemu-server/9000.conf # The delete `template: 1` Deploy virtual machine Login PVE web gui and right click template with ID 9000.\nChange Mode: to Full Clone. Change Name: to \u0026lsquo;xa-wyn-autotest01`(This step also set hostname of the VM.) Change VM settings. Select the deployed VM on the pve gui. Then Click Cloud-init. Change \u0026ldquo;User\u0026rdquo; to any username you wanted. Change \u0026ldquo;Password\u0026rdquo; for the user. SSH public key: you can upload your ssh publickey to the vm. \u0026ldquo;Options\u0026rdquo;|\u0026ldquo;Qemu-Agent\u0026rdquo; | check on \u0026ldquo;Qemua Agent\u0026rdquo; and \u0026ldquo;Run guest-trim after clone disk\u0026rdquo;. Settings after booting. After booting and the cloudinit will running to setting the vm as you wanted. After that we need change something base on our location.\nInstall some software 1 2 apt update \u0026amp;\u0026amp; apt -y dist-upgrade apt install -y vim apt-transport-https qemu-guest-agent vim net-tools Then you can check \u0026ldquo;Summary\u0026rdquo; of the VM with \u0026ldquo;IPS\u0026rsquo;. We cant seed the ip address in pve web gui.\nChang sourcelist to mirrors.ustc.com Please select right sourcelist to match your linux version. mirrors.ustc.edu.cn repository file generator\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/apt/sources.list deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse ## Not recommended # deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse # deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse EOF apt update \u0026amp;\u0026amp; apt -y dist-upgrade Install docker 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 apt-get -y install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg-agent \\ software-properties-common \\ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - apt-key fingerprint 0EBFCD88 sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable\u0026#34; sed -i \u0026#39;s/download.docker.com/mirrors.ustc.edu.cn\\/docker-ce/g\u0026#39; /etc/apt/sources.list apt-get update apt-get install -y docker-ce docker-ce-cli containerd.io Instlal Docker-compose 1 2 3 4 5 sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose Extend disk size of vm. Shutdown the vm then change disk size as you wish ,After that start the vm. Extend disk is easy.\nEnable SSH password Authentication 1 2 3 sudo sed -i \u0026#39;s/PasswordAuthentication\\ no/PasswordAuthentication\\ yes/g\u0026#39; /et/c/ssh/sshd_config sudo systemctl daemon-reload sudo systemctl restart sshd Swell qm command Cloud-Init Support ","date":"2019-06-12T11:22:48+08:00","permalink":"https://echowings.github.io/p/build-ubuntu-18.04-server-with-cloudinit-support/","title":"Build Ubuntu 18.04 server with cloudinit support"},{"content":"How to deploy librenms with docker-compsoe Librenms is a very light and easy handle moniting software. It is suitable for us to monitoring server,network device, printers etc. via snmp.\nAt now, docker is easy for software deployment. After deploy librenms in ubuntu vm, I have a try to deploy librenms with docker-compose.\nDownload config files 1 2 3 4 5 6 7 8 9 10 11 12 13 mkdir librenms-docker-compose cd librenms-docker-compose #Download .env file wget https://raw.githubusercontent.com/librenms/docker/master/examples/compose/.env # Download docker-compose file wget https://raw.githubusercontent.com/librenms/docker/master/examples/compose/docker-compose.yml # Download librenms.env file wget https://raw.githubusercontent.com/librenms/docker/master/examples/compose/librenms.env touch acme.json chmod 600 acme.json librenms server configuration As show below , I will deploy a librenms via docker in my lan network. the host name is mylibrenms,my local domain name is private.local.\nType value Librenms host name mylibrenms Domain name private.local Name myname mail account myname@private.local snmp community public Modify .env 1 vi .env Change configure :\n1 2 3 4 5 6 7 8 9 10 11 MYSQL_DATABASE=mylibrenms MYSQL_USER=mylibrenms MYSQL_PASSWORD=mylibrenmspassword SMTP_SERVER=smtp.private.local SMTP_USERNAME=myname@private.local SMTP_PASSWORD=myPassword TZ=Asia/Chongqing PUID=1000 PGID=1000 Modify docker-compose.yml 1 vi docker-compose.yml Change treafik config Change services: | treafik: | command: | - \u0026quot;--docker.domain=\u0026quot; to --docker.domain=private.local 1 sed -i \u0026#39;s/\\\u0026#34;--docker.domain=example.com\\\u0026#34;/\\\u0026#34;--docker.domain=private.local\\\u0026#34;/g\u0026#39; docker-compose.yml Change services: | treafik: | command: | - \u0026quot;--acme.email=\u0026quot; to - \u0026quot;--acme.email=\u0026quot;myname@private.local\u0026quot; 1 sed -i \u0026#39;s/\\\u0026#34;--acme.email=webmaster@example.com\\\u0026#34;/\\\u0026#34;--acme.email=myname@private.local\\\u0026#34;/g\u0026#39; docker-compose.yml Change smtp config Change services: | smtp: | environment: | - \u0026quot;SERVER_HOSTNAME=\u0026quot; to - \u0026quot;SERVER_HOSTNAME=mylibrenms.private.local\u0026quot; 1 sed -i \u0026#39;s/-\\ \\\u0026#34;SERVER_HOSTNAME=librenms.example.com\\\u0026#34;/-\\ \\\u0026#34;SERVER_HOSTNAME=mylibrenms.private.local\\\u0026#34;/g\u0026#39; docker-compose.yml Change librenms config Change services: | librenms: | domainname: to domainname: private.local. 1 sed -i \u0026#39;s/domainname:\\ example.com/domainname:\\ private.local/g\u0026#39; docker-compose.yml Change services: | librenms: | hostname: to hostname; mylibrenms. 1 sed -i \u0026#39;s/hostname:\\ librenms/hostname:\\ mylibrenms/g\u0026#39; docker-compose.yml Change services: | librenms: | labels: | - \u0026quot; traefik.frontend.rule=\u0026quot; to - \u0026quot;traefik.frontend.rule=Host:mylibrenms\u0026quot;. 1 sed -i \u0026#39;s/-\\ \\\u0026#34;traefik.frontend.rule=Host:librenms.example.com\\\u0026#34;/-\\ \\\u0026#34;traefik.frontend.rule=Host:mylibrenms.private.local\\\u0026#34;/g\u0026#39; docker-compose.yml Change cron config Change services: | cron: | domainname: to domainname: private.local.\nChange services: | cron: | hostname: to hostname: mylibrenms.\nChange syslog-ng: Change services: | syslog-ng: | domainname: to domainname: private.local. Change services: | syslog-ng: | hostname: to hostname: mylibrenms. Modify librenms.env Change LIBRENMS_SNMP_COMMUNITY= to LIBRENMS_SNMP_COMMUNITY=public. 1 sed -i \u0026#39;s/LIBRENMS_SNMP_COMMUNITY=librenmsdocker/LIBRENMS_SNMP_COMMUNITY=public/g\u0026#39; librenms.env Run docker-compose to up librenms containers 1 docker-compose up -d enable proxmox app moniting 1 2 3 4 5 cat \u0026lt;\u0026lt; EOF \u0026gt; librenms/config.php \u0026lt;?php $config[\u0026#39;enable_proxmox\u0026#39;] = true; EOF ","date":"2019-06-05T21:47:54+08:00","permalink":"https://echowings.github.io/p/how-to-deploy-librenms-with-docker-compose/","title":"How to Deploy Librenms With Docker-compose"},{"content":"How to install dirver of mellanox ConnectX 3 10Gbps netowrk adapter in proxmox-ve 5.x or diban 9 To \u0010\nInstall dependencies software 1 2 3 #dependencies apt-get -y install debhelper autotools-dev dkms zlib1g-dev python wget quilt python-libxml2 swig dpatch graphviz chrpath pve-headers Download driver for mellanox connectx 3 for debian 9.6 1 wget http://content.mellanox.com/ofed/MLNX_EN-4.6-1.0.1.1/mlnx-en-4.6-1.0.1.1-debian9.6-x86_64.tgz Install drivers 1 2 3 4 tar -zxvf mlnx-en-4.6-1.0.1.1-debian9.6-x86_64.tgz cd mlnx-en-4.6-1.0.1.1-debian9.6-x86_64 chmod +x install ./install --skip-distro-check Swell Mellanox EN Driver for Linux How-to Guide Install Mellanox Driver Proxmox VE 5.1 ","date":"2019-06-05T11:52:23+08:00","permalink":"https://echowings.github.io/p/how-to-install-driver-of-mellanox-connetcx-3-10gbps-network-adpater-in-promxox-ve-5.x-or-debian-9/","title":"How to Install driver of Mellanox ConnetcX 3 10Gbps Network Adpater in Promxox-VE 5.x or Debian 9"},{"content":"How to resize disk(no lvm) in proxmox ve Today I met a problem that I need to extend disk image for a ubuntu server which is a virtual machine hosted in proxmox ve.\nResizing disk images First thing first, I need resize the disk images of the virtual machine.I can do it both in command line or via web management interface.\nExtend disk size of virtual machine via shell command 1 2 # Extend disk size of virtual machine with vid 136 with 100G qm resize 136 virtio0 +100G Extend disk size of virtual machien via web interface \u0026quot;Datacenter\u0026quot; | \u0026quot;$Node\u0026quot; | $VIRTUAL_MACHINE | \u0026quot;HARDWARE\u0026quot; | \u0026quot;HARD DISK(SCSI0)\u0026quot; | \u0026quot;RESIZE DISK\u0026quot; | \u0026quot;size Increment(GiB) | \u0026quot;100\u0026quot; | \u0026quot;Resize disk\u0026quot;\nEnlarge the partition in the virtual disk Login the virtual machine and run command as show below:\nShow disk partition 1 2 # show disk device ls -al /dev/sda* Run parted with command parted /dev/sda 1 2 3 4 root@xxx-xxxx-server:~# parted /dev/sda GNU Parted 3.2 Using /dev/sda Welcome to GNU Parted! Type \u0026#39;help\u0026#39; to view a list of commands. print partitions. print 1 2 3 4 5 6 7 8 9 10 (parted) print Model: QEMU QEMU HARDDISK (scsi) Disk /dev/sda: 389GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 2097kB 1049kB bios_grub 2 30720kB 30GB 30GB ext4 Resize partition with command resizepart. 1 (parted) resizepart select partition which I wanted to resize. 2 1 Partition number? 2 Enter y to continue. 1 2 Warning: Partition /dev/sda2 is being used. Are you sure you want to continue? Yes/No? y Enter size 200GB 1 2 3 4 5 6 7 8 9 10 11 End? [30GB]? 200GB (parted) print Model: QEMU QEMU HARDDISK (scsi) Disk /dev/sda: 389GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 1049kB 2097kB 1049kB bios_grub 2 2097kB 200GB 200GB ext4 Quit parted with quit. 1 (parted) :quit Enlarge partition with resize2f 1 2 3 resize2f /dev/sda2 99G # Show size of partition df -h Swell Shrink Qcow2 Disk Files Resize disks How to Extend primary partition(/dev/sda1) in linux? ","date":"2019-05-28T15:20:53+08:00","permalink":"https://echowings.github.io/p/how-to-extend-ubuntu-no-lvm-disk-in-proxmox-ve/","title":"How to Extend Ubuntu No Lvm Disk in Proxmox VE"},{"content":"How to install overture on Vyos 1.2 I need to build a dns forwarding server to anti dns cache pollution.overture is a good choice for me. it writen in go with good performance. Here we go!\nDownload ovrture you can check overture version from here\nLogin vyos . 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 sudo su overture_version=v1.6.1 sudo mkdir -p /tmp/overture-linux-amd64 cd /tmp sudo curl -fsSLO --compressed \u0026#34;https://github.com/shawn1m/overture/releases/download/$overture_version/overture-linux-amd64.zip\u0026#34; sudo unzip /tmp/overture-linux-amd64.zip -d /tmp/overture-linux-amd64 cd /tmp/overture-linux-amd64 sudo curl -fsSLO https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt sudo curl -fsSLO https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt curl https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt | base64 -d | sort -u | sed \u0026#39;/^$\\|@@/d\u0026#39;| sed \u0026#39;s#!.\\+##; s#|##g; s#@##g; s#http:\\/\\/##; s#https:\\/\\/##;\u0026#39; | sed \u0026#39;/\\*/d; /apple\\.com/d; /sina\\.cn/d; /sina\\.com\\.cn/d; /baidu\\.com/d; /qq\\.com/d\u0026#39; | sed \u0026#39;/^[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+$/d\u0026#39; | grep \u0026#39;^[0-9a-zA-Z\\.-]\\+$\u0026#39; | grep \u0026#39;\\.\u0026#39; | sed \u0026#39;s#^\\.\\+##\u0026#39; | sort -u \u0026gt; /tmp/temp_gfwlist.txt curl https://raw.githubusercontent.com/hq450/fancyss/master/rules/gfwlist.conf | sed \u0026#39;s/ipset=\\/\\.//g; s/\\/gfwlist//g; /^server/d\u0026#39; \u0026gt; /tmp/temp_koolshare.txt cat /tmp/temp_gfwlist.txt /tmp/temp_koolshare.txt | sort -u \u0026gt; gfw_all_domain.txt #Download china domain list from https://github.com/felixonmars/dnsmasq-china-list curl -fsSLO --compressed https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/accelerated-domains.china.conf #Downlaod apple china domain list curl -fsSLO --compressed https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/apple.china.conf #Download google china domain list curl -fsSLO --compressed https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/google.china.conf #Download cdn in china list curl -fsSLO --compressed https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/cdn-testlist.txt # cat accelerated-domains.china.conf cdn-testlist.txt google.china.conf apple.china.conf | sort -u \u0026gt;\u0026gt; china_domain.txt # Strip useless characters in the configure file. sed -i \u0026#39;s/server=\\///g\u0026#39; china_domain.txt sed -i \u0026#39;s/\\/114.114.114.114//g\u0026#39; china_domain.txt sudo mv config.json config.json.origin sudo bash -c \u0026#39;cat \u0026gt; /etc/overture/config.json\u0026#39; \u0026lt;\u0026lt;EOF { \u0026#34;BindAddress\u0026#34;: \u0026#34;127.0.1.1:53\u0026#34;, \u0026#34;PrimaryDNS\u0026#34;: [ { \u0026#34;Name\u0026#34;: \u0026#34;DNSPod\u0026#34;, \u0026#34;Address\u0026#34;: \u0026#34;119.29.29.29:53\u0026#34;, \u0026#34;Protocol\u0026#34;: \u0026#34;udp\u0026#34;, \u0026#34;SOCKS5Address\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Timeout\u0026#34;: 15, \u0026#34;EDNSClientSubnet\u0026#34;: { \u0026#34;Policy\u0026#34;: \u0026#34;disable\u0026#34;, \u0026#34;ExternalIP\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;NoCookie\u0026#34;: true } } ], \u0026#34;AlternativeDNS\u0026#34;: [ { \u0026#34;Name\u0026#34;: \u0026#34;OpenDNS\u0026#34;, \u0026#34;Address\u0026#34;: \u0026#34;208.67.222.222:53\u0026#34;, \u0026#34;Protocol\u0026#34;: \u0026#34;udp\u0026#34;, \u0026#34;SOCKS5Address\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Timeout\u0026#34;: 60, \u0026#34;EDNSClientSubnet\u0026#34;: { \u0026#34;Policy\u0026#34;: \u0026#34;disable\u0026#34;, \u0026#34;ExternalIP\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;NoCookie\u0026#34;: true } } ], \u0026#34;OnlyPrimaryDNS\u0026#34;: false, \u0026#34;IPv6UseAlternativeDNS\u0026#34;: false, \u0026#34;WhenPrimaryDnsAnswerNoneUse\u0026#34;: \u0026#34;AlternativeDNS\u0026#34;, \u0026#34;IPNetworkFile\u0026#34;: { \u0026#34;Primary\u0026#34;: \u0026#34;/etc/overture/china_ip_list.txt\u0026#34; }, \u0026#34;DomainFile\u0026#34;: { \u0026#34;Primary\u0026#34;: \u0026#34;/etc/overture/china_domain.txt\u0026#34;, \u0026#34;Alternative\u0026#34;: \u0026#34;/etc/overture/gfw_all_domain.txt\u0026#34;, \u0026#34;PrimaryMatcher\u0026#34;: \u0026#34;suffix-tree\u0026#34;, \u0026#34;AlternativeMatcher\u0026#34;: \u0026#34;final\u0026#34; }, \u0026#34;MinimumTTL\u0026#34;: 60, \u0026#34;CacheSize\u0026#34; : 2000, \u0026#34;RejectQType\u0026#34;: [255] } EOF sudo cp -af ./overture-linux-amd64 /usr/local/bin/overture sudo chown root:root /usr/local/bin/overture sudo chmod +x /usr/local/bin/overture sudo rsync -r --delete --exclude=\u0026#34;overture-linux-amd64\u0026#34; --exclude=\u0026#34;domain_sample\u0026#34; --exclude=\u0026#34;ip_network_sample\u0026#34; --exclude=\u0026#34;install.sh\u0026#34; ./ /etc/overture sudo bash -c \u0026#39;cat \u0026gt; /lib/systemd/system/overture.service\u0026#39; \u0026lt;\u0026lt; EOF [Unit] Description=overture service [Service] ExecStart=/usr/local/bin/overture -c /etc/overture/config.json -l /etc/overture/overture.log Restart=on-failure RestartSec=42s [Install] WantedBy=multi-user.target EOF sudo systemctl daemon-reload sudo rm -rf /tmp/overture-linux-amd64 sudo rm -rf /tmp/overture-linux-amd64.zip sudo systemctl enable overture sudo systemctl restart overture Reference overture-on-openwrt ","date":"2019-05-18T01:35:52+08:00","permalink":"https://echowings.github.io/p/how-to-install-overture-on-vyos-1.2.1-release/","title":"How to Install Overture on VYOS 1.2.1 release"},{"content":"How solove Proxmox VE 5.4 upgrade issue Today I\u0026rsquo;m trying to upgrade proxmox ve 5.3. to proxmox ve 5.4 version. But I failed. After install and uninstall proxmox-manager, Force to reboot and the node has kernel panic error. Then force reboot the node. At grub menu select second line to select an old pve kernel to boot proxmox-ve.\nERROR 1:\u0026ldquo;No space left on device\u0026rdquo; error on latest upgrade If you met issue like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #gzip: stdout: No space left on device #E: mkinitramfs failure find 141 cpio 141 gzip 1 #update-initramfs: failed for /boot/initrd.img-4.15.18-10-pve with 1. #run-parts: /etc/kernel/postinst.d/initramfs-tools exited with return code 1 #Failed to process /etc/kernel/postinst.d at /var/lib/dpkg/info/pve-#kernel-4.15.18-10-pve.postinst line 19. #dpkg: error processing package pve-kernel-4.15.18-10-pve (--configure): # subprocess installed post-installation script returned error exit status 2 #Setting up pve-xtermjs (3.10.1-1) ... #Setting up libpve-storage-perl (5.0-36) ... #dpkg: dependency problems prevent configuration of pve-kernel-4.15: # pve-kernel-4.15 depends on pve-kernel-4.15.18-10-pve; however: # Package pve-kernel-4.15.18-10-pve is not configured yet. #dpkg: error processing package pve-kernel-4.15 (--configure): # dependency problems - leaving unconfigured #Setting up libpve-guest-common-perl (2.0-19) ... #Setting up qemu-server (5.0-45) ... #Setting up pve-ha-manager (2.0-6) ... #Setting up pve-container (2.0-33) ... #Setting up pve-manager (5.3-8) ... #Processing triggers for initramfs-tools (0.130) ... #update-initramfs: Generating /boot/initrd.img-4.15.18-9-pve #gzip: stdout: No space left on device #E: mkinitramfs failure find 141 cpio 141 gzip 1 #update-initramfs: failed for /boot/initrd.img-4.15.18-9-pve with 1. #dpkg: error processing package initramfs-tools (--configure): # subprocess installed post-installation script returned error exit status 1 #Processing triggers for pve-ha-manager (2.0-6) ... #Processing triggers for systemd (232-25+deb9u8) ... #Errors were encountered while processing: # pve-kernel-4.15.18-10-pve # pve-kernel-4.15 # initramfs-tools #E: Sub-process /usr/bin/dpkg returned an error code (1) You can fixed it with command like this.\nSolution: List all of pve-kernel, Then remove pve-kernel except pve-kernel current your system running.\n1 2 3 4 5 6 7 8 9 10 11 12 # Check status of mounted filesytem df -h # Check lvm status lvs -a # List installed pve kernel dpkg -l | grep pve-kernel # Check current running kernel uname -r #Delete kernel old than current running kern apt purge pve-kernel-4.13.16-2-pve Error 2 :The configuration should be retried usingdpkg --configure \u0026lt;package\u0026gt; or the configure menu option in dselect When I met error like this.\nERROR Detail: dpkg: error processing package pve-ha-manager (\u0026ndash;configure): dependency problems - leaving triggers unprocessed Errors were encountered while processing: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 # $ apt update #$ apt upgrade #Reading package lists... Done #Building dependency tree #Reading state information... Done #Calculating upgrade... Done #0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded. #7 not fully installed or removed. #After this operation, 0 B of additional disk space will be used. #Do you want to continue? [Y/n] y #Setting up pve-cluster (5.0-30) ... #Failed to retrieve unit: No such method \u0026#39;GetUnit\u0026#39; #Failed to retrieve unit: No such method \u0026#39;GetUnit\u0026#39; #Failed to start pve-ha-lrm.service: Unknown unit: pve-ha-lrm.service #See system logs and \u0026#39;systemctl status pve-ha-lrm.service\u0026#39; for details. #dpkg: error processing package pve-cluster (--configure): # subprocess installed post-installation script returned error exit status 1 #dpkg: dependency problems prevent configuration of pve-firewall: # pve-firewall depends on pve-cluster; however: # Package pve-cluster is not configured yet. #dpkg: error processing package pve-firewall (--configure): # dependency problems - leaving unconfigured #dpkg: dependency problems prevent configuration of libpve-guest-common-perl: # libpve-guest-common-perl depends on pve-cluster; however: # Package pve-cluster is not configured yet. #dpkg: error processing package libpve-guest-common-perl (--configure): # dependency problems - leaving unconfigured #dpkg: dependency problems prevent configuration of qemu-server: # qemu-server depends on libpve-guest-common-perl; however: # Package libpve-guest-common-perl is not configured yet. # qemu-server depends on pve-cluster; however: # Package pve-cluster is not configured yet. # qemu-server depends on pve-firewall; however: # Package pve-firewall is not configured yet. #dpkg: error processing package qemu-server (--configure): # dependency problems - leaving unconfigured #dpkg: dependency problems prevent configuration of libpve-storage-perl: # libpve-storage-perl depends on pve-cluster; however: # Package pve-cluster is not configured yet. #dpkg: error processing package libpve-storage-perl (--configure): # dependency problems - leaving unconfigured #dpkg: dependency problems prevent configuration of pve-manager: # pve-manager depends on libpve-guest-common-perl (\u0026gt;= 2.0-14); however: # Package libpve-guest-common-perl is not configured yet. # pve-manager depends on libpve-storage-perl (\u0026gt;= 5.0-18); however: # Package libpve-storage-perl is not configured yet. # pve-manager depends on pve-cluster (\u0026gt;= 5.0-27); however: # Package pve-cluster is not configured yet. # pve-manager depends on pve-firewall; however: # Package pve-firewall is not configured yet. # pve-manager depends on qemu-server (\u0026gt;= 5.0-24); however: # Package qemu-server is not configured yet. #dpkg: error processing package pve-manager (--configure): # dependency problems - leaving unconfigured #dpkg: dependency problems prevent configuration of pve-container: # pve-container depends on libpve-guest-common-perl; however: # Package libpve-guest-common-perl is not configured yet. # pve-container depends on libpve-storage-perl (\u0026gt;= 5.0-18); however: # Package libpve-storage-perl is not configured yet. # pve-container depends on pve-cluster (\u0026gt;= 4.0-8); however: # Package pve-cluster is not configured yet. #dpkg: error processing package pve-container (--configure): # dependency problems - leaving unconfigured #dpkg: dependency problems prevent processing triggers for pve-ha-manager: # pve-ha-manager depends on pve-cluster (\u0026gt;= 3.0-17); however: # Package pve-cluster is not configured yet. # pve-ha-manager depends on qemu-server; however: # Package qemu-server is not configured yet. #dpkg: error processing package pve-ha-manager (--configure): # dependency problems - leaving triggers unprocessed #Errors were encountered while processing: # pve-cluster # pve-firewall # libpve-guest-common-perl # qemu-server # libpve-storage-perl # pve-manager # pve-container # pve-ha-manager #E: Sub-process /usr/bin/dpkg returned an error code (1) # #$ dpkg -C #The following packages have been unpacked but not yet configured. #They must be configured using dpkg --configure or the configure #menu option in dselect for them to work: # libpve-guest-common-perl Proxmox VE common guest-related modules # libpve-storage-perl Proxmox VE storage management library # pve-container Proxmox VE Container management tool # pve-firewall Proxmox VE Firewall # pve-manager Proxmox Virtual Environment Management Tools # qemu-server Qemu Server Tools #The following packages are only half configured, probably due to problems #configuring them the first time. The configuration should be retried using #dpkg --configure \u0026lt;package\u0026gt; or the configure menu option in dselect: # pve-cluster Cluster Infrastructure for Proxmox Virtual Environment #The following packages have been triggered, but the trigger processing #has not yet been done. Trigger processing can be requested using #dselect or dpkg --configure --pending (or dpkg --triggers-only): # pve-ha-manager Proxmox VE HA Manager Solution: 1 2 3 4 5 dpkg --configure pve-manager dpkg --configure -a #remove all of these software apt remove pve-cluster pve-ha-manager pve-container pve-manager libpve-storage-perl qemu-server libpve-guest-common-perl pve-firewall proxmox-ve Then reinstall proxmox-ve\nRemove proxmox-ve Error You are attempting to remove the meta-package 'proxmox-ve'! This is proxmox ve warning. We need follow the instruction to uninstall proxmox ve.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # **This is now command, this is prompt dialog** Do you want to continue? [Y/n] y W: (pve-apt-hook) !! WARNING !! W: (pve-apt-hook) You are attempting to remove the meta-package \u0026#39;proxmox-ve\u0026#39;! W: (pve-apt-hook) W: (pve-apt-hook) If you really you want to permanently remove \u0026#39;proxmox-ve\u0026#39; from your system, run the following command W: (pve-apt-hook) touch \u0026#39;/please-remove-proxmox-ve\u0026#39; W: (pve-apt-hook) and repeat your apt-get/apt invocation. W: (pve-apt-hook) W: (pve-apt-hook) If you are unsure why \u0026#39;proxmox-ve\u0026#39; would be removed, please verify W: (pve-apt-hook) - your APT repository settings W: (pve-apt-hook) - that you are using \u0026#39;apt-get dist-upgrade\u0026#39; or \u0026#39;apt full-upgrade\u0026#39; to upgrade your system E: Sub-process /usr/share/proxmox-ve/pve-apt-hook returned an error code (1) E: Failure running script /usr/share/proxmox-ve/pve-apt-hook Solution 1 touch \u0026#39;/please-remove-proxmox-ve\u0026#39; Error with update: /bin/sh: 1: /usr/share/proxmox-ve/pve-apt-hook: not found Error: 1 2 3 /bin/sh: 1: /usr/share/proxmox-ve/pve-apt-hook: not found E: Sub-process /usr/share/proxmox-ve/pve-apt-hook returned an error code (127) E: Failure running script /usr/share/proxmox-ve/pve-apt-hook Solution: 1 2 3 4 mkdir /usr/share/proxmox-ve touch /usr/share/proxmox-ve/pve-apt-hook chmod u+x /usr/share/proxmox-ve/pve-apt-hook apt install proxmox-ve Swell Upgrade error Installation completely broken Error with update: /bin/sh: 1: /usr/share/proxmox-ve/pve-apt-hook: not found ","date":"2019-05-15T12:11:14+08:00","permalink":"https://echowings.github.io/p/proxmox-ve-how-to-fixed-upgrade-error/","title":"Proxmox Ve How to Fixed Upgrade Error"},{"content":"Convert Disk to RAW 1 2 3 4 #qcow2 qemu-img convert -f qcow2 xxx.qcow2 -O raw xxxx.raw #vmware qemu-img convert -f vmdk xxx-flat.vmdk -O raw xxx.raw Import RAW to ceph 1 2 3 4 5 6 rbd list --pool ${ceph-pool-name} rbd import ./xxx.raw --pool ${ceph-pool-name} rbd rm ${old-file-rm} --pool ${ceph-pool-name] rbd mv xxx.raw ${old-file-rm) rbd list --poll ${ceph-pool-name} Reference 将qcow2格式的虚拟机文件导入到ceph池里 ","date":"2019-05-07T12:06:58+08:00","permalink":"https://echowings.github.io/p/how-to-import-disk-to-ceph/","title":"How to Import Disk to Ceph"},{"content":"Install Kubernetes on Centos 7 Disable and stop firewall 1 2 3 4 5 # Disable firewall service systemctl disable firewalld # Stop firewall service systemctl stop firewalld Install etcd and kubernetes Install etcd and kubernetes and it will also install docker.\n1 yum install -y etcd kubernetes Start service in order 1 2 3 4 5 6 7 systemctl start etcd systemctl start docker systemctl start kube-apiserver systemctl start kube-controller-manager systemctl start kube-scheduler systemctl start kubelet systemctl start start kube-proxy ","date":"2019-05-01T19:14:51+08:00","permalink":"https://echowings.github.io/p/install-kubernetes-on-centos7/","title":"Install Kubernetes on CentOS7"},{"content":"How to Install CentOS 7 on Proxmox VE Today I want to deploy kubernetes ,follow the book, it need to install centos 7. Okay! Deploy a centos 7 firstly.\nInstall Centos 7 Download latest image of centos 7 Download CentOS 7 images from mirrors.ustc.edu.cn\nDownload centos 7 images form here:CentOS-7-x86_64-Minimal-1810.iso Install Centos 7 Uploading this images to datatstore of pve Create a centos 7 vm on pve boot and install centos step by step. Setup Centos 7 Fixed perl error 1 2 3 4 5 6 7 8 9 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF Set timezone 1 2 timedatectl list-timezones timedatectl set-timezone Asia/Shanghai Change yum update repo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup echo \u0026#34; # CentOS-Base.repo # # The mirror system uses the connecting IP address of the client and the # update status of each mirror to pick mirrors that are updated to and # geographically close to the client. You should use this for CentOS updates # unless you are manually picking other mirrors. # # If the mirrorlist= does not work for you, as a fall back you can try the # remarked out baseurl= line instead. # # [base] name=CentOS-$releasever - Base #mirrorlist=http://mirrorlist.centos.org/?release=$releasever\u0026amp;arch=$basearch\u0026amp;repo=os baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/os/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 #released updates [updates] name=CentOS-$releasever - Updates # mirrorlist=http://mirrorlist.centos.org/?release=$releasever\u0026amp;arch=$basearch\u0026amp;repo=updates baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/updates/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 #additional packages that may be useful [extras] name=CentOS-$releasever - Extras # mirrorlist=http://mirrorlist.centos.org/?release=$releasever\u0026amp;arch=$basearch\u0026amp;repo=extras baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/extras/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 #additional packages that extend functionality of existing packages [centosplus] name=CentOS-$releasever - Plus # mirrorlist=http://mirrorlist.centos.org/?release=$releasever\u0026amp;arch=$basearch\u0026amp;repo=centosplus baseurl=https://mirrors.ustc.edu.cn/centos/$releasever/centosplus/$basearch/ gpgcheck=1 enabled=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 \u0026#34; \u0026gt; /etc/yum.repos.d/CentOS-Base.repo Install epel and change to mirrors.ustc.edu.cn 1 2 3 4 5 6 7 8 9 sudo yum install -y epel-release sudo sed -e \u0026#39;s!^mirrorlist=!#mirrorlist=!g\u0026#39; \\ -e \u0026#39;s!^#baseurl=!baseurl=!g\u0026#39; \\ -e \u0026#39;s!//download\\.fedoraproject\\.org/pub!//mirrors.ustc.edu.cn!g\u0026#39; \\ -e \u0026#39;s!http://mirrors\\.ustc!https://mirrors.ustc!g\u0026#39; \\ -i /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel-testing.repo yum makecache Install software 1 yum install git vim zsh qemu-guest-agent curl wget Setup vim Please follow this article to setup vim:\nHow to Setup Vim\nInstall oh-my-zsh robbyrussell/oh-my-zsh\nReference EPEL repo usergude How to Enable EPEL Repository for RHEL/CentOS 7.x/6.x/5.x CentOS 源使用帮助 ","date":"2019-05-01T17:57:17+08:00","permalink":"https://echowings.github.io/p/how-to-install-centos-7-on-proxmox-ve/","title":"How to Install Centos 7 on Proxmox VE"},{"content":"How to compile nginx with source code Download source code Access nginx.org to download latest stable version of nginx. 1 2 wget https://nginx.org/download/nginx-1.16.0.tar.gz tar -zxvf nginx-1.16.0.tar.gz Compile source code 1 2 3 4 5 cd nginx-1.16.0 apt update \u0026amp;\u0026amp; apt install -y gcc build-essential ./configure --prefix=/home/echowings/nginx make make install Trouble shooting PCRE missing error. 1 2 3 4 5 6 7 ./configure: error: the HTTP rewrite module requires the PCRE library. You can either disable the module by using —without–http_rewrite_module option, or install the PCRE library into the system, or build the PCRE library statically from the source with nginx by using —with–pcre=\u0026amp;lt;path\u0026amp;gt; option. We need to install pcre library to support it.\n1 2 3 4 5 # Install pcre for rhel or centos yum install pcre-devel # Install pcre for debian or ubuntu apt install -y libpcre3 libpcre3-dev gzip error. 1 2 3 4 ./configure: error: the HTTP gzip module requires the zlib library. You can either disable the module by using --without-http_gzip_module option, or install the zlib library into the system, or build the zlib library statically from the source with nginx by using --with-zlib=\u0026lt;path\u0026gt; option. We need to install gzip library.\n1 2 3 4 5 # For rhel or centos yum install zlib-devel # For debian or ubuntu apt install zlib1g zlib1g-dev Reference How to install pcre and pcre-devel on ubuntu using apt-get? ./configure: error: the HTTP gzip module requires the zlib library. Can\u0026rsquo;t add nginx module - requires zlib ","date":"2019-04-29T21:43:15+08:00","permalink":"https://echowings.github.io/p/how-to-compile-nginx-with-source-code/","title":"How to Compile Nginx With Source Code"},{"content":"Build Hyper-Converged Infrastructure with ceph on PVE\u0026quot; Ceph is really a king of SDS(Software Defin Storage). Opensource. After yeasr evolved, It is enterprise-ready. Today I will build a HCI with ceph on proxmox VE 5.x.\nIt will end nightmare that someone or montoring system tell you that your service was down, you need be a fire fighter to fixed as soon as possible under tremendous pressure form your boss. With proxmox ve , We can say \u0026rsquo;no more!\u0026quot;\nIf one server was down. and HA will handle this issue. HA will take all of virtual machines that hosted on the server which was down, and boot them other nodes automatically.\nPerequest Hardware We need got 3 host each of them have two disk(1 for install proxmox-ve 5.x, another for install ceph). Each host i prepared 2 disk . 128GB SSD for intall proxmox ve . another disk is a 1TB sata(It is really slowly, but for lab testing is enough).\nHost name Host IP Disk01 for install PVE Disk02 for ceph pve-test01 192.168.0.85 /dev/sda /dev/sdb pve-test02 192.168.0.86 /dev/sda /dev/sdb pve-test03 192.168.0.87 /dev/sda /dev/sdb Software Install proxmox ve or install proxmox ve 5.x on debian 9 Install proxmox VE 5.x, please follow user guide : Proxmoxve VE V5.x Installation. Install Proxmox VE 5.x on debian 9: How to install ProxmoxVE 5.x on Debian 9. Delete disk partition on 2rd disk. If the disk has data, we can use fdisk /dev/sdb to delete partition of sdb.\n1 2 3 4 5 fdisk /dev/sdb # Repeat enter m to delete partiton of sdb. m # Save configuration with w. w Create PVE Cluster Create pve cluster:Operating on proxmox ve node pve-test01 Login via ssh to pve-test01 the first proxmox ve node. Use a unique name for your cluster, the name cannot be changed later.\n1 pvecm create mycloud To check the state of cluster:\n1 pvecm status To join node to pve cluser:Operate on proxmox ve node. Run coomand like these on the rest of pve nodes.\n1 2 3 4 # 192.168.0.85 is the ip address of pve node `pve-test01` pvecm add 192.168.0.85 #Check pve cluster status on `pve-test02` pvecm status Setup NTP Servic for proxmox ve If you have a lan ntp server setup like this. mutilpy ntp server separated with blank space. 1 2 3 cat \u0026gt;\u0026gt; /etc/systemd/timesyncd.conf \u0026lt;\u0026lt; EOF NTP=192.168.0.2 192.168.0.3 EOF Or if you can sync ntp with aliyun ntp server in china. 1 2 3 4 5 cat \u0026gt;\u0026gt; /etc/systemd/timesyncd.conf \u0026lt;\u0026lt; EOF NTP=ntp1.aliyun.com ntp2.aliyun.com EOF # Restart systemd-timesyncd service to apply settings systemctl restart systemd-timesyncd Ceph Setup Install ceph on all of pve nodes. Run Each host with this command to install ceph on\n1 2 3 #Install ceph pveceph install Create ceph storage network on master node 1 2 # pve-node-01(10.32.0.85) pveceph init --network 192.168.0.0/24 Run all the command on each node 1 2 3 4 5 6 7 8 9 # Create mon moniting service pveceph createmon # Create OSD service pveceph createdosd /dev/sdb # Check ost status ceph osd stat ceph osd tree Create ceph cluster resource pool on master node 1 ceph osd pool creae pvepool1 128 128 copy storage ID and key to the right position 1 2 3 4 #Run the command on master node. cd /etc/pve/priv/ mkdir ceph cp /etc/ceph/ceph.client.admin.keyring ceph/my-ceph-storage.keyring Check ceph cluster status 1 ceph -s Create OSD on proxmox ve portal your can access portal on each node https://192.168.0.85:8006 https://192.168.0.86:8006 https://192.168.0.87:8006 Create OSD. \u0026ldquo;Datacenter\u0026rdquo; | \u0026ldquo;Storage\u0026rdquo; | \u0026ldquo;Add\u0026rdquo; | \u0026ldquo;RBD\u0026rdquo; Setup HA Create vm or lxc on one node Create a VM or LXC on one node and run it.\nSetup the vm or lxc in HA mode \u0026ldquo;Datacenter\u0026rdquo; | \u0026ldquo;HA\u0026rdquo; | \u0026ldquo;Resources\u0026rdquo; | \u0026ldquo;Add\u0026rdquo;. Add: Resource:Container/Virtual Machine Name value VM: ${VM-you-created} Max Restart: 1 Max Relocate: 1 Group request State: started Reference High Availability Cluster Proxmox VE 2.0 Cluster PROXMOX+CEPH TO BUILD HCI ","date":"2019-04-29T10:56:16+08:00","permalink":"https://echowings.github.io/p/build-hyper-converged-infrastructure-with-ceph-on-pve/","title":"Build Hyper-Converged Infrastructure With Ceph on PVE"},{"content":"How to install snmp service on proxmox ve How to setup snmp service to let us to use librenms to moniting our proxmox ve healthy status is very important for us.\nInstall snmpd on proxmox ve 1 2 apt update apt install -y snmpd Configure snmpd.conf backup original configuration file. 1 2 mv /etc/snmp/snmpd.conf /etc/snmp/snmpd.conf.backup Create a new config file. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 cat \u0026gt; /etc/snmp/snmpd.conf \u0026lt;\u0026lt; EOF # this create a SNMPv1/SNMPv2c community named \u0026#34;\u0026#34; # and restricts access to LAN adresses 192.168.0.0/22 (last two 0\u0026#39;s are ranges) rocommunity OkayWorld 192.168.0.0/22 # setup info syslocation \u0026#34;rack 1, room 3, serverrroom\u0026#34; syscontact \u0026#34;xxx@xxx.xxx\u0026#34; # open up agentAddress udp:161 # run as agentuser root # dont log connection from UDP: dontLogTCPWrappersConnects yes # fix for disks larger then 2TB realStorageUnits 0 EOF Firewall allow lan can access 1 iptables -A INPUT -s 192.168.0.0/22 -p udp --dport 161 -j ACCEPT Restart snmpd service to apply settings 1 2 systemctl restart snmpd Testing 1 snmpwalk -c OkayWorld -v1 $servername$ SNMPv2-MIB::sysDescr.0 QA ###1. error on subcontainer \u0026lsquo;ia_addr\u0026rsquo; insert (-1) After systemd migration starting from Debian 9 Stretch, you need to change /lib/systemd/system/snmpd.service file, not /etc/default/snmpd file:\n1 2 3 sed -i \u0026#34;s|-Lsd|-LS6d|\u0026#34; /lib/systemd/system/snmpd.service systemctl daemon-reload systemctl restart snmpd Reference how to install SNMP service on Proxmox How can I disable snmpd ia_addr insert messages? [Solved] snmpd gives “error on subcontainer” ‘ia_addr’ insert (-1) warnings ","date":"2019-04-27T20:29:36+08:00","permalink":"https://echowings.github.io/p/how-to-install-snmp-service-on-promxox-ve/","title":"How to Install Snmp Service on Promxox VE"},{"content":"Option 1 :Intel Pentium G4560/8G RAM/ 1TB nvme ssd No. type details quantity UnitPrice Total Price 01 机箱 立人E-T4超薄迷你Thin-ITX立式台式机HTPC电脑空机箱支持VESA背挂 1 ¥90(90.00*1.04) 93.00 02 CPU 英特尔（Intel）奔腾双核G4560 盒装CPU处理器\t1 ￥599.00 599.00 03 视频转换接头 山泽(SAMZHE)HDMI转VGA转换器带音频供电接口 高清视频转接头 电脑华为小米盒子接电视投影仪1080p 黑 ZH-22 1 ￥35.90 35.90 04 键鼠套装 罗技（Logitech）MK275 无线光电键鼠套装 无线鼠标无线键盘套装 1 99.00 99 05 主板 ASUS/华硕PRIME H310T2 R2.0 THIN ITX小主板 迷你主机一体机HTPC 1 ¥ 699 755 06 电源适配器 酷鱼19V-7.1A足135W电源适配器/技嘉华硕微星ITX主板通用7.4X5.0 1 ¥129.00 139.32(129 * 1.08) 07 内存 三星内存条8g DDR4 2666 8G 16G笔记本内存条四代吃鸡内存原厂兼容戴尔华硕联想苹果笔记本内存条 1 ¥ 319.00 ¥319.00 08 WiFi套件 INTELAC7265 M.2 NGFF1000M/5G/2.4G/4.0网卡华硕H110T技嘉H110TN 1 ￥135.00 ￥145.80(135*1.08) 09 cpu散热器 ID-COOLING IS-20i 26 Intel平台CPU散热器8CM HTP超薄温控风扇 1 ¥ 38.00 ¥ 38.00 10 SSD 三星（SAMSUNG）1TB SSD固态硬盘 M.2接口(NVMe协议) 970 EVO Plus（MZ-V7S1T0B） 1 ￥1899.00 ￥1899.00 Sum ￥4123.02 Optiion 2 :Intel i5 8400 6 core/8G RAM/ 1TB nvme ssd No. type details quantity UnitPrice Total Price 01 机箱 立人E-T4超薄迷你Thin-ITX立式台式机HTPC电脑空机箱支持VESA背挂 1 ¥90(90.00*1.04) 93.00 02 CPU 英特尔（Intel） i5 8400 酷睿六核 盒装CPU处理器\t1 ￥1549.00 1549.00 03 视频转换接头 山泽(SAMZHE)HDMI转VGA转换器带音频供电接口 高清视频转接头 电脑华为小米盒子接电视投影仪1080p 黑 ZH-22 1 ￥35.90 35.90 04 键鼠套装 罗技（Logitech）MK275 无线光电键鼠套装 无线鼠标无线键盘套装 1 99.00 99 05 主板 ASUS/华硕PRIME H310T2 R2.0 THIN ITX小主板 迷你主机一体机HTPC 1 ¥ 699 755 06 电源适配器 酷鱼19V-7.1A足135W电源适配器/技嘉华硕微星ITX主板通用7.4X5.0 1 ¥129.00 139.32(129 * 1.08) 07 内存 三星内存条8g DDR4 2666 8G 16G笔记本内存条四代吃鸡内存原厂兼容戴尔华硕联想苹果笔记本内存条 1 ¥ 319.00 ¥319.00 08 WiFi套件 INTELAC7265 M.2 NGFF1000M/5G/2.4G/4.0网卡华硕H110T技嘉H110TN 1 135.00 ￥145.80(135*1.08) 09 cpu散热器 超薄21mm 1150/1151/ CPU散热器 CPU风扇 适用于立人T3机箱 1 ¥ 89.00 93.45（89*1.05） 10 SSD 三星（SAMSUNG）1TB SSD固态硬盘 M.2接口(NVMe协议) 970 EVO Plus（MZ-V7S1T0B） 1 ￥1899.00 ￥1899.00 Sum ￥5128.47 ","date":"2019-04-27T12:25:36+08:00","permalink":"https://echowings.github.io/p/diy-thin-itx-pc/","title":"DIY Thin Itx PC"},{"content":"How to change Network settings of proxmox-ve host without rebooting. Eache time when I want to change network settings like change netowrks and I must reboot to apply it. It is really trouble me.\nSolution Proxmox VE is based on debian. After check interface of network with the path /etc/network/\nI found that each time when i change network settings. There will be a named interfaces.new created and it content new network settings wait for apply when i reboot. So I try to backup the old networking interfaces settings and replace it with the new file.\nManual change Backup interfaces 1 cp /etc/network/interfaces /etc/network/interfaces.old Copy interface.new to interface 1 cp /etc/network/interfaces.new /etc/network/interfaces Reboot networking service 1 2 systemctl restart networking Scirpt change 1 mv interfaces interfaces.backup \u0026amp;\u0026amp; mv interfaces.new interfaces \u0026amp;\u0026amp; systemctl restart networking.service ","date":"2019-04-27T11:36:16+08:00","permalink":"https://echowings.github.io/p/proxmox-ve-how-to-chang-network-of-hosting-without-reboot-proxmox-ve/","title":"Proxmox Ve How to Chang Network of Hosting Without Reboot Proxmox Ve"},{"content":"How to convert vmware esix VM to proxmox-VE VM V2V Convert vmware virtual machines to kvm virtual machine is easy.\nConvert windows VM Remove VWware tools Uninstall vmware tools and reboot vm.\nSwitch disk mode to IDE\nDownload Mergeide, unzip it and run it,then reboot your vm. or you can save follow code as mergeide.reg.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\primary_ide_channel] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;atapi\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\secondary_ide_channel] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;atapi\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\*pnp0600] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;atapi\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\*azt0502] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;atapi\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\gendisk] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E967-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;disk\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#cc_0101] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_0e11\u0026amp;dev_ae33] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1039\u0026amp;dev_0601] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1039\u0026amp;dev_5513] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1042\u0026amp;dev_1000] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_105a\u0026amp;dev_4d33] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1095\u0026amp;dev_0640] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1095\u0026amp;dev_0646] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1095\u0026amp;dev_0646\u0026amp;REV_05] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1095\u0026amp;dev_0646\u0026amp;REV_07] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1095\u0026amp;dev_0648] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1095\u0026amp;dev_0649] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1097\u0026amp;dev_0038] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_10ad\u0026amp;dev_0001] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_10ad\u0026amp;dev_0150] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_10b9\u0026amp;dev_5215] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_10b9\u0026amp;dev_5219] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_10b9\u0026amp;dev_5229] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_1106\u0026amp;dev_0571] \u0026#34;Service\u0026#34;=\u0026#34;pciide\u0026#34; \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_1222] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_1230] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_2411] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_2421] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_7010] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_7111] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\CriticalDeviceDatabase\\pci#ven_8086\u0026amp;dev_7199] \u0026#34;ClassGUID\u0026#34;=\u0026#34;{4D36E96A-E325-11CE-BFC1-08002BE10318}\u0026#34; \u0026#34;Service\u0026#34;=\u0026#34;intelide\u0026#34; ;Add driver for Atapi (requires Atapi.sys in Drivers directory) [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\atapi] \u0026#34;ErrorControl\u0026#34;=dword:00000001 \u0026#34;Group\u0026#34;=\u0026#34;SCSI miniport\u0026#34; \u0026#34;Start\u0026#34;=dword:00000000 \u0026#34;Tag\u0026#34;=dword:00000019 \u0026#34;Type\u0026#34;=dword:00000001 \u0026#34;DisplayName\u0026#34;=\u0026#34;Standard IDE/ESDI Hard Disk Controller\u0026#34; \u0026#34;ImagePath\u0026#34;=hex(2):53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,44,00,\\ 52,00,49,00,56,00,45,00,52,00,53,00,5c,00,61,00,74,00,61,00,70,00,69,00,2e,\\ 00,73,00,79,00,73,00,00,00 ;Add driver for intelide (requires intelide.sys in drivers directory) [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\IntelIde] \u0026#34;ErrorControl\u0026#34;=dword:00000001 \u0026#34;Group\u0026#34;=\u0026#34;System Bus Extender\u0026#34; \u0026#34;Start\u0026#34;=dword:00000000 \u0026#34;Tag\u0026#34;=dword:00000004 \u0026#34;Type\u0026#34;=dword:00000001 \u0026#34;ImagePath\u0026#34;=hex(2):53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,44,00,\\ 52,00,49,00,56,00,45,00,52,00,53,00,5c,00,69,00,6e,00,74,00,65,00,6c,00,69,\\ 00,64,00,65,00,2e,00,73,00,79,00,73,00,00,00 ;Add driver for Pciide (requires Pciide.sys and Pciidex.sys in Drivers directory) [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\PCIIde] \u0026#34;ErrorControl\u0026#34;=dword:00000001 \u0026#34;Group\u0026#34;=\u0026#34;System Bus Extender\u0026#34; \u0026#34;Start\u0026#34;=dword:00000000 \u0026#34;Tag\u0026#34;=dword:00000003 \u0026#34;Type\u0026#34;=dword:00000001 \u0026#34;ImagePath\u0026#34;=hex(2):53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,44,00,\\ 52,00,49,00,56,00,45,00,52,00,53,00,5c,00,70,00,63,00,69,00,69,00,64,00,65,\\ 00,2e,00,73,00,79,00,73,00,00,00 Copy *-flat.vmdk file to proxmxo ve host. Shutdown your vm.\n1 2 scp root@xx.xx.xx.xx:/vmfs/volumes/datastore/source-vm/source-vm-flat.vmdk /var/lib/vz/images/soure-vm-flate.vmdk Convert vmdk file to qcow2 1 2 3 qemu-img convert -f raw source-vm-flate.vmdk -O qcow2 source-vm-flate.qcow2 Create a vm which os type is same as original vm and replace the disk with source-vm-flate.qcow2\nDownload virtio-win.iso and upload iso image to proxmox ve host storage.\nMount iso in cdrom device in vm settings.\nAdd and virtoIO Block disk and install driver from cdrom. Then reboot the vm.\nChange Bus/Device in Hard Disk to VirtIO Block.\nchange netork device model type to VirtIO(paravirtualized).\ndelete the added the last disk.\nConvert Linux or freebsd VM Copy *-flat.vmdk file to proxmxo ve host. Shutdown your vm.\n1 2 scp root@xx.xx.xx.xx:/vmfs/volumes/datastore/source-vm/source-vm-flat.vmdk /var/lib/vz/images/soure-vm-flate.vmdk Convert vmdk file to qcow2 1 2 3 qemu-img convert -f raw source-vm-flate.vmdk -O qcow2 source-vm-flate.qcow2 Create a vm which os type is same as original vm and replace the disk with source-vm-flate.qcow2 Change Bus/Device in Hard Disk to VirtIO Block. change netork device model type to VirtIO(paravirtualized). Reference Migration of servers to Proxmox VE Windows VirtIO Drivers ","date":"2019-04-26T22:12:14+08:00","permalink":"https://echowings.github.io/p/proxmox-ve-how-to-convert-vmware-esxi-vm-to-proxmox-ve-vm/","title":"Proxmox VE - How to Convert Vmware Esxi VM to proxmox-VE VM"},{"content":"How to conifugre wireguard in vyos WireGuard is an extremely simple yet fast and modern VPN that utilizes state-of-the-art cryptography.\nWireguard Today I will try to deploy wireguard with two vyos .\nSite-to-Sit mode 1 2 3 4 5 6 7 Toplogy |--------------------------------| |---------------------------------| | Server | | Client | | |-----cloud ----| wan:${wan-address} | | wireguard tunnel interface:wg01| | Wireguard tunnel interface:wg01 | |--------------------------------| |---------------------------------| Server configuration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 # Generates a new keypair, if one exists already is asks you if you want to overwrite the existing one. generate wireguard keypair #Show the private key show wireguard privkey #Show the public key show wireguard pubkey #Enter configuration mode configure #set virtual network interfaces for wireguard set interfaces wireguard wg01 address \u0026#39;172.16.100.1/24\u0026#39; #Set Wireguard listen port set interfaces wireguard wg01 port \u0026#39;50100\u0026#39; #Add CLIENT1 #Set wireguard allow client ip ranges to access. set interfaces wireguard wg01 peer CLIENT1 allowed-ips \u0026#39;172.16.100.2/32\u0026#39; #Set how offten to send keep alives in seconds set interfaces wireguard wg01 peer CLIENT1 persistent-keepalive \u0026#39;15\u0026#39; #Set presharekey set interfaces wireguard wg01 peer CLIENT1 preshared-key gLdIlCM/AsobjfDgFK/cdgsAcjILTzLY4df5BskRcqY= #Set client public key set interfaces wireguard wg01 peer CLIENT1 pubkey \u0026#39;${client-pubkey}\u0026#39; #set static routing. set protocols static interface-route \u0026#39;172.16.100.0/24\u0026#39; next-hop-interface wg01 #make configuration applied commit #Save configuration save Client configuration 1. vyos wireguard client 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 # Generates a new keypair, if one exists already is asks you if you want to overwrite the existing one. generate wireguard keypair #Show the private key show wireguard privkey #Show the public key show wireguard pubkey #Set wireguard virtual network interfaces set interfaces wireguard wg01 address \u0026#39;172.16.100.2/32\u0026#39; #set wireguard accept packets of network. set interfaces wireguard wg01 peer SERVER allow-ips \u0026#39;0.0.0.0/0\u0026#39; #Set connection to server set interfaces wireguard wg01 peer SERVER endpoint \u0026#39;${server-wan-address}:50100\u0026#39; #Set how offten to send keep alives in seconds set interfaces wireguard wg01 peer SERVEr persistent-keepalive 15 #Set public key for server set interfaces wireguard wg01 peer SERVER pubkey \u0026#39;${server-pubkey}\u0026#39; #Set presharekey set interfaces wireguard wg01 peer SERVER preshared-key gLdIlCM/AsobjfDgFK/cdgsAcjILTzLY4df5BskRcqY= #set static routing to client. set protocols static interface-route \u0026#39;172.16.100.0/24\u0026#39; next-hop-interface wg01 #Make the settings applied! commit #save configuration save #Test wireguard connection 2. macos wireguard client Download wireguard client for macos: Download from AppStore set configure like this 1 2 3 4 5 6 7 8 9 10 11 [Interface] PrivateKey = AJ2oJcAbxCmeovofOMrJooMMlLMNNKGWuTqffF7oXVU= Address = 172.16.100.3/32 DNS = 1.1.1.1 [Peer] PublicKey = m6oJcAbxCmeovofOMrPCCCDkGWuTqfkGWufeovofEII= PresharedKey = k82ffjxKzt3vy4JR5lUMRUj1eH6PGRkLgqk)knYIHaM= AllowedIPs = 0.0.0.0/0 Endpoint = $WIREGUARD_SERVER_ADDRESS:$PORT PersistentKeepalive = 15 3. andorid/ios Edit a configuration and save it as a config file. install qeencode 1 2 3 brew install qrencode qrencode qrencode -t ansiutf8 \u0026lt; client_wireguard_ios.conf with wireguard client scan qr to confirm it. Reference Wireguard ","date":"2019-04-17T12:31:08+08:00","permalink":"https://echowings.github.io/p/vyos-how-to-setup-wireguard/","title":"Vyos How to Setup Wireguard"},{"content":"How to deploy librenms monitoring system with docker container Librenms is a very light and easy handle moniting software. It is suitable for us to monitoring server,networdevice, printer etc via snmp.\nAt now, docker is easy for software deployment. After deploy librenms in ubuntu vm, I have a try to deploy librenms with docker-compose.\nInstall librenms with docker-compose 1 2 3 4 5 6 7 mkdir -p librenms-docker-compose cd ./librenms-docker-compose wget https://raw.githubusercontent.com/librenms/docker/master/examples/compose/.env wget https://raw.githubusercontent.com/librenms/docker/master/examples/compose/docker-compose.yml wget https://raw.githubusercontent.com/librenms/docker/master/examples/compose/librenms.env touch acme.json chmod 600 acme.json Change docker-compose.yml vi docker-compose.yml\nchange services | traefik | command section. 1 - \u0026#34;--docker.domain=mydomain.net\u0026#34; Change services | KEY VALUE hostname mylibrenms domainname mydomain.net Chang syslog-ng section KEY VALUE hostname mylibrenms domainname mydomain.net 1 2 docker-compose up -d docker-compose logs -f ","date":"2019-04-16T16:56:08+08:00","permalink":"https://echowings.github.io/p/librenms-deploy-librenms-with-docker-container/","title":"Librenms Deploy Librenms With Docker Container"},{"content":"How to fix perl LC_ALL ERROR 1 2 3 4 5 6 7 8 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF ","date":"2019-04-16T14:36:34+08:00","permalink":"https://echowings.github.io/p/how-to-fix-linux-perl-lc_all_error/","title":"How to Fix Linux Perl LC_ALL_ERROR"},{"content":"How to ugrade Proxmove VE If your proxmox ve server in china ,Change utsc mirrors will speed up your proxmoxve upgrade speed.\nHere are the steps.\n1. Change debian,pve,ceph upgrade source, and upgrade your PVE 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #chang debian source list echo \u0026#34;deb https://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free\u0026#34; \u0026gt; /etc/apt/sources.list #change pve 5.x update source list to no subscription echo \u0026#34;deb http://mirrors.ustc.edu.cn/proxmox/debian/pve/ stretch pve-no-subscription\u0026#34; \u0026gt; /etc/apt/sources.list.d/pve-no-sub.list # Disable pve 5.x enterprise subscription sed -i.bak \u0026#39;s|deb https://enterprise.proxmox.com/debian stretch pve-enterprise|\\# deb https://enterprise.proxmox.com/debian stretch pve-enterprise|\u0026#39; /etc/apt/sources.list.d/pve-enterprise.list #change ceph source list echo \u0026#34;deb http://mirrors.ustc.edu.cn/proxmox/debian/ceph-luminous stretch main\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list.d/ceph.list # add key wget http://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-5.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-5.x.gpg apt updat \u0026amp;\u0026amp; apt -y dis-ugprade update-grub 2. Change settings after upgrade This step to change pve upgrade to no subscription and ceph soucre .\n1 2 3 4 5 6 7 8 9 #change pve 5.x update source list echo \u0026#34;deb http://mirrors.ustc.edu.cn/proxmox/debian/pve/ stretch pve-no-subscription\u0026#34; \u0026gt; /etc/apt/sources.list.d/pve-enterprise.list #change ceph source list echo \u0026#34;deb http://mirrors.ustc.edu.cn/proxmox/debian/ceph-luminous stretch main\u0026#34; \u0026gt; /etc/apt/sources.list.d/ceph.list # add key wget http://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-5.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-5.x.gpg ","date":"2019-04-16T12:12:58+08:00","permalink":"https://echowings.github.io/p/proxmov-ve-how-to-upgrade-pve/","title":"Proxmov Ve How to Upgrade Pve"},{"content":"How to build a kms server Option 1: docker mode 1 2 3 4 5 docker pull luodaoyi/kms-server docker run -itd -p 1688:1688 --name kms luodaoyi/kms-server docker update --restart=always $dockername Option 2: docker compose docker-compose.yml\n1 2 3 4 5 6 7 8 9 10 version: \u0026#39;3\u0026#39; services: frontend: image: luodaoyi/kms-server container_name: mykms ports: - 1688:1688 restart: always docker-compose start the container\n1 docker-compose up -d Active Script 1 2 3 4 5 6 7 8 echo \u0026#34;To active office\u0026#34; cd \u0026#34;%programfiles%\\Microsoft Office\\Office16\u0026#34; cscript ospp.vbs /sethst:xx.xx.xx.xx cscript ospp.vbs /act echo \u0026#34;to active windows\u0026#34; slmgr /skms xxx.xxx.xxx.xxx slmgr /ato Reference blog ","date":"2019-04-11T00:17:37+08:00","permalink":"https://echowings.github.io/p/how-to-build-a-kms-server/","title":"How to Build a Kms Server"},{"content":"How to setup Oh-My-Zsh Install support application 1 apt install git curl wget zsh Install zsh via curl 1 sh -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\u0026#34; via wget 1 sh -c \u0026#34;$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)\u0026#34; Change zsh settings change theme 1 2 #change theme froy robbyrussell to agnoster sed -i \u0026#39;s/ZSH_THEME=\\\u0026#34;robbyrussell\\\u0026#34;/ZSH_THEME=\\\u0026#34;agnoster\\\u0026#34;/g\u0026#39; ~/.zshrc change plugin support 1 sed -i \u0026#39;s/plugins=(git)/plugin=(\\n\\tgit\\n\\tboundler\\n\\tdotenv\\n\\trake\\n\\trbenv\\n\\truby\\n\\tpython\\n)/g\u0026#39; ~/.zshrc Switch default bash to zsh 1 chsh -s /bin/zsh ","date":"2019-04-10T12:18:04+08:00","permalink":"https://echowings.github.io/p/how-to-setup-oh-my-zsh/","title":"How to Setup Oh My Zsh"},{"content":"How to setup vim Install vundle vundle is a plugin manage tools for vim\n1 2 git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim Edit vim configure file 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 cat \u0026gt; ~/.vimrc \u0026lt;\u0026lt;EOF set nocompatible \u0026#34; be iMproved, required filetype off \u0026#34; required syntax on \u0026#34; set the runtime path to include Vundle and initialize set rtp+=~/.vim/bundle/Vundle.vim call vundle#begin() \u0026#34; alternatively, pass a path where Vundle should install plugins \u0026#34;call vundle#begin(\u0026#39;~/some/path/here\u0026#39;) \u0026#34; let Vundle manage Vundle, required Plugin \u0026#39;VundleVim/Vundle.vim\u0026#39; \u0026#34; The following are examples of different formats supported. \u0026#34; Keep Plugin commands between vundle#begin/end. \u0026#34; plugin on GitHub repo Plugin \u0026#39;tpope/vim-fugitive\u0026#39; \u0026#34; plugin from http://vim-scripts.org/vim/scripts.html \u0026#34; Plugin \u0026#39;L9\u0026#39; \u0026#34; Git plugin not hosted on GitHub Plugin \u0026#39;git://git.wincent.com/command-t.git\u0026#39; \u0026#34; git repos on your local machine (i.e. when working on your own plugin) \u0026#34; Plugin \u0026#39;file:///home/gmarik/path/to/plugin\u0026#39; \u0026#34; The sparkup vim script is in a subdirectory of this repo called vim. \u0026#34; Pass the path to set the runtimepath properly. Plugin \u0026#39;rstacruz/sparkup\u0026#39;, {\u0026#39;rtp\u0026#39;: \u0026#39;vim/\u0026#39;} \u0026#34; Install L9 and avoid a Naming conflict if you\u0026#39;ve already installed a \u0026#34; different version somewhere else. Plugin \u0026#39;ascenator/L9\u0026#39;, {\u0026#39;name\u0026#39;: \u0026#39;newL9\u0026#39;} Plugin \u0026#39;morhetz/gruvbox\u0026#39; Plugin \u0026#39;vim-airline/vim-airline\u0026#39; Plugin \u0026#39;vim-airline/vim-airline-themes\u0026#39; \u0026#34; All of your Plugins must be added before the following line call vundle#end() \u0026#34; required filetype plugin indent on \u0026#34; required \u0026#34; To ignore plugin indent changes, instead use: \u0026#34;filetype plugin on \u0026#34; \u0026#34; Brief help \u0026#34; :PluginList - lists configured plugins \u0026#34; :PluginInstall - installs plugins; append `!` to update or just :PluginUpdate \u0026#34; :PluginSearch foo - searches for foo; append `!` to refresh local cache \u0026#34; :PluginClean - confirms removal of unused plugins; append `!` to auto-approve removal \u0026#34; \u0026#34; see :h vundle for more details or wiki for FAQ \u0026#34; Put your non-Plugin stuff after this line EOF Install Plugin 1 vim Enter :PluginInstall then wait for the installation process finished. then run the commands:\n1 2 3 4 5 6 cat \u0026gt;\u0026gt; ~/.vimrc \u0026lt;\u0026lt;EOF colorscheme gruvbox set background=dark \u0026#34; Setting dark mode let g:gruvbox_contrast_dark=\u0026#39;hard\u0026#39; let g:airline_theme=\u0026#39;simple\u0026#39; EOF Let vim support nginx syntax highlight 1 2 3 4 mkdir -p ~/.vim/syntax/ wget -O ~/.vim/syntax/nginx.vim http://www.vim.org/scripts/download_script.php?src_id=14376 # /usr/local/etc/nginx/vhosts/* change it as you wish echo \u0026#34;au BufRead,BufNewFile /usr/local/etc/nginx/vhosts/* set ft=nginx\u0026#34; \u0026gt;\u0026gt; ~/.vim/filetype.vim Let vim remember last opened position 1 2 3 4 5 6 7 8 cat \u0026gt;\u0026gt; ~/.vimrc \u0026lt;\u0026lt; EOF \u0026#34; Uncomment the following to have Vim jump to the last position when \u0026#34; reopening a file if has(\u0026#34;autocmd\u0026#34;) au BufReadPost * if line(\u0026#34;\u0026#39;\\\u0026#34;\u0026#34;) \u0026gt; 0 \u0026amp;\u0026amp; line(\u0026#34;\u0026#39;\\\u0026#34;\u0026#34;) \u0026lt;= line(\u0026#34;$\u0026#34;) \\| exe \u0026#34;normal! g\u0026#39;\\\u0026#34;\u0026#34; | endif endif EOF Change tab to 4 space 1 2 3 4 5 6 cat \u0026gt;\u0026gt; ~/.vimrc \u0026lt;\u0026lt;EOF set tabstop=4 set shiftwidth=4 set softtabstop=4 set expandtab EOF Reference 让Vim支持Nginx语法高亮 -Ubuntu In vim, how do I get a file to open at the same line number I closed it at last time? How do I change tab size in Vim? ","date":"2019-04-09T10:02:33+08:00","permalink":"https://echowings.github.io/p/how-to-setup-vim/","title":"How to Setup Vim"},{"content":"How to install docker-ce in lxc container in pve At now, Proxmox is base debian and it can be install docker directly. To install docker in host without proxmox support. It will be lost HA function.\nDeploy a vm then install docker-ce in the vm, it works. but take a lot resource than directly install docker in proxmox.\nIs there a way to take less performance ,at the same time we cant easly mange it with proxmox ?The answer is run docker in lxc.\nDownload lxc images First thing first, Download Ubuntu 18.04.1 LXC images:\nOption 1: Download LXC images from GUI Login your PVE; Follow the path to click the gui to redirect to the right lxc download page. \u0026quot;Datacenter\u0026quot; | \u0026quot;$PVE_HOST\u0026quot; | \u0026quot;Local(PVE Storage)\u0026quot; | \u0026quot;Content\u0026quot; | \u0026quot;Templates\u0026quot; select \u0026ldquo;ubuntu-18.04-standard\u0026rdquo;, then click download. wating for it finishd download the lxc image. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 Virtual Environment 5.3-9 Search Storage \u0026#39;local\u0026#39; on node \u0026#39;xa-sys-pve02\u0026#39; Search: Server View Logs () starting template download from: http://download.proxmox.com/images/system/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz target file: /var/lib/vz/template/cache/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz --2019-04-08 13:44:03-- http://download.proxmox.com/images/system/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz Resolving download.proxmox.com (download.proxmox.com)... 94.136.30.185, 2a01:7e0:0:424::249 Connecting to download.proxmox.com (download.proxmox.com)|94.136.30.185|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 213430501 (204M) [application/octet-stream] Saving to: \u0026#39;/var/lib/vz/template/cache/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz.tmp.31383\u0026#39; 0K ........ ........ ........ ........ ........ ........ 1% 99.8K 34m17s 3072K ........ ........ ........ ........ ........ ........ 2% 220K 24m34s 6144K ........ ........ ........ ........ ........ ........ 4% 214K 21m18s ... 193536K ........ ........ ........ ........ ........ ........ 94% 180K 53s 196608K ........ ........ ........ ........ ........ ........ 95% 410K 39s 199680K ........ ........ ........ ........ ........ ........ 97% 206K 25s 202752K ........ ........ ........ ........ ........ ........ 98% 311K 11s 205824K ........ ........ ........ ........ ........ 100% 338K=15m15s 2019-04-08 13:59:21 (228 KB/s) - \u0026#39;/var/lib/vz/template/cache/ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz.tmp.31383\u0026#39; saved [213430501/213430501] download finished TASK OK Option 2: Download LXC with shell ####Fix Perl LC_ALL ERROR\n1 2 3 4 5 6 7 8 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF ####list linux container\n1 pveam available --section system 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 system alpine-3.7-default_20180913_amd64.tar.xz system alpine-3.8-default_20180913_amd64.tar.xz system alpine-3.9-default_20190224_amd64.tar.xz system archlinux-base_20190124-1_amd64.tar.gz system centos-6-default_20161207_amd64.tar.xz system centos-7-default_20171212_amd64.tar.xz system debian-8.0-standard_8.11-1_amd64.tar.gz system debian-9.0-standard_9.7-1_amd64.tar.gz system fedora-28-default_20180907_amd64.tar.xz system fedora-29-default_20181126_amd64.tar.xz system gentoo-current-default_20180906_amd64.tar.xz system opensuse-15.0-default_20180907_amd64.tar.xz system opensuse-42.3-default_20171214_amd64.tar.xz system ubuntu-14.04-standard_14.04.5-1_amd64.tar.gz system ubuntu-16.04-standard_16.04.5-1_amd64.tar.gz system ubuntu-18.04-standard_18.04.1-1_amd64.tar.gz system ubuntu-18.10-standard_18.10-2_amd64.tar.gz ####Download images\n1 pveam download local debian-9.0-standard_9.7-1_amd64.tar.gz List local images 1 pveam list local Delete local image 1 pveam remove local:vztmpl/debian-8.0-standard_8.0-1_amd64.tar.gz Option 3: create a lxc from image \u0026ldquo;Datacenter\u0026rdquo; | select \u0026ldquo;$PVENODE\u0026rdquo; then right click it. | \u0026ldquo;Create CT\u0026rdquo;. Setup the LXC. General: \u0026ldquo;Unprivileged container\u0026rdquo; checked. When create the LXC container,selecited the contiainer and doubule click \u0026ldquo;Options\u0026rdquo; | \u0026ldquo;Features\u0026rdquo;.then make keyctl/Nesting/Fuse option check on. \u0026ldquo;Options\u0026rdquo; | \u0026ldquo;protecton\u0026rdquo; check on. Option4: Install docker in LXC Boot the lxc container of ubuntu 18.04. Change ubuntu 18.04 apt source to mirrors.utsc.edu.cn 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 cat \u0026gt; /etc/apt/sources.list \u0026lt;\u0026lt;EOF deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse ## Not recommended # deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse # deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse EOF apt update \u0026amp;\u0026amp; apt -y upgrade apt install -y vim net-tools apt remove -y vim-tiny Follow docker offical document to install docker-ce. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 apt-get install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg-agent \\ software-properties-common \\ -y curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - apt-key fingerprint 0EBFCD88 sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable\u0026#34; sed -i \u0026#39;s/download.docker.com/mirrors.ustc.edu.cn\\/docker-ce/g\u0026#39; /etc/apt/sources.list apt-get update apt-get install -y docker-ce docker-ce-cli containerd.io check docker 1 2 3 root@template-docker-in-lxc:/etc/apt# docker -v Docker version 18.09.4, build d14af54266 docker run hello-world run hello-world 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 root@template-docker-in-lxc:/etc/apt# docker run hello-world Unable to find image \u0026#39;hello-world:latest\u0026#39; locally latest: Pulling from library/hello-world 1b930d010525: Pull complete Digest: sha256:2557e3c07ed1e38f26e389462d03ed943586f744621577a99efb77324b0fe535 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the \u0026#34;hello-world\u0026#34; image from the Docker Hub. (amd64) 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://hub.docker.com/ For more examples and ideas, visit: https://docs.docker.com/get-started/ Install docker-compose 1 2 3 4 5 6 sudo curl -L \u0026#34;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose Fixed root shell path cause login failed When I setup zsh and set wrong zsh.then I cannot login and ssh The error like this. I can not boot to single user mode.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.18-12-pve x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage * Ubuntu\u0026#39;s Kubernetes 1.14 distributions can bypass Docker and use containerd directly, see https://bit.ly/ubuntu-containerd or try it now with snap install microk8s --classic * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch Cannot execute zsh: No such file or directory Solution: I wounder that is a a command like docker command docker exec -it $dockername /bin/sh Bingo! Here we go:\n1 2 3 4 5 lxc-attach -n $lxc_pid /bin/sh #for example: lxc-attach -n 103 /bin/sh vi /etc/password #then change root shell path to /bin/sh After reboot and I can login again.\nReference Install Docker Compose LXC 简介 ","date":"2019-03-23T12:08:34+08:00","permalink":"https://echowings.github.io/p/how-to-enable-docker-in-lxc/","title":"How to Enable Docker in Lxc"},{"content":"Build Prometheus with docker-compose 1 docker-compose up -d ","date":"2019-02-21T11:02:41+08:00","permalink":"https://echowings.github.io/p/docker-compose-to-build-prometheus/","title":"Docker Compose to Build Prometheus"},{"content":"How to enable Proxmox VE nested virtualization To enable nested virtualization on Proxmox VE, we need to stop all the vm and enable nested virtualization to linux kernel. then change vm settings\nStop all the vm on proxmox VE stop all virtual machines with shell command. 1 2 3 4 5 6 7 8 9 root@xa-sys-pve01:~# pvesh create /nodes/localhost/stopall Stopping VM 116 (timeout = 180 seconds) Stopping VM 115 (timeout = 180 seconds) Stopping CT 112 (timeout = 60 seconds) Stopping CT 111 (timeout = 60 seconds) Stopping CT 108 (timeout = 60 seconds) Stopping CT 106 (timeout = 60 seconds) Stopping VM 101 (timeout = 180 seconds) UPID:xa-sys-pve01:0036EA66:01992199:5CB98D6C:stopall::root@pam: stop all the virtual machine with admin web. 1 bulk stop Enable nested module in linux kernel Check nested support status 1 2 cat /sys/module/kvm_intel/parameters/nested N enable nested support on. 1 2 3 4 5 #for intel cpu echo \u0026#34;options kvm-intel nested=Y\u0026#34; \u0026gt; /etc/modprobe.d/kvm-intel.conf #for amd cpu echo \u0026#34;options kvm-amd nested=1\u0026#34; \u0026gt; /etc/modprobe.d/kvm-amd.conf Reload the kernel module. 1 2 modprobe -r kvm_intel modprobe kvm_intel Check again. 1 2 cat /sys/module/kvm_intel/parameters/nested Y Change VM cpu type 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ```bash vi /etc/pve/qemu-server/xxx.conf ``` Add a args to the config file ``` vim #intel cpu args: -cpu host,+vmx #amd cpu args: -cpu host,+svm ``` ## Reference * [Nested Virtualization](https://pve.proxmox.com/wiki/Nested_Virtualization) ","date":"2019-02-14T11:44:28+08:00","permalink":"https://echowings.github.io/p/how-to-enable-proxmoxve-nested-virtualization/","title":"How to Enable Proxmoxve Nested Virtualization"},{"content":"LVM EXTEND How to extend lvm size use free PE\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # show volume group information vgdisplay --- Volume group --- VG Name ubuntu-vg System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 2 VG Access read/write VG Status resizable MAX LV 0 Cur LV 1 Open LV 1 Max PV 0 Cur PV 1 Act PV 1 VG Size \u0026lt;99.00 GiB PE Size 4.00 MiB Total PE 25343 Alloc PE / Size 1024 / 4.00 GiB Free PE / Size 24319 / \u0026lt;95.00 GiB VG UUID KblInT-Z6k6-1NM3-ybyV-eufy-y1vc-BiIoEM Remember 24319 from Free PE / Size 24319 / \u0026lt;95.00 GiB\nlist logical volume 1 lvdisplay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 --- Logical volume --- LV Path /dev/ubuntu-vg/ubuntu-lv LV Name ubuntu-lv VG Name ubuntu-vg LV UUID Pi0Id7-riMg-BtmN-sfdF-gIjX-KrCp-TxxCBt LV Write Access read/write LV Creation host, time ubuntu-server, 2018-12-12 03:43:02 +0000 LV Status available # open 1 LV Size 4.00 GiB Current LE 1024 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:0 Remember LV Path: /dev/ubuntu-vg/ubuntu-lv\nExtend Free PE to lvm 1 lvextend -l +24319 /dev/ubuntu-vg/ubuntu-lv 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 root@template-ubutu1804:/home/autotest# vgdisplay --- Volume group --- VG Name ubuntu-vg System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 3 VG Access read/write VG Status resizable MAX LV 0 Cur LV 1 Open LV 1 Max PV 0 Cur PV 1 Act PV 1 VG Size \u0026lt;99.00 GiB PE Size 4.00 MiB Total PE 25343 Alloc PE / Size 25343 / \u0026lt;99.00 GiB Free PE / Size 0 / 0 VG UUID KblInT-Z6k6-1NM3-ybyV-eufy-y1vc-BiIoEM resize2fs /dev/ubuntu-vg/ubuntu-lv resize2fs 1.44.1 (24-Mar-2018) Filesystem at /dev/ubuntu-vg/ubuntu-lv is mounted on /; on-line resizing required old_desc_blocks = 1, new_desc_blocks = 13 The filesystem on /dev/ubuntu-vg/ubuntu-lv is now 25951232 (4k) blocks long. Check volume group information 1 vgdisplay 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 root@template-ubutu1804:/home/autotest# vgdisplay --- Volume group --- VG Name ubuntu-vg System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 3 VG Access read/write VG Status resizable MAX LV 0 Cur LV 1 Open LV 1 Max PV 0 Cur PV 1 Act PV 1 VG Size \u0026lt;99.00 GiB PE Size 4.00 MiB Total PE 25343 Alloc PE / Size 25343 / \u0026lt;99.00 GiB Free PE / Size 0 / 0 You will see Alloc PE size is 25343, size of Free PE is 0.\nBrief of command 1 2 3 4 5 6 vgdisplay lvdisplay lvextend -l +24319 /dev/ubuntu-vg/ubuntu-lv resize2fs /dev/ubuntu-vg/ubuntu-lv vgdisplay lvdisplay ","date":"2019-01-08T11:47:31+08:00","permalink":"https://echowings.github.io/p/how-to-extend-lvm-allocted-pe-with-freee-pe/","title":"How to Extend Lvm Allocted PE With Freee PE"},{"content":"cisco ssh error When you met error like this:\n1 2 ssh cisco@10.32.3.1 Unable to negotiate with 10.32.3.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group1-sha1 Solution:\n1 $ ssh -l \u0026lt;USERNAME\u0026gt; -oHostKeyAlgorithms=+ssh-dss -oKexAlgorithms=+diffie-hellman-group1-sha1 \u0026lt;HOST\u0026gt; or\n1 ssh -l \u0026lt;username\u0026gt; -o HostKeyAlgorithms=+ssh-dss -o KexAlgorithms=+diffie-hellman-group1-sha1 -c 3des-cbc \u0026lt;hostname\u0026gt; Reference SSH failed on 3750 switch SSH Not Working After Update To 10.13.2 (HighSierra) ","date":"2018-12-29T12:19:12+08:00","permalink":"https://echowings.github.io/p/cisco-ssh-error/","title":"Cisco Ssh Error"},{"content":"How to update time via ntpserver Today, My MBP is out of power. I cannot surfing internet. and the brower tell me my time was wrong. Then I checked my time in my MBB, I\u0026rsquo;m back in time jan 1, 2018. Wow, I got extra whole year time!\nMajove update time 1 sudo sntp -sS time.asia.apple.com When you\u0026rsquo;re getting this error\n1 2 kod_init_kod_db(): Cannot open KoD db file /var/db/ntp-kod: No such file or directory You can solved the problems with:\n1 2 sudo touch /var/db/ntp-kod sudo chmod 666 /var/db/ntp-kod Disable No subscription warning 1 sed -i.bak \u0026#34;s/data.status !== \u0026#39;Active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service Reference How can I tell if my Mac is keeping the clock updated properly? ","date":"2018-12-26T09:26:04+08:00","permalink":"https://echowings.github.io/p/macos-update-time-via-ntpserver/","title":"Macos Update Time via Ntpserver"},{"content":"learning Flask 01 Installation and configure of anaconda Installaltion homebrew 1 ruby -e \u0026#34;$ (curl - fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\u0026#34; Installation of pyenv 1 2 # Installing pyenv brew install pyenv Install anaconda 2 and anaconda 3 Download anaconda from here ","date":"2018-12-25T06:11:03+08:00","permalink":"https://echowings.github.io/p/learning-flask-01/","title":"Learning Flask 01"},{"content":"Proxmox Network Adapter Pass Through Long time ago, I konw virtualization is go very good solution to server. But how about router build in virtualization? After tried to do it, I was failed. because virtual switch made networking very slow. So i just use dedicate server as a router.\nRecently days, I just learn proxmox and find pci-e pass through function. I think maybe it is way to make routing virtualization.\nHere are what I do:\nEnable VT-d and X2APic Mode Configure BIOS to enable VT-d and X2APic\nChang Grub boot settings Inel CPU Edit grub configure.\nInter CPU\nEdit grub\nEdit /etc/default/grub, then change GRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet\u0026quot; to GRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet intel_iommu=on\u0026quot;\nUpdate grub\nupdate-grub\nAMD CPU Edit grub file.\nEdit /etc/default/grub\nChange GRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet\u0026quot; to GRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet amd_iommu=on\u0026quot;\nUpdate grub\nupdate-grub\n##Change Required modules\nEdit /etc/modules Add\n1 2 3 4 vfio vfio_iommu_type1 vfio_pci vfio_virqfd Check IOMMU enable or not 1 dmesg | grep ecap script to make sure IOMMU is enabled 1 2 3 4 5 6 7 8 9 10 11 12 #!/bin/sh if [ $(dmesg | grep ecap | wc -l) -eq 0 ]; then echo \u0026#34;No interrupt remapping support found\u0026#34; exit 1 fi for i in $(dmesg | grep ecap | awk \u0026#39;{print $NF}\u0026#39;); do if [ $(( (0x$i \u0026amp; 0xf) \u0026gt;\u0026gt; 3 )) -ne 1 ]; then echo \u0026#34;Interrupt remapping not supported\u0026#34; exit 1 fi done Verify IOMMU isolation 1 find /sys/kernel/iommu_groups/ -type l Add PCI-E Device to VM Run lspci to check address of network pci-e adapter device. like this 1 lspci 1 hostpci0: 01:00.0 Add configure of yoru VM /etc/pve/qemu-server/\u0026lt;vmid\u0026gt;.conf Add configure like this to set pci-expres passthrough. 1 2 machine: q35 hostpci0: 00:00.0,pcie=1 Reference Pci passthrough ","date":"2018-12-24T16:01:23+08:00","permalink":"https://echowings.github.io/p/proxmox-ve-network-adapter-pass-through/","title":"Proxmox Ve Network Adapter Pass Through"},{"content":"How to Wirte docker file for overture Hence we need to custom overture docker image as we desire, I write this dockerfile.\nHow to map VOLUME and copy file from docker images to directory of docker host. When define VOLUME, build docker images will not copy file to the path, But we can copy the files when docker running.\nif [ \u0026ldquo;ls -A /config\u0026rdquo; = \u0026quot;\u0026quot; ]; then cp /srv/config.json /config/ \u0026amp;\u0026amp; cp /srv/*.txt /config/;fi\nOverture Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 #FROM alpine:edge FROM alpine:latest MAINTAINER steve dong \u0026lt;dongjunbo@gmail.com? # Environment variables ########################## ENV VERSION v1.4 # Change this cron rule to what fits best for you. ENV CRONTAB_TIME \u0026#39;0 0 * * *\u0026#39; # Create Volume entry points ############################ VOLUME [\u0026#34;/config\u0026#34;] # Set the work directory ######################### WORKDIR /srv # Fix permissions ################# # Install required packages ########################### RUN set -xe \u0026amp;\u0026amp; \\ mkdir -p /config \u0026amp;\u0026amp; \\ apk add --no-cache unzip curl \u0026amp;\u0026amp; \\ curl -fsSLO --compressed \u0026#34;https://github.com/shawn1m/overture/releases/download/${VERSION}/overture-linux-amd64.zip\u0026#34; \u0026amp;\u0026amp; \\ unzip -o \u0026#34;overture-linux-amd64.zip\u0026#34; -d /srv \u0026amp;\u0026amp; \\ curl https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt | base64 -d | sort -u | sed \u0026#39;/^$\\|@@/d\u0026#39;| sed \u0026#39;s#!.\\+##; s#|##g; s#@##g; s#http:\\/\\/##; s#https:\\/\\/##;\u0026#39; | sed \u0026#39;/\\*/d; / apple\\.com/d; /sina\\.cn/d; /sina\\.com\\.cn/d; /baidu\\.com/d; /qq\\.com/d\u0026#39; | sed \u0026#39;/^[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+$/d\u0026#39; | grep \u0026#39;^[0-9a-zA-Z\\.-]\\+$\u0026#39; | grep \u0026#39;\\.\u0026#39; | sed \u0026#39;s#^\\.\\+##\u0026#39; | sort -u \u0026gt; temp_gfwlist.txt \u0026amp;\u0026amp; \\ curl https://raw.githubusercontent.com/hq450/fancyss/master/rules/gfwlist.conf | sed \u0026#39;s/ipset=\\/\\.//g; s/\\/gfwlist//g; /^server/d\u0026#39; \u0026gt; temp_koolshare.txt \u0026amp;\u0026amp; \\ cat temp_gfwlist.txt temp_koolshare.txt | sort -u \u0026gt; gfw_all_domain.txt \u0026amp;\u0026amp; \\ curl -fsSLO --compressed \u0026#34;https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt\u0026#34; \u0026amp;\u0026amp; \\ sed -i \u0026#39;11s/disable/manual/\u0026#39; /srv/config.json \u0026amp;\u0026amp; \\ sed -i \u0026#39;24s/disable/manual/\u0026#39; /srv/config.json \u0026amp;\u0026amp; \\ sed -i \u0026#39;12s/\u0026#34;\u0026#34;/\u0026#34;222.90.74.60\u0026#34;/\u0026#39; /srv/config.json \u0026amp;\u0026amp; \\ sed -i \u0026#39;25s/\u0026#34;\u0026#34;/\u0026#34;202.60.225.114\u0026#34;/\u0026#39; /srv/config.json \u0026amp;\u0026amp; \\ sed -i \u0026#39;s/\u0026#34;.\\/ip_network_primary_sample\u0026#34;/\u0026#34;\\/config\\/china_ip_list.txt\u0026#34;/g\u0026#39; /srv/config.json \u0026amp;\u0026amp; \\ sed -i \u0026#39;s/\u0026#34;.\\/domain_alternative_sample\u0026#34;/\u0026#34;\\/config\\/gfw_all_domain.txt\u0026#34;/g\u0026#39; /srv/config.json \u0026amp;\u0026amp; \\ rm -rf temp_koolshare.txt temp_gfwlist.txt \u0026amp;\u0026amp; \\ rm -rf \u0026#34;overture-linux-amd64.zip\u0026#34; \u0026amp;\u0026amp; \\ chmod 0644 /config/ \u0026amp;\u0026amp; \\ cp /srv/config.json /config/ \u0026amp;\u0026amp; \\ cp /srv/*.txt /config/ \u0026amp;\u0026amp; \\ apk del unzip curl # Expose required ports ####################### EXPOSE 53/udp #VOLUME [ \u0026#34;/config\u0026#34;] # Change Shell ############## SHELL [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;] CMD [\u0026#34;if [ \\\u0026#34;`ls -A /config`\\\u0026#34; = \\\u0026#34;\\\u0026#34; ]; then cp /srv/config.json /config/ \u0026amp;\u0026amp; cp /srv/*.txt /config/; fi\u0026#34;] ENTRYPOINT [ \u0026#34;/srv/overture-linux-amd64\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/config/config.json\u0026#34; ] #CMD /srv/overture-linux-amd64 -c /config/config.json Docker run Command 1 2 3 4 5 6 7 docker run \\ --restart=always \\ -d \\ -p 53:53/udp \\ -v \u0026#34;/root/overture-docker-data:/config\u0026#34; \\ --name xa-overture-01 \\ overture ","date":"2018-12-24T00:55:14+08:00","permalink":"https://echowings.github.io/p/dockerfile-for-overture/","title":"Dockerfile for Overture"},{"content":"Ubuntu Chinese Language Support\n编辑/etc/environment如下:\n1 vi /etc/environment 添加如下:\n1 2 3 4 LC_ALL=\u0026#34;en_US.UTF-8\u0026#34; LANG=\u0026#34;zh_CN.UTF-8\u0026#34; UNZIP=\u0026#39;-O CP936\u0026#34; ZIPINFO=\u0026#34;-O CP936\u0026#34; 重新生成语言设置\n1 2 sudo locale-gen en_US en_US.UTF-8 zh_CN zh_CN.UTF-8 sudo dpkg-reconfigure locales 1 2 3 4 5 6 7 8 9 10 11 ## 中文支持 ### vim中文支持 编辑~/.vimrc ``` bash set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936 set termencoding=utf-8 set encoding=utf-8 中文支持 ","date":"2018-12-24T00:39:51+08:00","permalink":"https://echowings.github.io/p/debian-or-ubuntu-chinese-language-support/","title":"Debian or Ubuntu Chinese Language Support"},{"content":"Install PowerDNS and Mysql on FreeBSD 12 Database Installation 1 2 3 4 5 pkg install mysql56-server sysrc mysql_server=\u0026#34;YES\u0026#34; service mysql-server restart Database and User Configuration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ mysql mysql\u0026gt; create database powerdns charset = utf8; mysql\u0026gt; CREATE USER \u0026#39;powerdns\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;XianAdmin\u0026#39;; ###mysql\u0026gt; GRANT ALL PRIVILEGES ON powerdns.* TO \u0026#39;%\u0026#39; WITH GRANT OPTION;### mysql\u0026gt; grant all privileges on powerdns.* to \u0026#39;powerdns\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;XianAdmin\u0026#39;; mysql\u0026gt; FLUSH PRIVILEGES; #For security, we also give the main admin password $ mysqladmin -u root password \u0026#34;PASSWORD_OF_ROOT\u0026#34; Install powerdns 1 pkg install powerdns Reference How to manage MySQL databases and users from the command line PowerDNS, PowerAdmin with Mysql in Freebsd 10.1 ","date":"2018-12-18T00:51:47+08:00","permalink":"https://echowings.github.io/p/install-powerdns-and-mysql-on-freebsd12/","title":"Install PowerDNS and Mysql on Freebsd12"},{"content":"Run overture on Docker and FreeBSD 12 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ENV foo /overture WORKDIR ${foo} RUN apt-get update \u0026amp;\u0026amp; apt-get install -y ca-certificates RUN printf \u0026#34;deb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse\\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse\\n deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\\n deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\\n deb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\\n deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\u0026#34; \u0026gt; /etc/apt/sources.list RUN apt-get update RUN apt-get upgrade -y RUN apt-get install -y wget curl unzip apt-utils vim RUN cd /overture RUN wget https://github.com/shawn1m/overture/releases/download/v1.5-rc1/overture-linux-amd64.zip RUN unzip overture-linux-amd64.zip RUN curl https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt | base64 -d | sort -u | sed \u0026#39;/^$\\|@@/d\u0026#39;| sed \u0026#39;s#!.\\+##; s#|##g; s#@##g; s#http:\\/\\/##; s#https:\\/\\/##;\u0026#39; | sed \u0026#39;/\\*/d; /apple\\.com/d; /sina\\.cn/d; /sina\\.com\\.cn/d; /baidu\\.com/d; /qq\\.com/d\u0026#39; | sed \u0026#39;/^[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+$/d\u0026#39; | grep \u0026#39;^[0-9a-zA-Z\\.-]\\+$\u0026#39; | grep \u0026#39;\\.\u0026#39; | sed \u0026#39;s#^\\.\\+##\u0026#39; | sort -u \u0026gt; /tmp/temp_gfwlist.txt RUN curl https://raw.githubusercontent.com/hq450/fancyss/master/rules/gfwlist.conf | sed \u0026#39;s/ipset=\\/\\.//g; s/\\/gfwlist//g; /^server/d\u0026#39; \u0026gt; /tmp/temp_koolshare.txt RUN cat /tmp/temp_gfwlist.txt /tmp/temp_koolshare.txt | sort -u \u0026gt; gfw_all_domain.txt RUN wget https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt RUN printf \u0026#39;{ \\n \u0026#34;BindAddress\u0026#34;: \u0026#34;:53\u0026#34;,\\n \u0026#34;PrimaryDNS\u0026#34;: [\\n {\\n \u0026#34;Name\u0026#34;: \u0026#34;DNSPod\u0026#34;,\\n \u0026#34;Address\u0026#34;: \u0026#34;114.114.114.114:53\u0026#34;,\\n \u0026#34;Protocol\u0026#34;: \u0026#34;udp\u0026#34;,\\n \u0026#34;SOCKS5Address\u0026#34;: \u0026#34;\u0026#34;,\\n \u0026#34;Timeout\u0026#34;: 6,\\n \u0026#34;EDNSClientSubnet\u0026#34;: {\\n \u0026#34;Policy\u0026#34;: \u0026#34;auto\u0026#34;,\\n \u0026#34;ExternalIP\u0026#34;: \u0026#34;222.90.74.60\u0026#34;,\\n \u0026#34;NoCookie\u0026#34;: true\\n }\\n }\\n ],\\n \u0026#34;AlternativeDNS\u0026#34;: [\\n {\\n \u0026#34;Name\u0026#34;: \u0026#34;OpenDNS\u0026#34;,\\n \u0026#34;Address\u0026#34;: \u0026#34;208.67.222.222:443\u0026#34;,\\n \u0026#34;Protocol\u0026#34;: \u0026#34;tcp\u0026#34;,\\n \u0026#34;SOCKS5Address\u0026#34;: \u0026#34;\u0026#34;,\\n \u0026#34;Timeout\u0026#34;: 6,\\n \u0026#34;EDNSClientSubnet\u0026#34;: {\\n \u0026#34;Policy\u0026#34;: \u0026#34;manual\u0026#34;,\\n \u0026#34;ExternalIP\u0026#34;: \u0026#34;202.60.225.114\u0026#34;,\\n \u0026#34;NoCookie\u0026#34;: true\\n }\\n }\\n ],\\n \u0026#34;OnlyPrimaryDNS\u0026#34;: false,\\n \u0026#34;IPv6UseAlternativeDNS\u0026#34;: false,\\n \u0026#34;IPNetworkFile\u0026#34;: {\\n \u0026#34;Primary\u0026#34;: \u0026#34;./china_ip_list.txt\u0026#34;,\\n \u0026#34;Alternative\u0026#34;: \u0026#34;./ip_network_alternative_sample\u0026#34;\\n },\\n \u0026#34;DomainFile\u0026#34;: {\\n \u0026#34;Primary\u0026#34;: \u0026#34;./domain_primary_sample\u0026#34;,\\n \u0026#34;Alternative\u0026#34;: \u0026#34;./gfw_all_domain.txt\u0026#34;\\n },\\n \u0026#34;HostsFile\u0026#34;: \u0026#34;./hosts_sample\u0026#34;,\\n \u0026#34;MinimumTTL\u0026#34;: 0,\\n \u0026#34;CacheSize\u0026#34; : 0,\\n \u0026#34;RejectQtype\u0026#34;: [255]\\n }\u0026#39; \u0026gt; config.json CMD [\u0026#34;./overture-linux-amd64\u0026#34;] #ENTRYPOINT [\u0026#34;./overture-linux-amd64\u0026#34;] FreeBSD rc.d file cat /usr/local/etc/rc.d/overture\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 #!/bin/sh # $FreeBSD: head/net/overture/files/overture.in 335066 2018-12-18 11:33:26z SteveDong $ # PROVIDE: overture # REQUIRE: LOGIN cleanvar # KEYWORD: shutdown # Add the following lines to /etc/rc.conf to enable overture # overture_enable (bool): set to \u0026#34;NO\u0026#34; by default # Set to \u0026#34;YES\u0026#34; to enable overture. # overture_config(path): overture config file. # Default to \u0026#34;/usr/local/etc/overture/config.json\u0026#34; . /etc/rc.subr name=\u0026#34;overture\u0026#34; rcvar=overture_enable load_rc_config $name : ${overture_enable:=\u0026#34;NO\u0026#34;} : ${overture_user:=\u0026#34;root\u0026#34;} : ${overture_group:=\u0026#34;nobody\u0026#34;} #: ${error_log_file=\u0026#34;/var/log/overture_error\u0026#34;} #: ${overture_args:=\u0026#34;-p ${cpu_core} -c ${overture_config} -l ${logfile}\u0026#34;} : ${overture_config=\u0026#34;/usr/local/etc/overture/config.json\u0026#34;} command=\u0026#34;/usr/sbin/daemon\u0026#34; procname=\u0026#34;/usr/local/bin/overture\u0026#34; pidfile=\u0026#34;/var/run/overture.pid\u0026#34; logfile=\u0026#34;/var/log/overture\u0026#34; error_log_file=\u0026#34;/var/log/overture_error\u0026#34; requried_files=\u0026#34;${overture_config}\u0026#34; # find how many cores on your computer cpu_core=$(cat /var/run/dmesg.boot | grep CPU | grep FreeBSD | awk {\u0026#39;print $5\u0026#39;}) overture_args=\u0026#34;-p ${cpu_core} -c ${overture_config} -l ${logfile} 2\u0026gt;\u0026amp;1 \u0026gt; $error_log_file\u0026#34; command_args=\u0026#34;-p ${pidfile} /usr/bin/env ${procname} ${overture_args}\u0026#34; start_precmd=overture_startprecmd overture_startprecmd() { if [ ! -e ${pidfile} ]; then install -o ${overture_user} -g ${overture_group} /dev/null ${pidfile}; fi if [ ! -e ${logfile} ]; then install -o ${overture_user} -g ${overture_group} /dev/null ${logfile}; fi if [ ! -e ${error_log_file} ]; then install -o ${overture_user} -g ${overture_group} /dev/null ${error_log_file}; fi } load_rc_config $name run_rc_command \u0026#34;$1\u0026#34; ","date":"2018-12-18T00:44:13+08:00","permalink":"https://echowings.github.io/p/deploy-overture-with-docker-and-freebsd/","title":"Deploy Overture With Docker and Freebsd"},{"content":"How to Install Proxmox VE 5.x on Debian 9 Chang IP ADDRESS vi /etc/network/interfaces\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5). source /etc/network/interfaces.d/* # The loopback network interface auto lo iface lo inet loopback # The primary network interface #allow-hotplug eno1 auto eno1 #iface eno1 inet dhcp iface eno1 inet static address *.*.*.* netmask *.*.*.* gateway *.*.*.* Change DNS vi /etc/resolv.conf\nChange your ip and hostname vi /etc/hosts\n1 2 3 4 5 6 7 127.0.0.1 localhost.localdomain localhost 10.32.0.60 xa-sys-pve02 pvelocalhost # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters Perl ALL_LC ERROR 1 2 3 4 5 6 7 8 export LANGUAGE=en_US.UTF-8 export LANG=en_US.UTF-8 export LC_ALL=en_US.UTF-8 #locale-gen en_US.UTF-8 cat \u0026gt;\u0026gt; /etc/environment \u0026lt;\u0026lt;EOF LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 EOF Add Utsc mirrors source before to chang source need to install\n1 apt install apt-transport-https 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #chang debian source list echo \u0026#34;deb https://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free\u0026#34; \u0026gt; /etc/apt/sources.list #change pve 5.x update source list echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian/pve/ stretch pve-no-subscription\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list #change ceph source list to utsc mirrors echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-luminous stretch main\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # add key wget http://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-5.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-5.x.gpg Install proxmox VE 1 2 3 apt update \u0026amp;\u0026amp; apt -y dist-ugprade apt install proxmox-ve postfix open-iscsi update-grub Remove “No valid Subscription” Message shell solution. 1 2 sed -i.bak \u0026#34;s/data.status !== \u0026#39;Active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service manual solution: 1 2 3 4 5 6 7 8 9 10 11 cd /usr/share/javascript/proxmox-widget-toolkit cp proxmoxlib.js proxmoxlib.js.bak nano proxmoxlib.js # change if (data.status !== \u0026#39;Active\u0026#39;) { if (false) { #restart pveproxy.service systemctl restart pveproxy.service Remove sourcelist of pve enterprise subscription and ceph 1 2 3 4 5 # Delete Enterprise subscription. rm -rf /etc/apt/sources.list.d/pve-enterprise.list # Delete proxmox ve offical ceph source. rm -rf /etc/apt/sources.list.d/ceph.list Remove “No valid Subscription” Message shell solution. 1 2 sed -i.bak \u0026#34;s/data.status !== \u0026#39;Active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service manual solution: 1 2 3 4 5 6 7 8 9 10 11 cd /usr/share/javascript/proxmox-widget-toolkit cp proxmoxlib.js proxmoxlib.js.bak nano proxmoxlib.js # change if (data.status !== \u0026#39;Active\u0026#39;) { if (false) { #restart pveproxy.service systemctl restart pveproxy.service Q\u0026amp;A When you got error like this, please make sure hosts file is set without wrong. like this10.32.0.60 xa-sys-pve02 xa-sys-pve02 pvelocalhost 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 Setting up pve-manager (5.2-1) ... Job for pvestatd.service failed because the control process exited with error code. See \u0026#34;systemctl status pvestatd.service\u0026#34; and \u0026#34;journalctl -xe\u0026#34; for details. pvestatd.service couldn\u0026#39;t start. dpkg: error processing package pve-manager (--configure): subprocess installed post-installation script returned error exit status 1 Processing triggers for man-db (2.7.6.1-2) ... dpkg: dependency problems prevent configuration of proxmox-ve: proxmox-ve depends on pve-manager; however: Package pve-manager is not configured yet. dpkg: error processing package proxmox-ve (--configure): dependency problems - leaving unconfigured Errors were encountered while processing: pve-manager proxmox-ve E: Sub-process /usr/bin/dpkg returned an error code (1) Setting up pve-manager (5.2-1) ... Job for pvestatd.service failed because the control process exited with error code. See \u0026#34;systemctl status pvestatd.service\u0026#34; and \u0026#34;journalctl -xe\u0026#34; for details. pvestatd.service couldn\u0026#39;t start. dpkg: error processing package pve-manager (--configure): subprocess installed post-installation script returned error exit status 1 dpkg: dependency problems prevent configuration of proxmox-ve: proxmox-ve depends on pve-manager; however: Package pve-manager is not configured yet. dpkg: error processing package proxmox-ve (--configure): dependency problems - leaving unconfigured Errors were encountered while processing: pve-manager proxmox-ve Install openvswitch-switch 1 apt-get install openvsiwtch-switch proxmox Q\u0026amp;A Error 1: command '/sbin/sgdisk /dev/sde -U R' failed: exit code 3 1 2 3 4 5 /sbin/sgdisk /dev/sdf -U R -g *************************************************************** Found invalid GPT and valid MBR; converting MBR to GPT format in memory. *************************************************************** Error 2: `Driver \u0026lsquo;pcspkr\u0026rsquo; is already registered, aborting\u0026hellip; 1 # echo \u0026#34;blacklist pcspkr\u0026#34; \u0026gt; /etc/modprobe.d/blacklist-pcspkr.conf Reference Problem with installing Proxmox-VE on Debian Error: Driver \u0026lsquo;pcspkr\u0026rsquo; is already registered, aborting\u0026hellip; ","date":"2018-12-01T00:02:28+08:00","permalink":"https://echowings.github.io/p/how-to-install-proxmoxve-5.x-on-debian-9/","title":"How to install ProxmoxVE 5.x on Debian 9"},{"content":"How to test network speed with iperf Install iperf 1 sudo apt-get install iperf3 Testing network speed Testing network speed with UDP Run command on server\n1 iperf -s -u Run command on client\n1 iperf -c -u Testing network speed with TCP\nServer side. 1 iperf -s Client side. 1 iperf -c Command for 1 2 3 4 5 6 -s server -c client + server IP -u udp -b bandwith(the max bandwidth -t time,how long to send packet. -i interval output per seconds. ","date":"2018-11-29T23:52:57+08:00","permalink":"https://echowings.github.io/p/how-to-testing-network-bandwith-with-iperf/","title":"How to Testing Network Bandwith With Iperf"},{"content":" 1 2 3 4 apt-get autoremove export LC_ALL=en_US.UTF-8 echo \u0026#34;en_US.UTF-8 UTF-8\u0026#34; \u0026gt;\u0026gt; /etc/locale.gen locale-gen ","date":"2018-11-29T23:48:32+08:00","permalink":"https://echowings.github.io/p/how-to-remove-lc_ctype-error/","title":"How to Remove LC_CTYPE Error"},{"content":"Python Development python开发笔记-01-python开发入门 安装ptyhon开发工具和包 安装ubuntu 16.04 \u0026hellip;pass\u0026hellip;\n安装系统相关依赖包 build-essential包可以批量安装Python在Ubuntu上进行构建时所需的全部工具(gcc,make等).\n1 2 3 4 5 6 7 8 9 10 11 12 sudo apt-get -y update \u0026amp;\u0026amp; \\ sudo apt-get -y upgrade \u0026amp;\u0026amp; \\ sudo apt-get install -y build-essential \\ libsqlite3-dev \\ libreadline6-dev \\ libgdbm-dev \\ zlib1g-dev \\ libbz2-dev \\ sqlite3 \\ tk-dev \\ zip \\ libssl-dev 安装python相关依赖包 install python-dev和pip\n1 2 3 4 5 6 7 8 9 10 11 # Install python-dev sudo apt-get -y install python-dev #install pip (before python 2.7.9) wget https://bootstrap.pypa.io/get-pip.py sudo python get-pip.py #在python 3.4和python2.7.9之后加入了 ensurepip模块,也就是安装python的时候默认捆绑安装pip,更新pip使用 #python -m ensurepip -U sudo python -m pip install --upgrade pip ##使用get-pip.py来安装最新版本的pip\n查看python版本 1 2 $python -V Python 2.7.12 查看pip版本 1 2 $ pip --version pip 18.1 from /usr/local/lib/python2.7/dist-packages/pip (python 2.7) 通过pip安装开发用的软件 安装virtualenv包 1 2 3 4 5 6 7 8 9 $sudo pip insetall virtualenv Collecting virtualenv Downloading https://files.pythonhosted.org/packages/7c/17/9b7b6cddfd255388b58c61e25b091047f6814183e1d63741c8df8dcd65a2/virtualenv-16.1.0-py2.py3-none-any.whl (1.9MB) 100% |################################| 1.9MB 2.5MB/s Installing collected packages: virtualenv Successfully installed virtualenv-16.1.0 virtualenv 的使用方法 virtualenv是搭建虚拟的python执行环境. $ virtualenv --version 16.1.0 查看当前pip 安装的软件 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ pip freeze ansible==2.7.2 asn1crypto==0.24.0 bcrypt==3.1.4 cffi==1.11.5 cryptography==2.4.2 enum34==1.1.6 idna==2.7 ipaddress==1.0.22 Jinja2==2.10 MarkupSafe==1.1.0 paramiko==2.4.2 pyasn1==0.4.4 pycparser==2.19 PyNaCl==1.3.0 PyYAML==3.13 six==1.11.0 virtualenv==16.1.0 搭建virtualenv环境 1 2 3 4 5 6 $mkdir ~/work $cd ~/work $virtualenv venv New python executable in /home/user1/work/venv/bin/python Installing setuptools, pip, wheel... done. 启动virtualenv 环境 1 2 3 4 $source venv/bin/activate (venv) user1@python-dev-env:~/work$ #使用pip freeze查看已经安装pip包为空 $pip freeze 关闭virtualenv环境 1 $ deactivate 删除virtualenv 1 rm -R vienv 多python版本使用 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 user1@python-dev-env:~/work$ python3 -V Python 3.5.2 user1@python-dev-env:~/work$ python2 -V Python 2.7.12 使用virtualenv 设置不同版本的python mkdir -p ~/work/venv-python2 mkdir -p ~/work/venv-python3 cd ~/work virtualenv --python=/usr/bin/python2 venv-python2 virtualenv --python=/usr/bin/python3 venv-python3 source venv-python2/bin/activate python -V pip freeze deactivate source venv-python3/bin/activate python -V deactivate Mercurial 为什么使用 mecurial, python编写.易于上手.内置web管理,支持bitbucket,用TortoiseHg等GUI客户端. - 安装Mercurial 1 2 3 $sudo pip install mercurial Collecting mercurial Downloading https://files.pythonhosted.org/packages/6a/f4/4c3d3a2bf950f3261f506284952e23cee2b62e50eb8974aa961228a95e8a/mercurial-4.8.tar.gz (6.9MB) 100% |################################| 6.9MB 1.3MB/s Installing collected packages: mercurial Running setup.py install for mercurial … done Successfully installed mercurial-4.8 安装zsh 1 2 3 4 5 6 7 sudo apt-get install zsh sh -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\u0026#34; # vi ~/.zhsrc plugins=( git bundler dotenv osx rake rbenv ruby mercurial ) ZSH_THEME=“agnoster” 查看Mercurial版本 1 2 3 4 5 6 7 user1@python-dev-env:~$ hg --version Mercurial Distributed SCM (version 4.8) (see https://mercurial-scm.org for more information) Copyright (C) 2005-2018 Matt Mackall and others This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 创建版本库 创建Mercurial的环境设置文件.在主目录下创建.hgrc文件, 括号内的称为节(Section),如[ui]用来设置usernme的属性.username会想版本哭提交时候记录在日志里 [Extensions]用来激活Mercurial附属的扩展工具,将扩展工具名写入[extensions],我们就可以使用该工具了.有一些工具不但要在Extension中设置,还要在pager中设置pager属性 1 vi ~/.hgrc [ui] username=bpbook bpbook@beproud.jp [extensions] color= pager= [pager] pager=LESS=‘FSRX’ less\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 mercurial mkdir ~/hgtest cd ~/hgtest hg init touch test.txt hg status ? test.txt # ？代表没有添加到hg库里、M标示修改, A标示有添加 # 添加文件　hg add hg add test.txt hg status A test.txt # 提交文件 $hg commit test commit #在打开的编辑器中,填写commit,然后保存退出,完成提交 修改~/.hgrc , [ui]节添加 [ui] editor = vim $ echo $EDITOR vim # hg staus 查看提交后的状态 hg status #查看差别 $ hg diff # 撤销编辑(未提交的内容) $ hg revert test.txt # 撤销已经提交的内容 $ hg commit --amend python代码编辑器 vim 1 2 3 4 5 6 7 8 9 10 11 \u0026#34; 将“Tab”替换为“空格” setl expandtab \u0026#34; 将“Tab”的“缩进幅度”改为 4 setl tabstop=4 “ 自动缩进时的“缩进幅度”改为 4 setl shiftwidth=4 “ 按下键盘“Tab”键时插入的空格数 “ 这里设置为 0 就可以插入“tabstop”中设置的空格数了 setl softtabstop=0 “ 保存时删除行尾的空格 autocmd BufWritePre * :%s/\\s+$//ge “80 个字符换行 setlocal textwidth=80 install neobundle.vim 1 2 3 4 cd ~ curl https://raw.githubusercontent.com/Shougo/neobundle.vim/master/bin/install.sh | sh vim ~/.vimrc NeoBundle \u0026#39;nvie/vim-flake8\u0026#39; pbd调试 1 2 3 4 5 6 7 8 9 10 def add(x, y): return x + y x= 0 import pdb; pdb.set_trace() x = add(1, 2) $python pdbtest.py \u0026gt; pdbtest.py(7)\u0026lt;module\u0026gt;() -\u0026gt; x = add(1, 2) (Pdb) ","date":"2018-11-29T00:28:31+08:00","permalink":"https://echowings.github.io/p/python-development-01/","title":"Python Development 01"},{"content":"Ssh Login Without Password SSH login linux/unix without password General your key 1 ssh-keygen-t rsa copy your rsa.pub to server which you want to login without password. 1 ssh-copy-id -i ~/.ssh/id_rsa.pub user1@$server-hosts Test login 1 ssh user1@$server-hosts ","date":"2018-11-29T00:22:57+08:00","permalink":"https://echowings.github.io/p/ssh-login-without-password/","title":"Ssh Login Without Password"},{"content":"Proxmox VE 5.x Installation Proxmox won’t install- “A volume group called pve already exists Solution:\nBoot the proxmox installer USB Select Debug Mode Press “CTRL+D” to start the installer wizard. Click on abort Run “vgdisplay” to dislay the LVM PG’s. Run “vgremode pve ” to remove pve PG. Remove “No valid Subscription” Message shell solution. 1 2 sed -i.bak \u0026#34;s/data.status !== \u0026#39;Active\u0026#39;/false/g\u0026#34; /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js \u0026amp;\u0026amp; systemctl restart pveproxy.service manual solution: 1 2 3 4 5 6 7 8 9 10 11 cd /usr/share/javascript/proxmox-widget-toolkit cp proxmoxlib.js proxmoxlib.js.bak nano proxmoxlib.js # change if (data.status !== \u0026#39;Active\u0026#39;) { if (false) { #restart pveproxy.service systemctl restart pveproxy.service Change update source 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #chang debian source list echo \u0026#34;deb https://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch-updates main contrib non-free deb https://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian/ stretch-backports main contrib non-free deb https://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free deb-src https://mirrors.ustc.edu.cn/debian-security/ stretch/updates main contrib non-free\u0026#34; \u0026gt; /etc/apt/sources.list #change pve 5.x update source list echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian/pve/ stretch pve-no-subscription\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list #change ceph source list to utsc mirrors echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-luminous stretch main\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # add key wget http://mirrors.ustc.edu.cn/proxmox/debian/proxmox-ve-release-5.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-5.x.gpg apt update \u0026amp;\u0026amp; apt -y dist-upgrade update-grub Remove sourcelist of pve enterprise subscription and ceph 1 2 3 4 5 # Delete Enterprise subscription. rm -rf /etc/apt/sources.list.d/pve-enterprise.list # Delete proxmox ve offical ceph source. rm -rf /etc/apt/sources.list.d/ceph.list Reference Proxmox won’t install - “A volume group called pve already exists”. Remove Proxmox 5.1 or 5.2 Subscription Notice ","date":"2018-11-19T23:38:39+08:00","permalink":"https://echowings.github.io/p/proxmoxve-ve-v5.x-installation/","title":"Proxmoxve VE V5.x Installation"},{"content":"Linux In Action-[翻译]Linux实战 前言 作为IT运维人员或者程序员,不论做什么或做多久.如果你不学习新东西,你可能现在已经已经转行了.不仅仅是平台或者技术图表持续的变更.也不仅仅是业务需求需要新思维.或者一个坏蛋不停使用新路子来攻击你的服务器. 而是所用事情的综合. 你不能承担停止学习的代价.而诀窍就是找到一个方法学习高优先级的技能,而不能让经验成为你成长的阻碍.\n我的意愿和初衷是想让你遍读本书的每一章,然后可以自信地接受挑战(一些以前你不能自信挑战的事情)并战胜之.如果你\n","date":"2018-11-16T23:34:58+08:00","permalink":"https://echowings.github.io/p/linux-in-action-01/","title":"Linux in Action 01"},{"content":"How to Setup Reverse proxy with IIS I testing it on Server 2016 with IIS 10\nInstall IIS,URL _REWRITE, ARR Install IIS. Download and install URL Rewrite Module 2.1 Download and install ARR-Application-request-routing Setting Reverse Proxy Select Root level in IIS management\nClick ‘Application Request Routing Cache’,then in the right side, click “proxy | Server proxy Settings | Check on “Enable proxy” | save config.\nSelect website in IIS.\nClick URL Rewrite\nAdd a black Rule\n* Match URL: Requested URL Using Pattern Matches the pattern Regular Expressions ^(.*) * Conditions: Type Value Logical grouping Match ALL input {HTTP_HOST} Type Matches the Pattern Patern ^xa-sys-svr:8080$ * Server Variables: Type Value Action Type Rewrite Rewrite URL http://www.cnblog.com/{R:1} Reference 用IIS配置反向代理 ","date":"2018-11-06T23:26:18+08:00","permalink":"https://echowings.github.io/p/how-to-setup-reverse-proxy-with-iis/","title":"How to Setup Reverse Proxy With Iis"},{"content":"KVM virtualization-01 Introduction Today we are start to learn kvm virtulization After try to find which is the right open source virtulization solution,which include Bhyver, Trolin/smartos, ovirt, OpenStack.\nOpenstack is too heavy and it is suitable for you have thousands of host to managament. bhyver is base freebsd, and it has a web managment system named Clonos which write by a russian Less support. smartos/Trolin is a opensolaris base . But few people use it. It has open source version, but the offical website say again and again that ‘you’d better to contact us to install it’, that means you should pay for it if you want use it . Ovirt is ","date":"2018-10-26T23:22:46+08:00","permalink":"https://echowings.github.io/p/kvm-virtualization-01-introduction/","title":"Kvm Virtualization 01 Introduction"},{"content":"Building Network With Vyos.-.01.Basic Installing and Configuration Vyos is a debian base router. it is fork form vyatta core.It is very stable and fast router OS. It hasn’t web UI, but only command line configration just like JUNOS.\nAt now, vyos version will be vyos version 1.2 released. I will wirte the turtural with vyos 1.2RC4.\nInstall vyos Download vyos form the office website:\nDownload Link: vyos-1.2.0-rc-4-amd64 Write iso image to usb disk Linux and Mac: 1 ddi if=vyos-1.2.0-rc-4-amd64.iso of=/dev/$yourusbdisk bs=1M Windows: download Rufus: rufus select dd mode to write disk. Install vyos with wizard. press F11 or set COMS to boot from usb.\nEnter Default username and password to login livecd.\nvyos login: vyos Password: vyos\n1 2 3 4 5 6 ## Write image to local driver: ```bash install image Reboot System to boot from local disk. 1 reboot now Basic Command vyos command line include 2 mode: Operation mode and configure mode.\nOperation Mode shell command start with $. These command usually show sysytem. information,reboot/shutdown system.\nConfigure Mode shell command start with #. These command usually change configuration of vyos.\nOperation Mode 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # Enter configure mode configure #Exit to operation Mode exit #Check vyos version show version #Check vyos running time show system uptime #Check system time and timezone show date #Reboot system reboot now #Shutdown System poweroff now #upgrade system image version add system image $URL_or_path #Reset configuration # Enter config mode configure #loading default configure load /opt/vyatta/etc/config.boot.default # commit loading default configure commit # save to default boot configure file. save #Exit configure mode exit #Reboot system now to finish loading default configuration. reboot now #bonding \u0026lt;conitune\u0026hellip;\u0026gt;\n","date":"2018-10-26T22:44:02+08:00","permalink":"https://echowings.github.io/p/building-network-with-vyos-01---basic-installing-and-configuration/","title":"Building Network With Vyos 01---Basic Installing and Configuration"},{"content":"How to install netcore/aspnetcore 2.1.4 on RHEL 6.8 Recently days, we met a scenario that is our client production environment must be RHEL 6.8. But our product is base asp.net core 2.1.x version. Rehat and Microsoft has never say the are support RHEL 6.X version.\nAfter a few days research, I found that .net core website is support RHEL 6.X,but no runtime.We can download install SDK to support asp.net core. And you know what? It works well finally!\nInstall netcore 2.1.4 sdk 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 #!/bin/sh yum install -y wget epel-release yum install -y openssl-devel libnghttp2-devel libidn-devel gcc libtool m4 automake cd /tmp/ curl -O https://curl.haxx.se/download/curl-7.45.0.tar.gz tar -xf curl-7.45.0.tar.gz cd curl-7.45.0 ./configure \\ --disable-dict \\ --disable-file \\ --disable-ftp \\ --disable-gopher \\ --disable-imap \\ --disable-ldap \\ --disable-ldaps \\ --disable-libcurl-option \\ --disable-manual \\ --disable-pop3 \\ --disable-rtsp \\ --disable-smb \\ --disable-smtp \\ --disable-telnet \\ --disable-tftp \\ --enable-ipv6 \\ --enable-optimize \\ --enable-symbol-hiding \\ --with-ca-bundle=/etc/pki/tls/certs/ca-bundle.crt \\ --with-nghttp2 \\ --with-gssapi \\ --with-ssl \\ --without-librtmp \\ --prefix=$PWD/install/usr/local make install 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 cd install tar -czf curl-7_45_0-RHEL6-x64.tgz * curl -O http://download.icu-project.org/files/icu4c/57.1/icu4c-57_1-RHEL6-x64.tgz tar -xf curl-7_45_0-RHEL6-x64.tgz -C / tar -xf icu4c-57_1-RHEL6-x64.tgz -C / echo \u0026#34;export LD_LIBRARY_PATH=/usr/local/lib\u0026#34; \u0026gt;\u0026gt; /etc/profile export LD_LIBRARY_PATH=/usr/local/lib cd /tmp/ mkdir dotnetsdk curl -O https://download.microsoft.com/download/8/A/7/8A765126-50CA-4C6F-890B-19AE47961E4B/dotnet-sdk-2.1.402-rhel.6-x64.tar.gz tar -zxvf dotnet-sdk-2.1.402-rhel.6-x64.tar.gz -C dotnetsdk/ mv dotnetsdk /opt/ ln -s /opt/dotnetsdk/dotnet /usr/bin/dotnet curl -sSL https://github.com/libuv/libuv/archive/v1.4.2.tar.gz | sudo tar zxfv - -C /usr/local/src # Insall libuv-1.4.2 cd /usr/local/src/libuv-1.4.2 sh autogen.sh ./configure make make install rm -rf /usr/local/src/libuv-1.4.2 \u0026amp;\u0026amp; cd ~/ ldconfig Reference How to use .NET Core on RHEL 6 / CentOS 6\n.NET Core 2.1.4\n","date":"2018-10-26T22:29:04+08:00","permalink":"https://echowings.github.io/p/how-to-install-dotnetcore2.1.x-and-asp.net21.x-on-rhel6.x-centos6/","title":"How to Install Dotnetcore2.1.x and Asp.net21.x on RHEL6.x CENTOS6"},{"content":"A journey of a thousand miles begins with a single step THis a blog to be build as my knowleage base.\n","date":"2018-10-26T00:00:00Z","permalink":"https://echowings.github.io/p/first-blog/","title":"First Blog"},{"content":"Hugo on your MacOS Setting github create a repo named blogs for store hugo programes. Create another repo named echowings.github.io to host websit. generate ssh key and regist it on github settings. Install hugo 1 2 brew install hugo Create a blog site. 1 2 hugo new site blogs init git 1 2 3 4 5 6 7 8 9 cd blogs git init #Add remote repo. git remote add origin git@github.com:echowings/blogs.git #Add a theme for your hugo. git submodule add -b master https://github.com/xianmin/hugo-theme-jane.git themes/jane cp -r themes/jane/exampleSite/content ./ cp themes/jane/exampleSite/config.toml ./ Test hugo at local. 1 2 hugo server You can access http://localhost:1313 to test your blog in local. Change configure Modifiy vi config.toml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 #Change URL baseURL = \u0026#34;https://blog.stevedong.com\u0026#34; #Change Title title = \u0026#34;Steve Dong - A System Administrator\u0026#39;s Blog\u0026#34; #Change theme to jane theme = \u0026#34;jane\u0026#34; #How many pages will be displayed on homepage. pageinate = 15 # Display how many pages will be displayed on archive page. archive-paginate = 50 #RSS limite. rssLimit = 50 #google analytics related googleAnalytics= \u0026#34;UA-xxxxxxxx-X\u0026#34; # Chang author name = \u0026#34;Steve Dong\u0026#34; # Commit the meanu \u0026#34;External Link\u0026#34; #[[menu.main]] # name = \u0026#34;MyGitHub\u0026#34; # weight = 50 # url = \u0026#34;https://echowings.github.com\u0026#34; #Change Site creation time [params] since = \u0026#34;2018\u0026#34; logoTitle= \u0026#34;Steve Dong\u0026#34; keywords = [\u0026#34;network\u0026#34;, \u0026#34;devops\u0026#39;, \u0026#34;System Administrator\u0026#34;] Add syntax highlight vi config.toml\nadd\n1 2 3 4 pygmentsCodefences = true #高亮markdown的代码块 pygmentsCodefencesGuessSyntax = true #高亮markdown中没有标注语言的代码块 pygmentsStyle = \u0026#39;manni\u0026#39; #高亮主题 Deploy your blog to github Add repo of blog website. 1 2 3 4 git submodule add --force -b \\ master git@github.com:echowings/echowings.github.io.git public Run hugo to generate your blog website.\n1 2 hugo server publish your website\n1 2 3 4 5 cd public git add. git commit -m \u0026#34;YOUR COMMIT MESSAGE\u0026#34; git push origin master Backup your hugo blog to github\n1 2 3 4 5 cd .. git add. git commit -m \u0026#34;YOUR COMMIT MESSAGE\u0026#34; git push origin master Add a comment Since theme jane has support utterances, we just need to enable utterances apps in github and configure it in config.toml in hugo.\nCreate a repo to storage comment. like “blogcomment”.\nenable utternaces apps.\nclick utterances app Auth utterances to your github repo “blogcomment”. edit blogs/config.toml and append follow lines.\n[params.utteranc] enable = true repo=\u0026ldquo;echowings/blogcomment\u0026rdquo; issueTerm=\u0026ldquo;pathname\u0026rdquo;\n1 2 3 4 5 6 7 8 9 ### Download git and rebuild blog environment ``` zsh git pulll git@github.com:echowings/blogs.git #if public already exsited run `rm public` git submodule add --force -b master git@github.com:echowings/echowings.github.io.git public Reference utterances hugo-theme-jane/dev-config.toml 如何在github.io搭建Hugo博客站 用chroma进行语法高亮 ","date":"2018-10-26T00:00:00Z","permalink":"https://echowings.github.io/p/how-to-build-blog-with-hugo-on-github/","title":"How to Build Blog With Hugo on Github"}]