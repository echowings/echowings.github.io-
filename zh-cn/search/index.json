[{"content":"Shell Script to Update Cloudflare Ddns Script 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 #!/bin/bash ############## User Configuration ############### # Define programme path # location_path=\u0026#34;/config/scripts/ddns\u0026#34; location_path=$(dirname -- \u0026#34;$0\u0026#34;) # You Registered CloudFlare Mail Account auth_email=\u0026#34;\u0026#34; # CloudFlare Global API Key auth_key=\u0026#34;\u0026#34; # Root Doman Name zone_name=\u0026#34;\u0026#34; # IP Type，Enter \u0026#39;ipv4\u0026#39; or \u0026#39;ipv6\u0026#39; ,at here we got paramter from our input type=$1 # DDNS Domain Name record_name=$2 # WAN INTERFACE INTERFACE=\u0026#34;\u0026#34; ############# Script ############ # The before WAN IP ip_file=\u0026#34;$location_path/$1_$2_ip.txt\u0026#34; # Domain id information # Domain id information id_file=\u0026#34;$location_path/$1_$2_cloudflare.ids\u0026#34; # Log location log_file=\u0026#34;$location_path/cloudflare.log\u0026#34; ################ Don\u0026#39;t change here ############### ################## Function #################### record_type=\u0026#34;\u0026#34; ip=\u0026#34;\u0026#34; zone_identifier=\u0026#34;\u0026#34; record_identifier=\u0026#34;\u0026#34; update=\u0026#34;\u0026#34; # Log function log() { if [ \u0026#34;$1\u0026#34; ]; then echo -e \u0026#34;[$(date)] - $1\u0026#34; \u0026gt;\u0026gt; $log_file fi } #To get local IP address get_ip() { if [ $type == \u0026#34;ipv4\u0026#34; ]; then record_type=\u0026#34;A\u0026#34; ip=$(ip addr | grep ${INTERFACE} -A2 | grep inet | grep -v inet6 | awk \u0026#39;{print $2}\u0026#39;) elif [ $type == \u0026#34;ipv6\u0026#34; ]; then record_type=\u0026#34;AAAA\u0026#34; ip=$(ip addr | grep ${INTERFACE} -A2 | grep inet6 | awk \u0026#39;{print $2}\u0026#39; | cut -d \u0026#39;/\u0026#39; -f1) else echo \u0026#34;Type wrong\u0026#34; log \u0026#34;Type wrong\u0026#34; exit 0 fi } # Check IP changed or not, if there\u0026#39;s no change, then terminal programme check_ip_change() { if [ -f $ip_file ]; then old_ip=$(cat $ip_file) if [ \u0026#34;$ip\u0026#34; == \u0026#34;$old_ip\u0026#34; ]; then echo \u0026#34;IP has not changed.\u0026#34; log \u0026#34;IP has not changed.\u0026#34; exit 0 fi fi } #Get zone_id subdomain ID get_id() { if [ -f $id_file ] \u0026amp;\u0026amp; [ $(wc -l $id_file | cut -d \u0026#34; \u0026#34; -f 1) == 2 ]; then zone_identifier=$(head -1 $id_file) record_identifier=$(tail -1 $id_file) else zone_identifier=$(curl -s -X GET \u0026#34;https://api.cloudflare.com/client/v4/zones?name=$zone_name\u0026#34; -H \u0026#34;X-Auth-Email: $auth_email\u0026#34; -H \u0026#34;X-Auth-Key: $auth_key\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; | grep -Po \u0026#39;(?\u0026lt;=\u0026#34;id\u0026#34;:\u0026#34;)[^\u0026#34;]*\u0026#39; | head -1 ) rec_response_json=`curl -X GET \u0026#34;https://api.cloudflare.com/client/v4/zones/$zone_identifier/dns_records?name=$record_name\u0026#34; -H \u0026#34;X-Auth-Email: $auth_email\u0026#34; -H \u0026#34;X-Auth-Key: $auth_key\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34;` record_identifier=`echo $rec_response_json | grep -Po \u0026#39;(?\u0026lt;=\u0026#34;id\u0026#34;:\u0026#34;)[^\u0026#34;]*\u0026#39;` echo \u0026#34;$zone_identifier\u0026#34; \u0026gt; $id_file echo \u0026#34;$record_identifier\u0026#34; \u0026gt;\u0026gt; $id_file fi } #Update DNS record update_dns() { update=$(curl -s -X PUT \u0026#34;https://api.cloudflare.com/client/v4/zones/$zone_identifier/dns_records/$record_identifier\u0026#34; -H \u0026#34;X-Auth-Email: $auth_email\u0026#34; -H \u0026#34;X-Auth-Key: $auth_key\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; --data \u0026#34;{\\\u0026#34;id\\\u0026#34;:\\\u0026#34;$zone_identifier\\\u0026#34;,\\\u0026#34;type\\\u0026#34;:\\\u0026#34;$record_type\\\u0026#34;,\\\u0026#34;name\\\u0026#34;:\\\u0026#34;$record_name\\\u0026#34;,\\\u0026#34;content\\\u0026#34;:\\\u0026#34;$ip\\\u0026#34;}\u0026#34;) } ################### Main ################### log \u0026#34;Script start.\u0026#34; #Got IP Address get_ip # Check got the right ip address if [ \u0026#34;$ip\u0026#34; == \u0026#34;\u0026#34; ]; then echo \u0026#34;Can not get IP address.Please check your network connection.\u0026#34; log \u0026#34;Can not get IP address.Please check your network connection.\u0026#34; exit 0 fi # Check IP changed or not check_ip_change # Get zone_id and sumdomain record ID get_id # Check get ID successfully or not if [ \u0026#34;$zone_identifier\u0026#34; == \u0026#34;\u0026#34; ]; then echo \u0026#34;Can not get zone_id.\u0026#34; log \u0026#34;Can not get zone_id.\u0026#34; exit 0 elif [ \u0026#34;$record_identifier\u0026#34; == \u0026#34;\u0026#34; ]; then echo \u0026#34;Can not get record_id.\u0026#34; log \u0026#34;Can not get record_id.\u0026#34; exit 0 fi # Update DNS Record update_dns # Check DNS record updated or not if [[ $update == *\u0026#34;\\\u0026#34;success\\\u0026#34;:false\u0026#34;* ]]; then log \u0026#34;API UPDATE FAILED. DUMPING RESULTS:\\n$update\u0026#34; echo -e \u0026#34;API UPDATE FAILED. DUMPING RESULTS:\\n$update\u0026#34; exit 0 else echo \u0026#34;$ip\u0026#34; \u0026gt; $ip_file log \u0026#34;$record_name IP changed to: $ip\u0026#34; echo \u0026#34;$record_name IP changed to: $ip\u0026#34; fi How to run the script 1 2 3 4 5 #update A record sudo bash /config/scripts/ddns/cloudflare-ddns.sh ipv4 \u0026lt;MY_DOMAIN_NAME\u0026gt; #update AAAA record sudo bash /config/scripts/ddns/cloudflare-ddns.sh ipv6 \u0026lt;MY_DOMAIN_NAME\u0026gt; ","date":"2022-10-09T09:50:14+08:00","image":"https://picsum.photos/800/600.webp?random=7257319e","permalink":"https://echowings.github.io/zh-cn/p/shell-script-to-update-cloudflare-ddns/","title":"Shell Script to Update Cloudflare Ddns"},{"content":"如何在VyOS上启用api服务 最近，我写了些shell脚本来自动探测网络状态，并通过脚本来更改vyos的设置，但是如果意外断电或者强制重启会导致VyOS的配置文件丢失，非常的麻烦和不稳定。 如何解决这个问题呢？为什么不实施VyOS的API呢？\n在VyOS本机上启用api服务 socket模式启用api服务 1 set service https api socket curl测试 1 curl --unix-socket /run/api.sock -X POST -Fkey=qwerty -Fdata=\u0026#39;{\u0026#34;op\u0026#34;: \u0026#34;showConfig\u0026#34;, \u0026#34;path\u0026#34;: []}\u0026#39; http://localhost/retrieve 使用let‘s encryption的ssl启动VyOS API 服务 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #!/bin/vbash source /opt/vyatta/etc/functions/script-template configure # 定义变量 ID=\u0026#34;my_id\u0026#34; APIKEY=\u0026#34;12345\u0026#34; APIPORT=\u0026#34;1234\u0026#34; VHOST=\u0026#34;myvps\u0026#34; FULL_FQDN=\u0026#34;xxx.xxx.xxx\u0026#34; LISTEN_ADDRESS=\u0026#34;xxx.xxx.xxx.xxx\u0026#34; EMAIL=\u0026#34;my@emal.com\u0026#34; set service https api key id $ID key $APIKEY set service https certificates certbot domain-name $FULL_FQDN set service https certificates certbot email $EMAIL set service https api strict set service https virtual-host $VHOST listen-address $LISTEN_ADDRESS set service https virtual-host $VHOST listen-port $APIPORT set service https virtual-host $VHOST server-name $FULL_FQDN commit save exit ","date":"2022-04-26T00:17:15+08:00","image":"https://picsum.photos/800/600.webp?random=71ff97d5","permalink":"https://echowings.github.io/zh-cn/p/how-to-enable-http-api-service-on-vyos/","title":"如何在vyos上启用api服务"},{"content":"奥林岛财务软件在win7/win8/win10安装 安装32bit的Office Office 2007. office 2013、office 2016,office2 019的32bit版本皆可！不可装64bit版本office.\n下载注册Vsflex6.ocx 下载vsflex6.ocx 下载链接(下载任意一个即可) (1). Vsflex6.zip\n(2). Vsflex6.zip\n解压出来的文件Vsflex6.ocx，复制粘贴到c:/windows/system32/目录。\n管理员权限打开CMD.在如下图所示图标右键。在“CommandPrompt“点击右键。然后在弹出的菜单 ”Run as Administror”，单击打开。 如下图 复制粘贴并在打开管理员权限cmd里运行这个命令即可完成Vsflex6.ocx的注册.\n1 regsvr32 c:\\windows\\system32\\Vsflex6.ocx \u0026ndash;THE END\u0026ndash;\n","date":"2021-02-05T11:27:59+08:00","image":"https://echowings.github.io/zh-cn/p/post/2016-09-14_101553_hu7810971e8a628346888e63335bad77f5_88259_120x120_fill_q75_box_smart1.jpg","permalink":"https://echowings.github.io/zh-cn/p/post/","title":"奥林岛财务软件在win7/win8/win10安装"}]